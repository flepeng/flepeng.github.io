

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2488174175014870" crossorigin="anonymous"></script><!-- google 广告 -->
  <meta name="google-site-verification" content="40lMg4eqLLbXoDcpN3h-cEnfmselbQ8tUzNvuC0IRIs" /><!-- google 站点认证 -->
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Lepeng">
  <meta name="keywords" content="">
  
    <meta name="description" content="第一章 ElasticSearch简介1.1 什么是ElasticSearchElaticsearch，简称为es，es是一个开源的高扩展的分布式全文检索引擎，它可以近乎实时的存储、检索数据；本身扩展性很好，可以扩展到上百台服务器，处理PB级别的数据。es也使用Java开发并使用Lucene作为其核心来实现所有索引和搜索的功能，但是它的目的是通过简单的RESTful API来隐藏Lucene的复杂">
<meta property="og:type" content="article">
<meta property="og:title" content="109-ElasticSearch">
<meta property="og:url" content="https://flepeng.github.io/021-Java-01-course-109-ElasticSearch/index.html">
<meta property="og:site_name" content="Lepeng">
<meta property="og:description" content="第一章 ElasticSearch简介1.1 什么是ElasticSearchElaticsearch，简称为es，es是一个开源的高扩展的分布式全文检索引擎，它可以近乎实时的存储、检索数据；本身扩展性很好，可以扩展到上百台服务器，处理PB级别的数据。es也使用Java开发并使用Lucene作为其核心来实现所有索引和搜索的功能，但是它的目的是通过简单的RESTful API来隐藏Lucene的复杂">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/1.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/2.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/7.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/8.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/5.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/6.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/9.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/10.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/24.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/46.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/47.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/61.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/48.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/49.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/50.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/51.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/52.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/53.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/54.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/55.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/56.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/57.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/58.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/36.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/37.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/59.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/60.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/21.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/22.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/23.png">
<meta property="og:image" content="https://flepeng.github.io/img/java/course/109/62.png">
<meta property="article:published_time" content="2020-02-01T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-03T10:25:30.294Z">
<meta property="article:author" content="Feng Lepeng">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://flepeng.github.io/img/java/course/109/1.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>109-ElasticSearch - Lepeng</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"flepeng.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"f3d259b9efd9ce8655c180fd01bf0045","google":{"measurement_id":"G-LFTE4C7W3W"},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?f3d259b9efd9ce8655c180fd01bf0045";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-LFTE4C7W3W", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-LFTE4C7W3W');
        });
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Lepeng 的 blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="109-ElasticSearch"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2020-02-02 00:00" pubdate>
          2020年2月2日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.8k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          57 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">109-ElasticSearch</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="第一章-ElasticSearch简介"><a href="#第一章-ElasticSearch简介" class="headerlink" title="第一章 ElasticSearch简介"></a>第一章 ElasticSearch简介</h1><h2 id="1-1-什么是ElasticSearch"><a href="#1-1-什么是ElasticSearch" class="headerlink" title="1.1 什么是ElasticSearch"></a>1.1 什么是ElasticSearch</h2><p>Elaticsearch，简称为es，es是一个开源的高扩展的分布式全文检索引擎，它可以近乎实时的存储、检索数据；本身扩展性很好，可以扩展到上百台服务器，处理PB级别的数据。es也使用Java开发并使用Lucene作为其核心来实现所有索引和搜索的功能，但是它的目的是通过简单的RESTful API来隐藏Lucene的复杂性，从而让全文搜索变得简单。</p>
<h2 id="1-2-ElasticSearch的使用案例"><a href="#1-2-ElasticSearch的使用案例" class="headerlink" title="1.2 ElasticSearch的使用案例"></a>1.2 ElasticSearch的使用案例</h2><ul>
<li>2013年初，GitHub抛弃了Solr，采取ElasticSearch 来做PB级的搜索。 “GitHub使用ElasticSearch搜索20TB的数据，包括13亿文件和1300亿行代码”</li>
<li>维基百科：启动以elasticsearch为基础的核心搜索架构</li>
<li>SoundCloud：“SoundCloud使用ElasticSearch为1.8亿用户提供即时而精准的音乐搜索服务”</li>
<li>百度：百度目前广泛使用ElasticSearch作为文本数据分析，采集百度所有服务器上的各类指标数据及用户自定义数据，通过对各种数据进行多维分析展示，辅助定位分析实例异常或业务层面异常。目前覆盖百度内部20多个业务线（包括casio、云分析、网盟、预测、文库、直达号、钱包、风控等），单集群最大100台机器，200个ES节点，每天导入30TB+数据</li>
<li>新浪使用ES 分析处理32亿条实时日志</li>
<li>阿里使用ES 构建挖财自己的日志采集和分析体系</li>
</ul>
<h2 id="1-3-ElasticSearch对比Solr"><a href="#1-3-ElasticSearch对比Solr" class="headerlink" title="1.3 ElasticSearch对比Solr"></a>1.3 ElasticSearch对比Solr</h2><ul>
<li>Solr 利用 Zookeeper 进行分布式管理，而 Elasticsearch 自身带有分布式协调管理功能;</li>
<li>Solr 支持更多格式的数据，而 Elasticsearch 仅支持json文件格式；</li>
<li>Solr 官方提供的功能更多，而 Elasticsearch 本身更注重于核心功能，高级功能多有第三方插件提供；</li>
<li>Solr 在传统的搜索应用中表现好于 Elasticsearch，但在处理实时搜索应用时效率明显低于 Elasticsearch</li>
</ul>
<h1 id="第二章-ElasticSearch安装与启动"><a href="#第二章-ElasticSearch安装与启动" class="headerlink" title="第二章 ElasticSearch安装与启动"></a>第二章 ElasticSearch安装与启动</h1><h2 id="2-1-下载ES压缩包"><a href="#2-1-下载ES压缩包" class="headerlink" title="2.1 下载ES压缩包"></a>2.1 下载ES压缩包</h2><p>ElasticSearch分为Linux和Window版本，我使用的是安装较为简便的Window版本，项目上线后，公司的运维人员会安装Linux版的ES供我们连接使用。</p>
<p>ElasticSearch的官方地址： <a href="https://www.elastic.co/products/elasticsearch" target="_blank" rel="noopener">https://www.elastic.co/products/elasticsearch</a></p>
<p><img src="/img/java/course/109/1.png" srcset="/img/loading.gif" lazyload><br><img src="/img/java/course/109/2.png" srcset="/img/loading.gif" lazyload><br><img src="/img/java/course/109/7.png" srcset="/img/loading.gif" lazyload><br><img src="/img/java/course/109/8.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="2-2-安装ES服务"><a href="#2-2-安装ES服务" class="headerlink" title="2.2 安装ES服务"></a>2.2 安装ES服务</h2><p>Window版的ElasticSearch的安装很简单，类似Window版的Tomcat，解压开即安装完毕，解压后的ElasticSearch的目录结构如下：</p>
<p><img src="/img/java/course/109/5.png" srcset="/img/loading.gif" lazyload></p>
<p>修改elasticsearch配置文件：config&#x2F;elasticsearch.yml，增加以下两句命令：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">http<span class="hljs-selector-class">.cors</span><span class="hljs-selector-class">.enabled</span>: true<br>http<span class="hljs-selector-class">.cors</span><span class="hljs-selector-class">.allow-origin</span>: <span class="hljs-string">"*"</span><br></code></pre></td></tr></table></figure>

<p>此步为允许elasticsearch跨越访问，如果不安装后面的elasticsearch-head是可以不修改，直接启动。</p>
<h2 id="2-3-启动ES服务"><a href="#2-3-启动ES服务" class="headerlink" title="2.3 启动ES服务"></a>2.3 启动ES服务</h2><p>点击ElasticSearch下的bin目录下的elasticsearch.bat启动，控制台显示的日志信息如下：</p>
<p><img src="/img/java/course/109/6.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/img/java/course/109/9.png" srcset="/img/loading.gif" lazyload></p>
<p>注意：9300是tcp通讯端口，集群间和TCPClient都执行该端口，9200是http协议的RESTful接口 。</p>
<p>通过浏览器访问ElasticSearch服务器，看到如下返回的json信息，代表服务启动成功：</p>
<p><img src="/img/java/course/109/10.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">注意：ElasticSearch是使用java开发的，且本版本的es需要的jdk版本要是<span class="hljs-number">1.8</span>以上，所以安装ElasticSearch之前保证JDK1<span class="hljs-number">.8</span>+安装完毕，并正确的配置好JDK环境变量，否则启动ElasticSearch失败。<br></code></pre></td></tr></table></figure>


<h2 id="2-4-安装ES的图形化界面插件"><a href="#2-4-安装ES的图形化界面插件" class="headerlink" title="2.4 安装ES的图形化界面插件"></a>2.4 安装ES的图形化界面插件</h2><p>ElasticSearch不同于Solr自带图形化界面，我们可以通过安装ElasticSearch的head插件，完成图形化界面的效果，完成索引数据的查看。安装插件的方式有两种，在线安装和本地安装。</p>
<p>本文档采用本地安装方式进行head插件的安装。elasticsearch-5-*以上版本安装head需要安装node和grunt</p>
<ol>
<li><p>下载head插件：<a href="https://github.com/mobz/elasticsearch-head" target="_blank" rel="noopener">https://github.com/mobz/elasticsearch-head</a>  </p>
</li>
<li><p>将elasticsearch-head-master压缩包解压到任意目录，但是要和elasticsearch的安装目录区别开</p>
</li>
<li><p>下载nodejs：<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">https://nodejs.org/en/download/</a><br>双击安装程序，一路 next 即可。<br>安装完毕，可以通过cmd控制台输入：node -v 查看版本号</p>
</li>
<li><p>将 grunt 安装为全局命令 ，Grunt 是基于 Node.js 的项目构建工具，在cmd控制台中输入如下执行命令：</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">npm install -g grunt-<span class="hljs-keyword">cli</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>进入 elasticsearch-head-master 目录启动 head，在命令提示符下输入命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash">npm install</span><br><span class="hljs-meta">&gt;</span><span class="bash">grunt server</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>打开浏览器，输入 <a href="http://localhost:9100，看到如下页面：">http://localhost:9100，看到如下页面：</a><br><img src="/img/java/course/109/24.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ol>
<p>如果不能成功连接到es服务，需要修改ElasticSearch的config目录下的配置文件：config&#x2F;elasticsearch.yml，增加以下两句命令：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">http<span class="hljs-selector-class">.cors</span><span class="hljs-selector-class">.enabled</span>: true<br>http<span class="hljs-selector-class">.cors</span><span class="hljs-selector-class">.allow-origin</span>: <span class="hljs-string">"*"</span><br></code></pre></td></tr></table></figure>

<p>然后重新启动ElasticSearch服务。</p>
<h1 id="第三章-ElasticSearch相关概念-术语"><a href="#第三章-ElasticSearch相关概念-术语" class="headerlink" title="第三章 ElasticSearch相关概念(术语)"></a>第三章 ElasticSearch相关概念(术语)</h1><h2 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h2><p>Elasticsearch是面向文档(document oriented)的，这意味着它可以存储整个对象或文档(document)。然而它不仅仅是存储，还会索引(index)每个文档的内容使之可以被搜索。在Elasticsearch中，你可以对文档（而非成行成列的数据）进行索引、搜索、排序、过滤。Elasticsearch比传统关系型数据库如下：</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xl">R<span class="hljs-function"><span class="hljs-title">elational</span> DB -&gt;</span> D<span class="hljs-function"><span class="hljs-title">atabases</span> -&gt;</span> T<span class="hljs-function"><span class="hljs-title">ables</span> -&gt;</span> R<span class="hljs-function"><span class="hljs-title">ows</span> -&gt;</span> Columns<br>E<span class="hljs-function"><span class="hljs-title">lasticsearch</span> -&gt;</span> I<span class="hljs-function"><span class="hljs-title">ndices</span>   -&gt;</span> T<span class="hljs-function"><span class="hljs-title">ypes</span>  -&gt;</span> D<span class="hljs-function"><span class="hljs-title">ocuments</span> -&gt;</span> Fields<br></code></pre></td></tr></table></figure>


<h2 id="3-2-Elasticsearch核心概念"><a href="#3-2-Elasticsearch核心概念" class="headerlink" title="3.2 Elasticsearch核心概念"></a>3.2 Elasticsearch核心概念</h2><h3 id="3-2-1-索引-index"><a href="#3-2-1-索引-index" class="headerlink" title="3.2.1 索引 index"></a>3.2.1 索引 index</h3><p>一个索引就是一个拥有几分相似特征的文档的集合。比如说，你可以有一个客户数据的索引，另一个产品目录的索引，还有一个订单数据的索引。一个索引由一个名字来标识（必须全部是小写字母的），并且当我们要对对应于这个索引中的文档进行索引、搜索、更新和删除的时候，都要使用到这个名字。在一个集群中，可以定义任意多的索引。</p>
<h3 id="3-2-2-类型-type"><a href="#3-2-2-类型-type" class="headerlink" title="3.2.2 类型 type"></a>3.2.2 类型 type</h3><p>在一个索引中，你可以定义一种或多种类型。一个类型是你的索引的一个逻辑上的分类&#x2F;分区，其语义完全由你来定。通常，会为具有一组共同字段的文档定义一个类型。比如说，我们假设你运营一个博客平台并且将你所有的数据存储到一个索引中。在这个索引中，你可以为用户数据定义一个类型，为博客数据定义另一个类型，当然，也可以为评论数据定义另一个类型。</p>
<h3 id="3-2-3-字段Field"><a href="#3-2-3-字段Field" class="headerlink" title="3.2.3 字段Field"></a>3.2.3 字段Field</h3><p>相当于是数据表的字段，对文档数据根据不同属性进行的分类标识</p>
<h3 id="3-2-4-映射-mapping"><a href="#3-2-4-映射-mapping" class="headerlink" title="3.2.4 映射 mapping"></a>3.2.4 映射 mapping</h3><p>mapping是处理数据的方式和规则方面做一些限制，如某个字段的数据类型、默认值、分析器、是否被索引等等，这些都是映射里面可以设置的，其它就是处理es里面数据的一些使用规则设置也叫做映射，按着最优规则处理数据对性能提高很大，因此才需要建立映射，并且需要思考如何建立映射才能对性能更好。</p>
<h3 id="3-2-5-文档-document"><a href="#3-2-5-文档-document" class="headerlink" title="3.2.5 文档 document"></a>3.2.5 文档 document</h3><p>一个文档是一个可被索引的基础信息单元。比如，你可以拥有某一个客户的文档，某一个产品的一个文档，当然，也可以拥有某个订单的一个文档。文档以JSON（Javascript Object Notation）格式来表示，而JSON是一个到处存在的互联网数据交互格式。</p>
<p>在一个index&#x2F;type里面，你可以存储任意多的文档。注意，尽管一个文档，物理上存在于一个索引之中，文档必须被索引&#x2F;赋予一个索引的type。</p>
<h3 id="3-2-6-接近实时-NRT"><a href="#3-2-6-接近实时-NRT" class="headerlink" title="3.2.6 接近实时 NRT"></a>3.2.6 接近实时 NRT</h3><p>Elasticsearch是一个接近实时的搜索平台。这意味着，从索引一个文档直到这个文档能够被搜索到有一个轻微的延迟（通常是1秒以内）</p>
<h3 id="3-2-7-集群-cluster"><a href="#3-2-7-集群-cluster" class="headerlink" title="3.2.7 集群 cluster"></a>3.2.7 集群 cluster</h3><p>一个集群就是由一个或多个节点组织在一起，它们共同持有整个的数据，并一起提供索引和搜索功能。一个集群由一个唯一的名字标识，这个名字默认就是“elasticsearch”。这个名字是重要的，因为一个节点只能通过指定某个集群的名字，来加入这个集群</p>
<h3 id="3-2-8-节点-node"><a href="#3-2-8-节点-node" class="headerlink" title="3.2.8 节点 node"></a>3.2.8 节点 node</h3><p>一个节点是集群中的一个服务器，作为集群的一部分，它存储数据，参与集群的索引和搜索功能。和集群类似，一个节点也是由一个名字来标识的，默认情况下，这个名字是一个随机的漫威漫画角色的名字，这个名字会在启动的时候赋予节点。这个名字对于管理工作来说挺重要的，因为在这个管理过程中，你会去确定网络中的哪些服务器对应于Elasticsearch集群中的哪些节点。</p>
<p>一个节点可以通过配置集群名称的方式来加入一个指定的集群。默认情况下，每个节点都会被安排加入到一个叫做“elasticsearch”的集群中，这意味着，如果你在你的网络中启动了若干个节点，并假定它们能够相互发现彼此，它们将会自动地形成并加入到一个叫做“elasticsearch”的集群中。</p>
<p>在一个集群里，只要你想，可以拥有任意多个节点。而且，如果当前你的网络中没有运行任何Elasticsearch节点，这时启动一个节点，会默认创建并加入一个叫做“elasticsearch”的集群。</p>
<h1 id="第四章-ElasticSearch的客户端操作"><a href="#第四章-ElasticSearch的客户端操作" class="headerlink" title="第四章 ElasticSearch的客户端操作"></a>第四章 ElasticSearch的客户端操作</h1><p>实际开发中，主要有三种方式可以作为elasticsearch服务的客户端：</p>
<ul>
<li>第一种，elasticsearch-head插件</li>
<li>第二种，使用elasticsearch提供的Restful接口直接访问</li>
<li>第三种，使用elasticsearch提供的API进行访问</li>
</ul>
<h2 id="4-2-使用Postman工具进行Restful接口访问"><a href="#4-2-使用Postman工具进行Restful接口访问" class="headerlink" title="4.2 使用Postman工具进行Restful接口访问"></a>4.2 使用Postman工具进行Restful接口访问</h2><h3 id="4-2-1-ElasticSearch的接口语法"><a href="#4-2-1-ElasticSearch的接口语法" class="headerlink" title="4.2.1 ElasticSearch的接口语法"></a>4.2.1 ElasticSearch的接口语法</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">curl -X<span class="hljs-tag">&lt;<span class="hljs-name">VERB</span>&gt;</span> '<span class="hljs-tag">&lt;<span class="hljs-name">PROTOCOL</span>&gt;</span>://<span class="hljs-tag">&lt;<span class="hljs-name">HOST</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">PORT</span>&gt;</span>/<span class="hljs-tag">&lt;<span class="hljs-name">PATH</span>&gt;</span>?<span class="hljs-tag">&lt;<span class="hljs-name">QUERY_STRING</span>&gt;</span>' -d '<span class="hljs-tag">&lt;<span class="hljs-name">BODY</span>&gt;</span>'<br></code></pre></td></tr></table></figure>

<p>其中：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td><code>VERB</code></td>
<td>适当的 HTTP <em>方法</em> 或 <em>谓词</em> : <code>GET</code>、 <code>POST</code>、 <code>PUT</code>、 <code>HEAD</code> 或者 <code>DELETE</code>。</td>
</tr>
<tr>
<td><code>PROTOCOL</code></td>
<td><code>http</code> 或者 <code>https</code>（如果你在 Elasticsearch 前面有一个 <code>https</code> 代理）</td>
</tr>
<tr>
<td><code>HOST</code></td>
<td>Elasticsearch 集群中任意节点的主机名，或者用 <code>localhost</code> 代表本地机器上的节点。</td>
</tr>
<tr>
<td><code>PORT</code></td>
<td>运行 Elasticsearch HTTP 服务的端口号，默认是 <code>9200</code> 。</td>
</tr>
<tr>
<td><code>PATH</code></td>
<td>API 的终端路径（例如 <code>_count</code> 将返回集群中文档数量）。Path 可能包含多个组件，例如：<code>_cluster/stats</code> 和 <code>_nodes/stats/jvm</code> 。</td>
</tr>
<tr>
<td><code>QUERY_STRING</code></td>
<td>任意可选的查询字符串参数 (例如 <code>?pretty</code> 将格式化地输出 JSON 返回值，使其更容易阅读)</td>
</tr>
<tr>
<td><code>BODY</code></td>
<td>一个 JSON 格式的请求体 (如果请求需要的话)</td>
</tr>
</tbody></table>
<h3 id="4-2-2-创建索引index和映射mapping"><a href="#4-2-2-创建索引index和映射mapping" class="headerlink" title="4.2.2 创建索引index和映射mapping"></a>4.2.2 创建索引index和映射mapping</h3><p>请求url：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">PUT localhost:<span class="hljs-number">9200</span>/blog1<br></code></pre></td></tr></table></figure>

<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"mappings"</span>: &#123;<br>        <span class="hljs-attr">"article"</span>: &#123;<br>            <span class="hljs-attr">"properties"</span>: &#123;<br>                <span class="hljs-attr">"id"</span>: &#123;<br>                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"long"</span>,<br>                    <span class="hljs-attr">"store"</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-string">"not_analyzed"</span><br>                &#125;,<br>                <span class="hljs-attr">"title"</span>: &#123;<br>                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,<br>                    <span class="hljs-attr">"store"</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-string">"analyzed"</span>,<br>                    <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"standard"</span><br>                &#125;,<br>                <span class="hljs-attr">"content"</span>: &#123;<br>                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,<br>                    <span class="hljs-attr">"store"</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-string">"analyzed"</span>,<br>                    <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"standard"</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>postman截图：</p>
<p><img src="/img/java/course/109/46.png" srcset="/img/loading.gif" lazyload></p>
<p>elasticsearch-head查看：</p>
<p><img src="/img/java/course/109/47.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="4-2-3-创建索引后设置Mapping"><a href="#4-2-3-创建索引后设置Mapping" class="headerlink" title="4.2.3 创建索引后设置Mapping"></a>4.2.3 创建索引后设置Mapping</h3><p>我们可以在创建索引时设置mapping信息，当然也可以先创建索引然后再设置mapping。</p>
<p>在上一个步骤中不设置maping信息，直接使用put方法创建一个索引，然后设置mapping信息。</p>
<p>请求的url：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">POST    http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9200</span><span class="hljs-regexp">/blog2/</span>hello<span class="hljs-regexp">/_mapping</span><br></code></pre></td></tr></table></figure>
<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"hello"</span>: &#123;<br>            <span class="hljs-attr">"properties"</span>: &#123;<br>                <span class="hljs-attr">"id"</span>:&#123;<br>                    <span class="hljs-attr">"type"</span>:<span class="hljs-string">"long"</span>,<br>                    <span class="hljs-attr">"store"</span>:<span class="hljs-literal">true</span><br>                &#125;,<br>                <span class="hljs-attr">"title"</span>:&#123;<br>                    <span class="hljs-attr">"type"</span>:<span class="hljs-string">"text"</span>,<br>                    <span class="hljs-attr">"store"</span>:<span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"standard"</span><br>                &#125;,<br>                <span class="hljs-attr">"content"</span>:&#123;<br>                    <span class="hljs-attr">"type"</span>:<span class="hljs-string">"text"</span>,<br>                    <span class="hljs-attr">"store"</span>:<span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"standard"</span><br>                &#125;<br>            &#125;<br>        &#125;<br>  &#125;<br></code></pre></td></tr></table></figure>

<p>PostMan截图</p>
<p><img src="/img/java/course/109/61.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="4-2-4-删除索引index"><a href="#4-2-4-删除索引index" class="headerlink" title="4.2.4 删除索引index"></a>4.2.4 删除索引index</h3><p>请求url：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">DELETE  localhost:<span class="hljs-number">9200</span>/blog1<br></code></pre></td></tr></table></figure>

<p>postman截图：</p>
<p><img src="/img/java/course/109/48.png" srcset="/img/loading.gif" lazyload></p>
<p>elasticsearch-head查看：</p>
<p><img src="/img/java/course/109/49.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="4-2-5-创建文档document"><a href="#4-2-5-创建文档document" class="headerlink" title="4.2.5 创建文档document"></a>4.2.5 创建文档document</h3><p>请求url：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">POST  localhost:<span class="hljs-number">9200</span>/blog1/article/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"id"</span>:<span class="hljs-number">1</span>,<br>    <span class="hljs-attr">"title"</span>:<span class="hljs-string">"ElasticSearch是一个基于Lucene的搜索服务器"</span>,<br>    <span class="hljs-attr">"content"</span>:<span class="hljs-string">"它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。"</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>postman截图：</p>
<p><img src="/img/java/course/109/50.png" srcset="/img/loading.gif" lazyload></p>
<p>elasticsearch-head查看：</p>
<p><img src="/img/java/course/109/51.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="4-2-6-修改文档document"><a href="#4-2-6-修改文档document" class="headerlink" title="4.2.6 修改文档document"></a>4.2.6 修改文档document</h3><p>请求url：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">POST  localhost:<span class="hljs-number">9200</span>/blog1/article/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"id"</span>:<span class="hljs-number">1</span>,<br>    <span class="hljs-attr">"title"</span>:<span class="hljs-string">"【修改】ElasticSearch是一个基于Lucene的搜索服务器"</span>,<br>    <span class="hljs-attr">"content"</span>:<span class="hljs-string">"【修改】它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。"</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>postman截图：</p>
<p><img src="/img/java/course/109/52.png" srcset="/img/loading.gif" lazyload></p>
<p>elasticsearch-head查看：</p>
<p><img src="/img/java/course/109/53.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="4-2-7-删除文档document"><a href="#4-2-7-删除文档document" class="headerlink" title="4.2.7 删除文档document"></a>4.2.7 删除文档document</h3><p>请求url：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">DELETE  localhost:<span class="hljs-number">9200</span>/blog1/article/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>postman截图：</p>
<p><img src="/img/java/course/109/54.png" srcset="/img/loading.gif" lazyload></p>
<p>elasticsearch-head查看：</p>
<p><img src="/img/java/course/109/55.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="4-2-8-查询文档-根据id查询"><a href="#4-2-8-查询文档-根据id查询" class="headerlink" title="4.2.8 查询文档-根据id查询"></a>4.2.8 查询文档-根据id查询</h3><p>请求url：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">GET  localhost:<span class="hljs-number">9200</span>/blog1/article/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>postman截图：</p>
<p><img src="/img/java/course/109/56.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="4-2-9-查询文档-querystring查询"><a href="#4-2-9-查询文档-querystring查询" class="headerlink" title="4.2.9 查询文档-querystring查询"></a>4.2.9 查询文档-querystring查询</h3><p>请求url：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">POST  <span class="hljs-string">localhost:</span><span class="hljs-number">9200</span><span class="hljs-regexp">/blog1/</span>article/_search<br></code></pre></td></tr></table></figure>

<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"query"</span>: &#123;<br>        <span class="hljs-attr">"query_string"</span>: &#123;<br>            <span class="hljs-attr">"default_field"</span>: <span class="hljs-string">"title"</span>,<br>            <span class="hljs-attr">"query"</span>: <span class="hljs-string">"搜索服务器"</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>postman截图：</p>
<p><img src="/img/java/course/109/57.png" srcset="/img/loading.gif" lazyload></p>
<p>注意：</p>
<p>将搜索内容”搜索服务器”修改为”钢索”，同样也能搜索到文档，该原因会在下面讲解中得到答案</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"query"</span>: &#123;<br>        <span class="hljs-attr">"query_string"</span>: &#123;<br>            <span class="hljs-attr">"default_field"</span>: <span class="hljs-string">"title"</span>,<br>            <span class="hljs-attr">"query"</span>: <span class="hljs-string">"钢索"</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="4-2-10-查询文档-term查询"><a href="#4-2-10-查询文档-term查询" class="headerlink" title="4.2.10 查询文档-term查询"></a>4.2.10 查询文档-term查询</h3><p>请求url：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">POST  <span class="hljs-string">localhost:</span><span class="hljs-number">9200</span><span class="hljs-regexp">/blog1/</span>article/_search<br></code></pre></td></tr></table></figure>

<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"query"</span>: &#123;<br>        <span class="hljs-attr">"term"</span>: &#123;<br>            <span class="hljs-attr">"title"</span>: <span class="hljs-string">"搜索"</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>postman截图：</p>
<p><img src="/img/java/course/109/58.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="第五章-IK-分词器和ElasticSearch集成使用"><a href="#第五章-IK-分词器和ElasticSearch集成使用" class="headerlink" title="第五章 IK 分词器和ElasticSearch集成使用"></a>第五章 IK 分词器和ElasticSearch集成使用</h1><h2 id="5-1-上述查询存在问题分析"><a href="#5-1-上述查询存在问题分析" class="headerlink" title="5.1 上述查询存在问题分析"></a>5.1 上述查询存在问题分析</h2><p>在进行字符串查询时，我们发现去搜索”搜索服务器”和”钢索”都可以搜索到数据；</p>
<p>而在进行词条查询时，我们搜索”搜索”却没有搜索到数据；</p>
<p>究其原因是ElasticSearch的标准分词器导致的，当我们创建索引时，字段使用的是标准分词器：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"mappings"</span>: &#123;<br>        <span class="hljs-attr">"article"</span>: &#123;<br>            <span class="hljs-attr">"properties"</span>: &#123;<br>                <span class="hljs-attr">"id"</span>: &#123;<br>                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"long"</span>,<br>                    <span class="hljs-attr">"store"</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-string">"not_analyzed"</span><br>                &#125;,<br>                <span class="hljs-attr">"title"</span>: &#123;<br>                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,<br>                    <span class="hljs-attr">"store"</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-string">"analyzed"</span>,<br>                    <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"standard"</span>    <span class="hljs-comment">//标准分词器</span><br>                &#125;,<br>                <span class="hljs-attr">"content"</span>: &#123;<br>                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,<br>                    <span class="hljs-attr">"store"</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-string">"analyzed"</span>,<br>                    <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"standard"</span>    <span class="hljs-comment">//标准分词器</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>例如对 “我是程序员” 进行分词</p>
<p>标准分词器分词效果测试：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://127.0.0.1:9200/_analyze?analyzer=standard&amp;pretty=true&amp;text=我是程序员<br></code></pre></td></tr></table></figure>

<p>分词结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">"tokens"</span> : [<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"我"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">0</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">1</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"&lt;IDEOGRAPHIC&gt;"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">0</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"是"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">1</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"&lt;IDEOGRAPHIC&gt;"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">1</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"程"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">3</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"&lt;IDEOGRAPHIC&gt;"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">2</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"序"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">3</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">4</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"&lt;IDEOGRAPHIC&gt;"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">3</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"员"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">4</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">5</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"&lt;IDEOGRAPHIC&gt;"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">4</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>而我们需要的分词效果是：我、是、程序、程序员</p>
<p>这样的话就需要对中文支持良好的分析器的支持，支持中文分词的分词器有很多，word分词器、庖丁解牛、盘古分词、Ansj分词等，但我们常用的还是下面要介绍的IK分词器。</p>
<h2 id="5-2-IK分词器简介"><a href="#5-2-IK分词器简介" class="headerlink" title="5.2 IK分词器简介"></a>5.2 IK分词器简介</h2><p>IKAnalyzer是一个开源的，基于java语言开发的轻量级的中文分词工具包。从2006年12月推出1.0版开始，IKAnalyzer已经推出 了3个大版本。最初，它是以开源项目Lucene为应用主体的，结合词典分词和文法分析算法的中文分词组件。新版本的IKAnalyzer3.0则发展为 面向Java的公用分词组件，独立于Lucene项目，同时提供了对Lucene的默认优化实现。</p>
<p>IK分词器3.0的特性如下：</p>
<p>1）采用了特有的“正向迭代最细粒度切分算法“，具有60万字&#x2F;秒的高速处理能力。<br>2）采用了多子处理器分析模式，支持：英文字母（IP地址、Email、URL）、数字（日期，常用中文数量词，罗马数字，科学计数法），中文词汇（姓名、地名处理）等分词处理。<br>3）对中英联合支持不是很好,在这方面的处理比较麻烦.需再做一次查询,同时是支持个人词条的优化的词典存储，更小的内存占用。<br>4）支持用户词典扩展定义。<br>5）针对Lucene全文检索优化的查询分析器IKQueryParser；采用歧义分析算法优化查询关键字的搜索排列组合，能极大的提高Lucene检索的命中率。</p>
<h2 id="5-3-ElasticSearch集成IK分词器"><a href="#5-3-ElasticSearch集成IK分词器" class="headerlink" title="5.3 ElasticSearch集成IK分词器"></a>5.3 ElasticSearch集成IK分词器</h2><h3 id="5-3-1-IK分词器的安装"><a href="#5-3-1-IK分词器的安装" class="headerlink" title="5.3.1 IK分词器的安装"></a>5.3.1 IK分词器的安装</h3><ol>
<li><p>下载地址：<a href="https://github.com/medcl/elasticsearch-analysis-ik/releases" target="_blank" rel="noopener">https://github.com/medcl/elasticsearch-analysis-ik/releases</a>   </p>
</li>
<li><p>解压，将解压后的elasticsearch文件夹拷贝到elasticsearch-5.6.8\plugins下，并重命名文件夹为analysis-ik</p>
</li>
<li><p>重新启动ElasticSearch，即可加载IK分词器<br><img src="/img/java/course/109/36.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ol>
<h3 id="5-3-2-IK分词器测试"><a href="#5-3-2-IK分词器测试" class="headerlink" title="5.3.2 IK分词器测试"></a>5.3.2 IK分词器测试</h3><p>IK提供了两个分词算法ik_smart 和 ik_max_word</p>
<p>其中 ik_smart 为最少切分，ik_max_word为最细粒度划分</p>
<p>我们分别来试一下</p>
<p>1）最小切分：在浏览器地址栏输入地址</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://127.0.0.1:9200/_analyze?analyzer=ik_smart&amp;pretty=true&amp;text=我是程序员<br></code></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">"tokens"</span> : [<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"我"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">0</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">1</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"CN_CHAR"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">0</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"是"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">1</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"CN_CHAR"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">1</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"程序员"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">5</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"CN_WORD"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">2</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>2）最细切分：在浏览器地址栏输入地址</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">http://127.0.0.1:9200/_analyze?analyzer=ik_max_word&amp;pretty=true&amp;text=我是程序员<br></code></pre></td></tr></table></figure>

<p>输出的结果为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">"tokens"</span> : [<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"我"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">0</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">1</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"CN_CHAR"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">0</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"是"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">1</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"CN_CHAR"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">1</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"程序员"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">5</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"CN_WORD"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">2</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"程序"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">4</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"CN_WORD"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">3</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">"token"</span> : <span class="hljs-string">"员"</span>,<br>      <span class="hljs-attr">"start_offset"</span> : <span class="hljs-number">4</span>,<br>      <span class="hljs-attr">"end_offset"</span> : <span class="hljs-number">5</span>,<br>      <span class="hljs-attr">"type"</span> : <span class="hljs-string">"CN_CHAR"</span>,<br>      <span class="hljs-attr">"position"</span> : <span class="hljs-number">4</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="5-4-修改索引映射mapping"><a href="#5-4-修改索引映射mapping" class="headerlink" title="5.4 修改索引映射mapping"></a>5.4 修改索引映射mapping</h2><h3 id="5-4-1-重建索引"><a href="#5-4-1-重建索引" class="headerlink" title="5.4.1 重建索引"></a>5.4.1 重建索引</h3><p>删除原有blog1索引</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">DELETE  localhost:<span class="hljs-number">9200</span>/blog1<br></code></pre></td></tr></table></figure>

<p>创建blog1索引，此时分词器使用ik_max_word</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">PUT  localhost:<span class="hljs-number">9200</span>/blog1<br></code></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"mappings"</span>: &#123;<br>        <span class="hljs-attr">"article"</span>: &#123;<br>            <span class="hljs-attr">"properties"</span>: &#123;<br>                <span class="hljs-attr">"id"</span>: &#123;<br>                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"long"</span>,<br>                    <span class="hljs-attr">"store"</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-string">"not_analyzed"</span><br>                &#125;,<br>                <span class="hljs-attr">"title"</span>: &#123;<br>                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,<br>                    <span class="hljs-attr">"store"</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-string">"analyzed"</span>,<br>                    <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_max_word"</span><br>                &#125;,<br>                <span class="hljs-attr">"content"</span>: &#123;<br>                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,<br>                    <span class="hljs-attr">"store"</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-string">"analyzed"</span>,<br>                    <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_max_word"</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>创建文档</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">POST  localhost:<span class="hljs-number">9200</span>/blog1/article/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"id"</span>:<span class="hljs-number">1</span>,<br>    <span class="hljs-attr">"title"</span>:<span class="hljs-string">"ElasticSearch是一个基于Lucene的搜索服务器"</span>,<br>    <span class="hljs-attr">"content"</span>:<span class="hljs-string">"它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。"</span><br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="5-4-2-再次测试queryString查询"><a href="#5-4-2-再次测试queryString查询" class="headerlink" title="5.4.2 再次测试queryString查询"></a>5.4.2 再次测试queryString查询</h3><p>请求url：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">POST  <span class="hljs-string">localhost:</span><span class="hljs-number">9200</span><span class="hljs-regexp">/blog1/</span>article/_search<br></code></pre></td></tr></table></figure>

<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"query"</span>: &#123;<br>        <span class="hljs-attr">"query_string"</span>: &#123;<br>            <span class="hljs-attr">"default_field"</span>: <span class="hljs-string">"title"</span>,<br>            <span class="hljs-attr">"query"</span>: <span class="hljs-string">"搜索服务器"</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>postman截图：</p>
<p><img src="/img/java/course/109/37.png" srcset="/img/loading.gif" lazyload></p>
<p>将请求体搜索字符串修改为”钢索”，再次查询：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"query"</span>: &#123;<br>        <span class="hljs-attr">"query_string"</span>: &#123;<br>            <span class="hljs-attr">"default_field"</span>: <span class="hljs-string">"title"</span>,<br>            <span class="hljs-attr">"query"</span>: <span class="hljs-string">"钢索"</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>postman截图：</p>
<p><img src="/img/java/course/109/59.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="5-4-3-再次测试term测试"><a href="#5-4-3-再次测试term测试" class="headerlink" title="5.4.3 再次测试term测试"></a>5.4.3 再次测试term测试</h3><p>请求url：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">POST <span class="hljs-string">localhost:</span><span class="hljs-number">9200</span><span class="hljs-regexp">/blog1/</span>article/_search<br></code></pre></td></tr></table></figure>

<p>请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"query"</span>: &#123;<br>        <span class="hljs-attr">"term"</span>: &#123;<br>            <span class="hljs-attr">"title"</span>: <span class="hljs-string">"搜索"</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>postman截图：</p>
<p><img src="/img/java/course/109/60.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="第六章-ElasticSearch集群"><a href="#第六章-ElasticSearch集群" class="headerlink" title="第六章 ElasticSearch集群"></a>第六章 ElasticSearch集群</h1><p>ES集群是一个 P2P类型(使用 gossip 协议)的分布式系统，除了集群状态管理以外，其他所有的请求都可以发送到集群内任意一台节点上，这个节点可以自己找到需要转发给哪些节点，并且直接跟这些节点通信。所以，从网络架构及服务配置上来说，构建集群所需要的配置极其简单。</p>
<p>在 Elasticsearch 2.0 之前，无阻碍的网络下，所有配置了相同 cluster.name 的节点都自动归属到一个集群中。2.0 版本之后，基于安全的考虑避免开发环境过于随便造成的麻烦，从 2.0 版本开始，默认的自动发现方式改为了单播(unicast)方式。配置里提供几台节点的地址，ES 将其视作 gossip router 角色，借以完成集群的发现。由于这只是 ES 内一个很小的功能，所以 gossip router 角色并不需要单独配置，每个 ES 节点都可以担任。所以，采用单播方式的集群，各节点都配置相同的几个节点列表作为 router 即可。</p>
<p>集群中节点数量没有限制，一般大于等于2个节点就可以看做是集群了。一般处于高性能及高可用方面来考虑一般集群中的节点数量都是3个及3个以上。</p>
<h2 id="6-1-集群的相关概念"><a href="#6-1-集群的相关概念" class="headerlink" title="6.1 集群的相关概念"></a>6.1 集群的相关概念</h2><h3 id="6-1-1-集群-cluster"><a href="#6-1-1-集群-cluster" class="headerlink" title="6.1.1 集群 cluster"></a>6.1.1 集群 cluster</h3><p>一个集群就是由一个或多个节点组织在一起，它们共同持有整个的数据，并一起提供索引和搜索功能。一个集群由一个唯一的名字标识，这个名字默认就是“elasticsearch”。这个名字是重要的，因为一个节点只能通过指定某个集群的名字，来加入这个集群</p>
<h3 id="6-1-2-节点-node"><a href="#6-1-2-节点-node" class="headerlink" title="6.1.2 节点 node"></a>6.1.2 节点 node</h3><p>一个节点是集群中的一个服务器，作为集群的一部分，它存储数据，参与集群的索引和搜索功能。和集群类似，一个节点也是由一个名字来标识的，默认情况下，这个名字是一个随机的漫威漫画角色的名字，这个名字会在启动的时候赋予节点。这个名字对于管理工作来说挺重要的，因为在这个管理过程中，你会去确定网络中的哪些服务器对应于Elasticsearch集群中的哪些节点。</p>
<p>一个节点可以通过配置集群名称的方式来加入一个指定的集群。默认情况下，每个节点都会被安排加入到一个叫做“elasticsearch”的集群中，这意味着，如果你在你的网络中启动了若干个节点，并假定它们能够相互发现彼此，它们将会自动地形成并加入到一个叫做“elasticsearch”的集群中。</p>
<p>在一个集群里，只要你想，可以拥有任意多个节点。而且，如果当前你的网络中没有运行任何Elasticsearch节点，这时启动一个节点，会默认创建并加入一个叫做“elasticsearch”的集群。</p>
<h3 id="6-1-3-分片和复制-shards-amp-replicas"><a href="#6-1-3-分片和复制-shards-amp-replicas" class="headerlink" title="6.1.3 分片和复制 shards&amp;replicas"></a>6.1.3 分片和复制 shards&amp;replicas</h3><p>一个索引可以存储超出单个结点硬件限制的大量数据。比如，一个具有10亿文档的索引占据1TB的磁盘空间，而任一节点都没有这样大的磁盘空间；或者单个节点处理搜索请求，响应太慢。为了解决这个问题，Elasticsearch提供了将索引划分成多份的能力，这些份就叫做分片。当你创建一个索引的时候，你可以指定你想要的分片的数量。每个分片本身也是一个功能完善并且独立的“索引”，这个“索引”可以被放置到集群中的任何节点上。分片很重要，主要有两方面的原因： </p>
<ol>
<li>允许你水平分割&#x2F;扩展你的内容容量。 </li>
<li>允许你在分片（潜在地，位于多个节点上）之上进行分布式的、并行的操作，进而提高性能&#x2F;吞吐量。</li>
</ol>
<p>至于一个分片怎样分布，它的文档怎样聚合回搜索请求，是完全由Elasticsearch管理的，对于作为用户的你来说，这些都是透明的。</p>
<p>在一个网络&#x2F;云的环境里，失败随时都可能发生，在某个分片&#x2F;节点不知怎么的就处于离线状态，或者由于任何原因消失了，这种情况下，有一个故障转移机制是非常有用并且是强烈推荐的。为此目的，Elasticsearch允许你创建分片的一份或多份拷贝，这些拷贝叫做复制分片，或者直接叫复制。</p>
<p>复制之所以重要，有两个主要原因： 在分片&#x2F;节点失败的情况下，提供了高可用性。因为这个原因，注意到复制分片从不与原&#x2F;主要（original&#x2F;primary）分片置于同一节点上是非常重要的。扩展你的搜索量&#x2F;吞吐量，因为搜索可以在所有的复制上并行运行。总之，每个索引可以被分成多个分片。一个索引也可以被复制0次（意思是没有复制）或多次。一旦复制了，每个索引就有了主分片（作为复制源的原来的分片）和复制分片（主分片的拷贝）之别。分片和复制的数量可以在索引创建的时候指定。在索引创建之后，你可以在任何时候动态地改变复制的数量，但是你事后不能改变分片的数量。</p>
<p>默认情况下，Elasticsearch中的每个索引被分片5个主分片和1个复制，这意味着，如果你的集群中至少有两个节点，你的索引将会有5个主分片和另外5个复制分片（1个完全拷贝），这样的话每个索引总共就有10个分片。</p>
<h2 id="6-2-集群的搭建"><a href="#6-2-集群的搭建" class="headerlink" title="6.2 集群的搭建"></a>6.2 集群的搭建</h2><h3 id="6-2-1-准备三台elasticsearch服务器"><a href="#6-2-1-准备三台elasticsearch服务器" class="headerlink" title="6.2.1 准备三台elasticsearch服务器"></a>6.2.1 准备三台elasticsearch服务器</h3><p>创建elasticsearch-cluster文件夹，在内部复制三个elasticsearch服务</p>
<h3 id="6-2-2-修改每台服务器配置"><a href="#6-2-2-修改每台服务器配置" class="headerlink" title="6.2.2 修改每台服务器配置"></a>6.2.2 修改每台服务器配置</h3><p>修改<code>elasticsearch-cluster\node*\config\elasticsearch.yml</code> 配置文件</p>
<h4 id="node1节点："><a href="#node1节点：" class="headerlink" title="node1节点："></a>node1节点：</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#节点1的配置信息：</span><br><span class="hljs-comment">#集群名称，保证唯一</span><br><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">my-elasticsearch</span><br><span class="hljs-comment">#节点名称，必须不一样</span><br><span class="hljs-attr">node.name:</span> <span class="hljs-string">node-1</span><br><span class="hljs-comment">#必须为本机的ip地址</span><br><span class="hljs-attr">network.host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br><span class="hljs-comment">#服务端口号，在同一机器下必须不一样</span><br><span class="hljs-attr">http.port:</span> <span class="hljs-number">9200</span><br><span class="hljs-comment">#集群间通信端口号，在同一机器下必须不一样</span><br><span class="hljs-attr">transport.tcp.port:</span> <span class="hljs-number">9300</span><br><span class="hljs-comment">#设置集群自动发现机器ip集合</span><br><span class="hljs-attr">discovery.zen.ping.unicast.hosts:</span> <span class="hljs-string">["127.0.0.1:9300","127.0.0.1:9301","127.0.0.1:9302"]</span><br></code></pre></td></tr></table></figure>

<h4 id="node2节点："><a href="#node2节点：" class="headerlink" title="node2节点："></a>node2节点：</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#节点2的配置信息：</span><br><span class="hljs-comment">#集群名称，保证唯一</span><br><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">my-elasticsearch</span><br><span class="hljs-comment">#节点名称，必须不一样</span><br><span class="hljs-attr">node.name:</span> <span class="hljs-string">node-2</span><br><span class="hljs-comment">#必须为本机的ip地址</span><br><span class="hljs-attr">network.host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br><span class="hljs-comment">#服务端口号，在同一机器下必须不一样</span><br><span class="hljs-attr">http.port:</span> <span class="hljs-number">9201</span><br><span class="hljs-comment">#集群间通信端口号，在同一机器下必须不一样</span><br><span class="hljs-attr">transport.tcp.port:</span> <span class="hljs-number">9301</span><br><span class="hljs-comment">#设置集群自动发现机器ip集合</span><br><span class="hljs-attr">discovery.zen.ping.unicast.hosts:</span> <span class="hljs-string">["127.0.0.1:9300","127.0.0.1:9301","127.0.0.1:9302"]</span><br></code></pre></td></tr></table></figure>

<h4 id="node3节点："><a href="#node3节点：" class="headerlink" title="node3节点："></a>node3节点：</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#节点3的配置信息：</span><br><span class="hljs-comment">#集群名称，保证唯一</span><br><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">my-elasticsearch</span><br><span class="hljs-comment">#节点名称，必须不一样</span><br><span class="hljs-attr">node.name:</span> <span class="hljs-string">node-3</span><br><span class="hljs-comment">#必须为本机的ip地址</span><br><span class="hljs-attr">network.host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br><span class="hljs-comment">#服务端口号，在同一机器下必须不一样</span><br><span class="hljs-attr">http.port:</span> <span class="hljs-number">9202</span><br><span class="hljs-comment">#集群间通信端口号，在同一机器下必须不一样</span><br><span class="hljs-attr">transport.tcp.port:</span> <span class="hljs-number">9302</span><br><span class="hljs-comment">#设置集群自动发现机器ip集合</span><br><span class="hljs-attr">discovery.zen.ping.unicast.hosts:</span> <span class="hljs-string">["127.0.0.1:9300","127.0.0.1:9301","127.0.0.1:9302"]</span><br></code></pre></td></tr></table></figure>


<h3 id="6-2-3-启动各个节点服务器"><a href="#6-2-3-启动各个节点服务器" class="headerlink" title="6.2.3 启动各个节点服务器"></a>6.2.3 启动各个节点服务器</h3><p>双击<code>elasticsearch-cluster\node*\bin\elasticsearch.bat</code></p>
<ol>
<li><p>启动节点1：<br><img src="/img/java/course/109/21.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p>启动节点2：<br><img src="/img/java/course/109/22.png" srcset="/img/loading.gif" lazyload></p>
</li>
<li><p>启动节点3：<br><img src="/img/java/course/109/23.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ol>
<h3 id="6-2-4-集群测试"><a href="#6-2-4-集群测试" class="headerlink" title="6.2.4 集群测试"></a>6.2.4 集群测试</h3><h4 id="添加索引和映射"><a href="#添加索引和映射" class="headerlink" title="添加索引和映射"></a>添加索引和映射</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">PUT  localhost:<span class="hljs-number">9200</span>/blog1<br></code></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"mappings"</span>: &#123;<br>        <span class="hljs-attr">"article"</span>: &#123;<br>            <span class="hljs-attr">"properties"</span>: &#123;<br>                <span class="hljs-attr">"id"</span>: &#123;<br>                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"long"</span>,<br>                    <span class="hljs-attr">"store"</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-string">"not_analyzed"</span><br>                &#125;,<br>                <span class="hljs-attr">"title"</span>: &#123;<br>                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,<br>                    <span class="hljs-attr">"store"</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-string">"analyzed"</span>,<br>                    <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"standard"</span><br>                &#125;,<br>                <span class="hljs-attr">"content"</span>: &#123;<br>                    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,<br>                    <span class="hljs-attr">"store"</span>: <span class="hljs-literal">true</span>,<br>                    <span class="hljs-attr">"index"</span>:<span class="hljs-string">"analyzed"</span>,<br>                    <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"standard"</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>


<h4 id="添加文档"><a href="#添加文档" class="headerlink" title="添加文档"></a>添加文档</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">POST  localhost:<span class="hljs-number">9200</span>/blog1/article/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">"id"</span>:<span class="hljs-number">1</span>,<br>    <span class="hljs-attr">"title"</span>:<span class="hljs-string">"ElasticSearch是一个基于Lucene的搜索服务器"</span>,<br>    <span class="hljs-attr">"content"</span>:<span class="hljs-string">"它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。"</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="使用elasticsearch-header查看集群情况"><a href="#使用elasticsearch-header查看集群情况" class="headerlink" title="使用elasticsearch-header查看集群情况"></a>使用elasticsearch-header查看集群情况</h4><p><img src="/img/java/course/109/62.png" srcset="/img/loading.gif" lazyload></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Java/" class="category-chain-item">Java</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Java/" class="print-no-link">#Java</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>109-ElasticSearch</div>
      <div>https://flepeng.github.io/021-Java-01-course-109-ElasticSearch/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Lepeng</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2020年2月2日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/021-Java-01-course-104-SpringBoot%E5%9F%BA%E7%A1%803-%E9%85%8D%E7%BD%AE-yam%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" title="104-SpringBoot基础3-配置-yam配置文件">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">104-SpringBoot基础3-配置-yam配置文件</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/021-Java-01-course-110-ElasticSearch/" title="110-ElasticSearch">
                        <span class="hidden-mobile">110-ElasticSearch</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
    <div id="giscus" class="giscus"></div>
    <script type="text/javascript">
      Fluid.utils.loadComments('#giscus', function() {
        var options = {"repo":"flepeng/hexo-blog-comment","repo-id":"R_kgDOL0qaig","category":"Announcements","category-id":"DIC_kwDOL0qais4CfBIv","theme-light":"light","theme-dark":"dark","mapping":"pathname","reactions-enabled":1,"emit-metadata":0,"input-position":"top","lang":"zh-CN"};
        var attributes = {};
        for (let option in options) {
          if (!option.startsWith('theme-')) {
            var key = option.startsWith('data-') ? option : 'data-' + option;
            attributes[key] = options[option];
          }
        }
        var light = 'light';
        var dark = 'dark';
        window.GiscusThemeLight = light;
        window.GiscusThemeDark = dark;
        attributes['data-theme'] = document.documentElement.getAttribute('data-user-color-scheme') === 'dark' ? dark : light;
        for (let attribute in attributes) {
          var value = attributes[attribute];
          if (value === undefined || value === null || value === '') {
            delete attributes[attribute];
          }
        }
        var s = document.createElement('script');
        s.setAttribute('src', 'https://giscus.app/client.js');
        s.setAttribute('crossorigin', 'anonymous');
        for (let attribute in attributes) {
          s.setAttribute(attribute, attributes[attribute]);
        }
        var ss = document.getElementsByTagName('script');
        var e = ss.length > 0 ? ss[ss.length - 1] : document.head || document.documentElement;
        e.parentNode.insertBefore(s, e.nextSibling);
      });
    </script>
    <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
