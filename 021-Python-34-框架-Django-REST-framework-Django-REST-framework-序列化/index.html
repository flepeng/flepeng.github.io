

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2488174175014870" crossorigin="anonymous"></script><!-- google 广告 -->
  <meta name="google-site-verification" content="40lMg4eqLLbXoDcpN3h-cEnfmselbQ8tUzNvuC0IRIs" /><!-- google 站点认证 -->
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Lepeng">
  <meta name="keywords" content="">
  
    <meta name="description" content="简介使用序列化有四种方式  使用json模块，完全手写 使用django自带的序列化模块1，# from django.core import serializers2，# data&#x3D;serializers.serialize(“json”,book_list) 使用REST framework 带的序列化方法，但是自己写规则BookSerializers(serializers.Ser">
<meta property="og:type" content="article">
<meta property="og:title" content="Django REST framework 序列化">
<meta property="og:url" content="https://flepeng.github.io/021-Python-34-%E6%A1%86%E6%9E%B6-Django-REST-framework-Django-REST-framework-%E5%BA%8F%E5%88%97%E5%8C%96/index.html">
<meta property="og:site_name" content="Lepeng">
<meta property="og:description" content="简介使用序列化有四种方式  使用json模块，完全手写 使用django自带的序列化模块1，# from django.core import serializers2，# data&#x3D;serializers.serialize(“json”,book_list) 使用REST framework 带的序列化方法，但是自己写规则BookSerializers(serializers.Ser">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://flepeng.github.io/picture/1629438957-c24132aedb596049b26f0f597e1e1039.png">
<meta property="article:published_time" content="2016-08-03T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-03T10:25:30.338Z">
<meta property="article:author" content="Feng Lepeng">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Django">
<meta property="article:tag" content="DRF">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://flepeng.github.io/picture/1629438957-c24132aedb596049b26f0f597e1e1039.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Django REST framework 序列化 - Lepeng</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"flepeng.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"f3d259b9efd9ce8655c180fd01bf0045","google":{"measurement_id":"G-LFTE4C7W3W"},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?f3d259b9efd9ce8655c180fd01bf0045";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-LFTE4C7W3W", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-LFTE4C7W3W');
        });
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Lepeng 的 blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Django REST framework 序列化"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2016-08-04 00:00" pubdate>
          2016年8月4日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.3k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          44 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Django REST framework 序列化</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>使用序列化有四种方式</p>
<ul>
<li><strong>使用json模块，完全手写</strong></li>
<li><strong>使用django自带的序列化模块<br>1，# from django.core import serializers<br>2，# data&#x3D;serializers.serialize(“json”,book_list)</strong></li>
<li><strong>使用REST framework 带的序列化方法，但是自己写规则<br>BookSerializers(serializers.Serializer)</strong></li>
<li><strong>使用REST framework 带的序列化方法，不自定义，完全使用模块<br>BookSerializers(serializers.ModelSerializer)</strong></li>
</ul>
<p>开发我们的Web API的第一件事是为我们的Web API提供一种将代码片段实例序列化和反序列化为诸如<code>json</code>之类的表示形式的方式。我们可以通过声明与Django forms非常相似的序列化器（serializers）来实现。</p>
<h2 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h2><h3 id="models部分"><a href="#models部分" class="headerlink" title="models部分:"></a>models部分:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models<br><br><span class="hljs-comment"># Create your models here.</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span><span class="hljs-params">(models.Model)</span>:</span><br>    title=models.CharField(max_length=<span class="hljs-number">32</span>)<br>    price=models.IntegerField()<br>    pub_date=models.DateField()<br>    publish=models.ForeignKey(<span class="hljs-string">"Publish"</span>)<br>    authors=models.ManyToManyField(<span class="hljs-string">"Author"</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">return</span> self.title<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Publish</span><span class="hljs-params">(models.Model)</span>:</span><br>    name=models.CharField(max_length=<span class="hljs-number">32</span>)<br>    email=models.EmailField()<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">return</span> self.name<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Author</span><span class="hljs-params">(models.Model)</span>:</span><br>    name=models.CharField(max_length=<span class="hljs-number">32</span>)<br>    age=models.IntegerField()<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span><span class="hljs-params">(self)</span>:</span><br>        <span class="hljs-keyword">return</span> self.name<br></code></pre></td></tr></table></figure>

<h3 id="views部分："><a href="#views部分：" class="headerlink" title="views部分："></a>views部分：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework.views <span class="hljs-keyword">import</span> APIView<br><span class="hljs-keyword">from</span> rest_framework.response <span class="hljs-keyword">import</span> Response<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookViewSet</span><span class="hljs-params">(APIView)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span><span class="hljs-params">(self,request,*args,**kwargs)</span>:</span><br>        book_list=Book.objects.all()<br>        <span class="hljs-comment"># 序列化方式1 自己手写json:</span><br>        <span class="hljs-comment"># from django.forms.models import model_to_dict</span><br>        <span class="hljs-comment"># import json</span><br>        <span class="hljs-comment"># data=[]</span><br>        <span class="hljs-comment"># for obj in book_list:</span><br>        <span class="hljs-comment">#     data.append(model_to_dict(obj))</span><br>        <span class="hljs-comment"># print(data)</span><br>        <span class="hljs-comment"># return HttpResponse("ok")</span><br><br>        <span class="hljs-comment"># 序列化方式2，使用django自带的序列化模块:</span><br>        <span class="hljs-comment"># from django.core import serializers</span><br>        <span class="hljs-comment"># data=serializers.serialize("json",book_list)</span><br>        <span class="hljs-comment"># return HttpResponse(data)</span><br><br>        <span class="hljs-comment"># 序列化方式3，使用REST framework 带的序列化方法，但是自己写规则:</span><br>        bs=BookSerializers(book_list,many=<span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">return</span> Response(bs.data)<br><br>        <span class="hljs-comment"># 序列化方式4，使用REST framework 带的序列化方法，不自定义，完全使用模块，如下</span><br>        bs=BookSerializers(book_list,many=<span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">return</span> Response(bs.data)<br></code></pre></td></tr></table></figure>

<h3 id="方式三：BookSerializers"><a href="#方式三：BookSerializers" class="headerlink" title="方式三：BookSerializers"></a>方式三：BookSerializers</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> HttpResponse<br><span class="hljs-keyword">from</span> django.core <span class="hljs-keyword">import</span> serializers<br><span class="hljs-keyword">from</span> rest_framework <span class="hljs-keyword">import</span> serializers<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookSerializers</span><span class="hljs-params">(serializers.Serializer)</span>:</span>            <span class="hljs-comment"># 方式三，自己定义序列化的规则</span><br>    title=serializers.CharField(max_length=<span class="hljs-number">32</span>)<br>    price=serializers.IntegerField()<br>    pub_date=serializers.DateField()<br>    publish=serializers.CharField(source=<span class="hljs-string">"publish.name"</span>)  <span class="hljs-comment"># 一对多，序列化时如果想要指定字段，需要使用参数source，跨表用.</span><br>    <span class="hljs-comment">#authors=serializers.CharField(source="authors.all")</span><br>    authors=serializers.SerializerMethodField()           <span class="hljs-comment"># 多对多时，自定义字段字段</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_authors</span><span class="hljs-params">(self,obj)</span>:</span>   <span class="hljs-comment"># 名字固定写法</span><br>        temp=[]<br>        <span class="hljs-keyword">for</span> author <span class="hljs-keyword">in</span> obj.authors.all():<br>            temp.append(author.name)<br>        <span class="hljs-keyword">return</span> temp<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        model=Book <br>        fields=[<span class="hljs-string">'title'</span>,<span class="hljs-string">'price'</span>,<span class="hljs-string">'pub_date'</span>,<span class="hljs-string">'authors'</span>]<br><br>    <span class="hljs-comment"># 钩子函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate_title</span><span class="hljs-params">(self, value)</span>:</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">'草'</span> <span class="hljs-keyword">in</span> value:<br>            <span class="hljs-keyword">raise</span> serializers.ValidationError(<span class="hljs-string">'不符合社会主义核心价值观'</span>)<br>        <span class="hljs-keyword">return</span> value<br></code></pre></td></tr></table></figure>

<h3 id="方式四：ModelSerializer"><a href="#方式四：ModelSerializer" class="headerlink" title="方式四：ModelSerializer"></a>方式四：ModelSerializer</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ModelSerializer 继承自 Serializer</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookSerializers</span><span class="hljs-params">(serializers.ModelSerializer)</span>:</span>       <span class="hljs-comment"># 不自定义，完全使用模块</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span> <span class="hljs-comment">#固定写法</span><br>        <span class="hljs-comment"># 指定要序列化Book表</span><br>        model = models.Book<br>        <span class="hljs-comment">#指定要序列化的字段</span><br>        fields = [<span class="hljs-string">'nid'</span>,<span class="hljs-string">'name'</span>]<br>        <span class="hljs-comment">#序列化所有字段</span><br>        fileds =<span class="hljs-string">'__all__'</span><br>        <span class="hljs-comment">#要排除的字段（不能与fileds连用）</span><br>        <span class="hljs-comment"># exclude = ['name','price'] </span><br>        <span class="hljs-comment">#深度判定</span><br>        depth = <span class="hljs-number">1</span> <br>        <span class="hljs-comment">#如果要不按照父类的来，想要自己定义显示的字段的话,自己定义一个，覆盖掉父类的字段属性。</span><br>    publish = serializers.SerializerMethodField()  <span class="hljs-comment">#一对多字段</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_publish</span><span class="hljs-params">(self,obj)</span>:</span><br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">'id'</span>:obj.publish.pk,<span class="hljs-string">'name'</span>:obj.publish.name&#125;<br></code></pre></td></tr></table></figure>


<h2 id="序列化组件常用字段"><a href="#序列化组件常用字段" class="headerlink" title="序列化组件常用字段"></a>序列化组件常用字段</h2><p><strong>常用字段类型</strong></p>
<table>
<thead>
<tr>
<th>字段</th>
<th>字段构造方式</th>
</tr>
</thead>
<tbody><tr>
<td><strong>BooleanField</strong></td>
<td>BooleanField()</td>
</tr>
<tr>
<td><strong>NullBooleanField</strong></td>
<td>NullBooleanField()</td>
</tr>
<tr>
<td><strong>CharField</strong></td>
<td>CharField(max_length&#x3D;None, min_length&#x3D;None, allow_blank&#x3D;False, trim_whitespace&#x3D;True)</td>
</tr>
<tr>
<td><strong>EmailField</strong></td>
<td>EmailField(max_length&#x3D;None, min_length&#x3D;None, allow_blank&#x3D;False)</td>
</tr>
<tr>
<td><strong>RegexField</strong></td>
<td>RegexField(regex, max_length&#x3D;None, min_length&#x3D;None, allow_blank&#x3D;False)</td>
</tr>
<tr>
<td><strong>SlugField</strong></td>
<td>SlugField(maxlength&#x3D;50, min_length&#x3D;None, allow_blank&#x3D;False) 正则字段，验证正则模式 [a-zA-Z0-9-]+</td>
</tr>
<tr>
<td><strong>URLField</strong></td>
<td>URLField(max_length&#x3D;200, min_length&#x3D;None, allow_blank&#x3D;False)</td>
</tr>
<tr>
<td><strong>UUIDField</strong></td>
<td>UUIDField(format&#x3D;’hex_verbose’)  </br>format:  </br>1) ‘hex_verbose’ 如”5ce0e9a5-5ffa-654b-cee0-1238041fb31a”  </br>2） ‘hex’ 如 “5ce0e9a55ffa654bcee01238041fb31a”  </br>3）’int’ - 如: “123456789012312313134124512351145145114”  </br>4）’urn’ 如: “urn:uuid:5ce0e9a5-5ffa-654b-cee0-1238041fb31a”</td>
</tr>
<tr>
<td><strong>IPAddressField</strong></td>
<td>IPAddressField(protocol&#x3D;’both’, unpack_ipv4&#x3D;False, **options)</td>
</tr>
<tr>
<td><strong>IntegerField</strong></td>
<td>IntegerField(max_value&#x3D;None, min_value&#x3D;None)</td>
</tr>
<tr>
<td><strong>FloatField</strong></td>
<td>FloatField(max_value&#x3D;None, min_value&#x3D;None)</td>
</tr>
<tr>
<td><strong>DecimalField</strong></td>
<td>DecimalField(max_digits, decimal_places, coerce_to_string&#x3D;None, max_value&#x3D;None, min_value&#x3D;None)  </br>max_digits: 最多位数  </br>decimal_palces: 小数点位置</td>
</tr>
<tr>
<td><strong>DateTimeField</strong></td>
<td>DateTimeField(format&#x3D;api_settings.DATETIME_FORMAT, input_formats&#x3D;None)</td>
</tr>
<tr>
<td><strong>DateField</strong></td>
<td>DateField(format&#x3D;api_settings.DATE_FORMAT, input_formats&#x3D;None)</td>
</tr>
<tr>
<td><strong>TimeField</strong></td>
<td>TimeField(format&#x3D;api_settings.TIME_FORMAT, input_formats&#x3D;None)</td>
</tr>
<tr>
<td><strong>DurationField</strong></td>
<td>DurationField()</td>
</tr>
<tr>
<td><strong>ChoiceField</strong></td>
<td>ChoiceField(choices)  </br> choices与Django的用法相同</td>
</tr>
<tr>
<td><strong>MultipleChoiceField</strong></td>
<td>MultipleChoiceField(choices)</td>
</tr>
<tr>
<td><strong>FileField</strong></td>
<td>FileField(max_length&#x3D;None, allow_empty_file&#x3D;False, use_url&#x3D;UPLOADED_FILES_USE_URL)</td>
</tr>
<tr>
<td><strong>ImageField</strong></td>
<td>ImageField(max_length&#x3D;None, allow_empty_file&#x3D;False, use_url&#x3D;UPLOADED_FILES_USE_URL)</td>
</tr>
<tr>
<td><strong>ListField</strong></td>
<td>ListField(child&#x3D;, min_length&#x3D;None, max_length&#x3D;None)</td>
</tr>
<tr>
<td><strong>DictField</strong></td>
<td>DictField(child&#x3D;)</td>
</tr>
</tbody></table>
<p><strong>选项参数：</strong></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><strong>max_length</strong></td>
<td>最大长度</td>
</tr>
<tr>
<td><strong>min_lenght</strong></td>
<td>最小长度</td>
</tr>
<tr>
<td><strong>allow_blank</strong></td>
<td>是否允许为空</td>
</tr>
<tr>
<td><strong>trim_whitespace</strong></td>
<td>是否截断空白字符</td>
</tr>
<tr>
<td><strong>max_value</strong></td>
<td>最大值</td>
</tr>
<tr>
<td><strong>min_value</strong></td>
<td>最小值</td>
</tr>
</tbody></table>
<p><strong>通用参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>read_only</strong></td>
<td>表明该字段仅用于序列化输出，默认False</td>
</tr>
<tr>
<td><strong>write_only</strong></td>
<td>表明该字段仅用于反序列化输入，默认False</td>
</tr>
<tr>
<td><strong>required</strong></td>
<td>表明该字段在反序列化时必须输入，默认True</td>
</tr>
<tr>
<td><strong>default</strong></td>
<td>反序列化时使用的默认值</td>
</tr>
<tr>
<td><strong>allow_null</strong></td>
<td>表明该字段是否允许传入None，默认False</td>
</tr>
<tr>
<td><strong>validators</strong></td>
<td>该字段使用的验证器</td>
</tr>
<tr>
<td><strong>error_messages</strong></td>
<td>包含错误编号与错误信息的字典</td>
</tr>
<tr>
<td><strong>label</strong></td>
<td>用于HTML展示API页面时，显示的字段名称</td>
</tr>
<tr>
<td><strong>help_text</strong></td>
<td>用于HTML展示API页面时，显示的字段帮助提示信息</td>
</tr>
</tbody></table>
<h2 id="source"><a href="#source" class="headerlink" title="source"></a>source</h2><p>在官方文档中是这样解释的：</p>
<blockquote>
<p>将用于填充字段的属性的名称。可以是仅接受<code>self</code>参数的方法，例如<code>URLField(source=&#39;get_absolute_url&#39;)</code>，也可以使用点分符号遍历属性，例如<code>EmailField(source=&#39;user.email&#39;)</code>。当使用点分符号序列化字段时，<code>default</code>如果在属性遍历期间任何对象不存在或为空，则可能需要提供一个值。<br>该值<code>source=&#39;*&#39;</code>具有特殊含义，用于指示应将整个对象传递给该字段。这对于创建嵌套表示或对需要访问完整对象才能确定输出表示的字段很有用。<br>默认为字段名称。</p>
</blockquote>
<p>其中比较常用的用法：</p>
<ol>
<li>source&#x3D;”get_field_name_display”如上所展示，在choice字段中可以展示选项对应的解释，这中用法代表的是官方解释说的可以是仅接受<code>self</code>参数的方法，也就是source中可以填serializer对象可以调用的方法（方法中需要传入self），内在逻辑是这个字段会展示此方法的返回的结果。</li>
<li>source&#x3D;’user.email’这种用法常在ModelSerializer的子类中，其中user为User对象，此中写法是指展示user的email属性，常用于我们想把外键对象user的属性和本对象的属性展示在同一层级，而不是下一级。</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs routeros">class UserSerializer(serializers.Serializer):<br>   <span class="hljs-built_in"> type </span>= serializers.IntegerField(<span class="hljs-attribute">source</span>=<span class="hljs-string">'user_type'</span>)<br>    user_type = serializers.CharField(<span class="hljs-attribute">source</span>=<span class="hljs-string">'get_user_type_display'</span>)  # choices字段显示<br>    username = serializers.CharField()<br>    pwd = serializers.CharField(<span class="hljs-attribute">source</span>=<span class="hljs-string">'password'</span>)  # 自定义serializer中的key值<br>    group_title = serializers.CharField(<span class="hljs-attribute">source</span>=<span class="hljs-string">'group.title'</span>)  # 关联对象属性<br>    roles = serializers.CharField(<span class="hljs-attribute">source</span>=<span class="hljs-string">'roles.all'</span>)  # 多对多关系<br>    roles_info = serializers.SerializerMethodField()   # 表示自定义方法，显示querytset对象详情<br><br>    def get_roles_info(self, row):<br>        roles = row.roles.all()<br>        ret = []<br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> roles:<br>            ret.append(<br>                &#123;<br>                    <span class="hljs-string">'id'</span>: item.id,<br>                    <span class="hljs-string">'title'</span>: item.title<br>                &#125;<br>            )<br>        return ret<br></code></pre></td></tr></table></figure>

<ol>
<li>如果没有指定在Filed中没有定义source参数的时候，就自动与数据库modles定义的字段进行匹配，如上面的userrname字段。在定义字段后，Serializer类中可以自定义属性如type</li>
<li>当models中是以choice定义时：需要定义source参数定义get_字段名_display才能获取数据，这与在模板语言中的用法一样，如上面的user_type</li>
<li>外键关联的时候，直接 外键字段名.属性 的方式定义传参给source参数即可，如上面的group.title</li>
<li>对于roles字段，想直接获取所有的对象，但是无法做到细粒度的将对象的所有属性展示出来，只能获取到QuerySet对象</li>
<li>自定义字段，处理数据，如roles_info获取所有的role对象的属性，处理数据可以定义方法，方法名格式为get_属性，并return值最终返回值</li>
</ol>
<h2 id="serializers-Serializer序列化"><a href="#serializers-Serializer序列化" class="headerlink" title="serializers.Serializer序列化"></a>serializers.Serializer序列化</h2><h3 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h3><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">from</span> django.db <span class="hljs-keyword">import</span> models<br><span class="hljs-title">__all__</span> = ['<span class="hljs-type">Book'</span>, '<span class="hljs-type">Publisher'</span>, '<span class="hljs-type">Author'</span>]<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Book</span>(<span class="hljs-title">models</span>.<span class="hljs-type">Model</span>):</span><br><span class="hljs-class">    title = models.<span class="hljs-type">CharField</span>(<span class="hljs-title">max_length</span>=32)</span><br><span class="hljs-class">    <span class="hljs-type">CHOICES</span> = (</span><br><span class="hljs-class">        (1, '<span class="hljs-type">Python</span>'),</span><br><span class="hljs-class">        (2, '<span class="hljs-type">Linux</span>'),</span><br><span class="hljs-class">        (3, '<span class="hljs-type">Go</span>')</span><br><span class="hljs-class">    )</span><br><span class="hljs-class">    category = models.<span class="hljs-type">IntegerField</span>(<span class="hljs-title">choices</span>=<span class="hljs-type">CHOICES</span>)</span><br><span class="hljs-class">    pub_time = models.<span class="hljs-type">DateField</span>()</span><br><span class="hljs-class">    publisher = models.<span class="hljs-type">ForeignKey</span>(<span class="hljs-title">to</span> = '<span class="hljs-type">Publisher</span>', <span class="hljs-title">on_delete</span>=<span class="hljs-title">models</span>.<span class="hljs-type">CASCADE</span>)</span><br><span class="hljs-class">    authors = models.<span class="hljs-type">ManyToManyField</span>(<span class="hljs-title">to</span> = '<span class="hljs-type">Author</span>')</span><br><span class="hljs-class">    </span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Publisher</span>(<span class="hljs-title">models</span>.<span class="hljs-type">Model</span>):</span><br><span class="hljs-class">    title = models.<span class="hljs-type">CharField</span>(<span class="hljs-title">max_length</span>=32)</span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Author</span>(<span class="hljs-title">models</span>.<span class="hljs-type">Model</span>):</span><br><span class="hljs-class">    name = models.<span class="hljs-type">CharField</span>(<span class="hljs-title">max_length</span>=32)</span><br></code></pre></td></tr></table></figure>

<h3 id="创建序列化器"><a href="#创建序列化器" class="headerlink" title="创建序列化器"></a>创建序列化器</h3><p>在app目录下创建serializers.py文件</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> rest_framework import serializers<br><span class="hljs-keyword">from</span> .models import Book<br><br>class PublisherSerializer(serializers.Serializer):<br>    id = serializers.IntegerField()<br>    title = serializers.CharField(<span class="hljs-attribute">max_length</span>=32)<br><br>class AutherSerializer(serializers.Serializer):<br>    id = serializers.IntegerField()<br>    name = serializers.CharField(<span class="hljs-attribute">max_length</span>=32)<br><br>class BookSerializer(serializers.Serializer):<br>    # <span class="hljs-attribute">required</span>=<span class="hljs-literal">False</span> 指明反序时（前端提交数据过来）不做校验<br>    id = serializers.IntegerField(<span class="hljs-attribute">required</span>=<span class="hljs-literal">False</span>)  <br>    <br>    title = serializers.CharField(<span class="hljs-attribute">max_length</span>=32)<br>    pub_time = serializers.DateField()<br>    <br>    <span class="hljs-string">""</span><span class="hljs-string">"</span><br><span class="hljs-string">    # source 比较常用的用法：</span><br><span class="hljs-string">        1、source="</span>get_field_name_display<span class="hljs-string">",在choice字段中可以展示选项对应的解释，这中用法代表的是官方解释说的可以是仅接受self参数的方法，也就是source中可以填serializer对象可以调用的方法（方法中需要传入self），内在逻辑是这个字段会展示此方法的返回的结果。</span><br><span class="hljs-string">        2、source='user.email'这种用法常在ModelSerializer的子类中，其中user为User对象，此中写法是指展示user的email属性，常用于我们想把外键对象user的属性和本对象的属性展示在同一层级，而不是下一级。</span><br><span class="hljs-string">    "</span><span class="hljs-string">""</span><br>    category = serializers.CharField(<span class="hljs-attribute">source</span>=<span class="hljs-string">'get_category_display'</span>, <span class="hljs-attribute">read_only</span>=<span class="hljs-literal">True</span>)<br>    <br>    # 外键关系的序列化是嵌套的序列化对象；内部通过外键关系的id找到publisher对象，再使用PublisherSerializer(publisher对象)<br>    publisher = PublisherSerializer(<span class="hljs-attribute">read_only</span>=<span class="hljs-literal">True</span>)         # 嵌套序列化器<br>    authors = AutherSerializer(<span class="hljs-attribute">many</span>=<span class="hljs-literal">True</span>, <span class="hljs-attribute">read_only</span>=<span class="hljs-literal">True</span>)   # 多对多关系需要加上参数：many = <span class="hljs-literal">True</span><br>    <br>    # read_only:指明该字段只做序列化，反序列化时不走该字段；那么反序列化时就必须重新指定字段名<br>    # write_only:指明该字段只做反序列化，不做序列化,也就是从数据库读出来的数据，序列化返的时候，不显示某个字段<br>    post_category = serializers.IntegerField(<span class="hljs-attribute">write_only</span>=<span class="hljs-literal">True</span>)<br>    publisher_id = serializers.IntegerField(<span class="hljs-attribute">write_only</span>=<span class="hljs-literal">True</span>)<br>    author_list = serializers.ListField(<span class="hljs-attribute">write_only</span>=<span class="hljs-literal">True</span>)<br>    <br>    <span class="hljs-attribute">authors</span>=serializers.SerializerMethodField()           # 多对多时，自定义字段字段<br>    def get_authors(self,obj):   # 名字固定写法<br>        temp=[]<br>        <span class="hljs-keyword">for</span> author <span class="hljs-keyword">in</span> obj.authors.all():<br>            temp.append(author.name)<br>        return temp<br><br><br>    def create(self, validated_data):<br>        # 调用 save 时执行<br>        # validated_data 校验通过的数据<br>        # 通过ORM操作给Book表添加数据<br>        # &#123;<span class="hljs-string">'title'</span>: <span class="hljs-string">'Die Hard'</span>, <span class="hljs-string">'pub_time'</span>: datetime.date(2020, 1, 12), <span class="hljs-string">'post_category'</span>: 1, <span class="hljs-string">'publisher_id'</span>: 1, <span class="hljs-string">'author_list'</span>: [1, 2]&#125;<br>        book_obj = Book.objects.create(<br>            <span class="hljs-attribute">title</span>=validated_data[<span class="hljs-string">'title'</span>],<br>            <span class="hljs-attribute">pub_time</span>=validated_data[<span class="hljs-string">'pub_time'</span>],<br>            <span class="hljs-attribute">category</span>=validated_data[<span class="hljs-string">'post_category'</span>],<br>            <span class="hljs-attribute">publisher_id</span>=validated_data[<span class="hljs-string">'publisher_id'</span>]<br>        )<br>        book_obj.authors.<span class="hljs-builtin-name">add</span>(*validated_data[<span class="hljs-string">'author_list'</span>])<br>        return book_obj<br><br>    def update(self, instance, validated_data):<br>        # 调用 save 时执行<br>        # instance为需要更新的对象<br>        instance.title = validated_data.<span class="hljs-builtin-name">get</span>(<span class="hljs-string">'title'</span>, instance.title)<br>        instance.pub_time = validated_data.<span class="hljs-builtin-name">get</span>(<span class="hljs-string">'pub_time'</span>, instance.pub_time)<br>        instance.category = validated_data.<span class="hljs-builtin-name">get</span>(<span class="hljs-string">'post_category'</span>, instance.category)<br>        instance.publisher_id = validated_data.<span class="hljs-builtin-name">get</span>(<span class="hljs-string">'publisher_id'</span>, instance.publisher_id)<br>        <span class="hljs-keyword">if</span> validated_data.<span class="hljs-builtin-name">get</span>(<span class="hljs-string">'author_list'</span>):<br>            instance.authors.<span class="hljs-builtin-name">set</span>(validated_data[<span class="hljs-string">'author_list'</span>])<br>        instance.save()<br>        return instance<br></code></pre></td></tr></table></figure>

<h3 id="序列化组件is-valid、validated-data"><a href="#序列化组件is-valid、validated-data" class="headerlink" title="序列化组件is_valid、validated_data"></a>序列化组件is_valid、validated_data</h3><p>当我们定义好序列化器时，怎么校验传入的字段呢？那就是is_valid方法，可以根据定义序列化器的校验规则判断传入字段是否合法。</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clean">serializer = CommentSerializer(data=&#123;<span class="hljs-string">'email'</span>: <span class="hljs-string">'foobar'</span>, <span class="hljs-string">'content'</span>: <span class="hljs-string">'baz'</span>&#125;)<br>serializer.is_valid()<br># <span class="hljs-literal">False</span><br>serializer.errors<br># &#123;<span class="hljs-string">'email'</span>: [<span class="hljs-string">'Enter a valid e-mail address.'</span>], <span class="hljs-string">'created'</span>: [<span class="hljs-string">'This field is required.'</span>]&#125;<br></code></pre></td></tr></table></figure>

<p>然后serializer.validated_data就可以获取校验过后的数据字典。</p>
<h3 id="序列化组件校验字段"><a href="#序列化组件校验字段" class="headerlink" title="序列化组件校验字段"></a>序列化组件校验字段</h3><p>序列化组件校验字段的方式常有三种：</p>
<p>1、首先是在字段的validators属性， 其中传入一个校验方法列表如：validators&#x3D;(my_validator, )其中my_validator中定义校验规则。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">def multiple_of_ten(value):<br>    if value % 10 !&#x3D; 0:<br>        raise serializers.ValidationError(&#39;Not a multiple of ten&#39;)<br><br>class GameRecord(serializers.Serializer):<br>    score &#x3D; IntegerField(validators&#x3D;[multiple_of_ten])<br></code></pre></td></tr></table></figure>

<p>2、最常用的是定义一个validate_field_name(self, value)的函数（其中field_name指的是字段名）,函数内是具体的逻辑。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plain">from rest_framework import serializers<br><br>class BlogPostSerializer(serializers.Serializer):<br>    title &#x3D; serializers.CharField(max_length&#x3D;100)<br>    content &#x3D; serializers.CharField()<br><br>    def validate_title(self, value):<br>        &quot;&quot;&quot;<br>        Check that the blog post is about Django.<br>        单个字段校验；value就是title的值<br>        &quot;&quot;&quot;<br>        if &#39;django&#39; not in value.lower():<br>            raise serializers.ValidationError(&quot;Blog post is not about Django&quot;)<br>        return value<br></code></pre></td></tr></table></figure>

<p>3、最后一种是定义一个validate(self, data)其中data是所有字段的键值对，所以这个校验方法是对象级别的校验。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plain">from rest_framework import serializers<br><br>class EventSerializer(serializers.Serializer):<br>    description &#x3D; serializers.CharField(max_length&#x3D;100)<br>    start &#x3D; serializers.DateTimeField()<br>    finish &#x3D; serializers.DateTimeField()<br><br>    def validate(self, data):<br>        &quot;&quot;&quot;<br>        Check that start is before finish.<br>        多个字段校验；attrs是个字典，包含前端传递过来的所有字段<br>        &quot;&quot;&quot;<br>        if data[&#39;start&#39;] &gt; data[&#39;finish&#39;]:<br>            raise serializers.ValidationError(&quot;finish must occur after start&quot;)<br>        return data<br></code></pre></td></tr></table></figure>


<p>当然或许当你看到这里会问why？how？ 只能说源码是最好的答案。</p>
<h4 id="validate做数据校验错误返回的key问题："><a href="#validate做数据校验错误返回的key问题：" class="headerlink" title="validate做数据校验错误返回的key问题："></a>validate做数据校验错误返回的key问题：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework <span class="hljs-keyword">import</span> serializers<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate</span><span class="hljs-params">(self, attrs)</span>:</span><br>    password = attrs.get(<span class="hljs-string">'password'</span>)<br>    re_password = attrs.pop(<span class="hljs-string">'re_password'</span>)<br>    print(password, re_password)<br><br>    <span class="hljs-keyword">if</span> password != re_password:<br>        <span class="hljs-keyword">raise</span> serializers.ValidationError(<span class="hljs-string">'两次密码不一致'</span>)<br>    <span class="hljs-keyword">return</span> attrs<br></code></pre></td></tr></table></figure>

<p>校验如有错误，报错的格式如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>    <span class="hljs-string">"status"</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-string">"message"</span>: &#123;<br>        <span class="hljs-string">"non_field_errors"</span>: [<br>            <span class="hljs-string">"两次密码不一致"</span><br>        ]<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>message的key为non_field_errors，传递到前端不方便处理，可以自定义一个key</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">raise</span> serializers.ValidationError(&#123;<span class="hljs-string">'password'</span>: <span class="hljs-string">'两次密码不一致'</span>&#125;)<br></code></pre></td></tr></table></figure>

<p>报错格式如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>    <span class="hljs-string">"status"</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-string">"message"</span>: &#123;<br>        <span class="hljs-string">"password"</span>: [<br>            <span class="hljs-string">"两次密码不一致"</span><br>        ]<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="类视图"><a href="#类视图" class="headerlink" title="类视图"></a>类视图</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">class</span> <span class="hljs-constructor">BookView(APIView)</span>:<br><br>    def get(self, request):<br>        book_queryset = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Book</span>.</span></span>objects.all<span class="hljs-literal">()</span><br>        ser_obj = <span class="hljs-constructor">BookSerializer(<span class="hljs-params">book_queryset</span>, <span class="hljs-params">many</span> = True)</span><br>        return <span class="hljs-constructor">Response(<span class="hljs-params">ser_obj</span>.<span class="hljs-params">data</span>)</span><br><br>    def post(self, request):<br>        book_obj = request.data<br>        # print(book_obj, <span class="hljs-keyword">type</span>(book_obj))<br>        ser_obj = <span class="hljs-constructor">BookSerializer(<span class="hljs-params">data</span> = <span class="hljs-params">book_obj</span>)</span><br>        <span class="hljs-keyword">if</span> ser_obj.is<span class="hljs-constructor">_valid()</span>:<br>            # ser_obj.save<span class="hljs-literal">()</span>使用该方法时，序列化器中必须实例create<span class="hljs-literal">()</span>方法<br>            ser_obj.save<span class="hljs-literal">()</span><br>            return <span class="hljs-constructor">Response(<span class="hljs-params">ser_obj</span>.<span class="hljs-params">validated_data</span>)</span><br>        return <span class="hljs-constructor">Response(<span class="hljs-params">ser_obj</span>.<span class="hljs-params">errors</span>)</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-constructor">BookEditView(APIView)</span>:<br><br>    def get(self, request, id):<br>        book_obj = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Book</span>.</span></span>objects.filter(id = id).first<span class="hljs-literal">()</span><br>        ser_obj = <span class="hljs-constructor">BookSerializer(<span class="hljs-params">book_obj</span>)</span><br>        return <span class="hljs-constructor">Response(<span class="hljs-params">ser_obj</span>.<span class="hljs-params">data</span>)</span><br><br>    def put(self, request, id):<br>        book_obj = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Book</span>.</span></span>objects.filter(id=id).first<span class="hljs-literal">()</span><br>        # partial=True 指明为部分字段做校验，即传入什么字段就校验什么字段，其他字段不做校验<br>        ser_obj = <span class="hljs-constructor">BookSerializer(<span class="hljs-params">instance</span> = <span class="hljs-params">book_obj</span>, <span class="hljs-params">data</span> = <span class="hljs-params">request</span>.<span class="hljs-params">data</span>, <span class="hljs-params">partial</span> = True)</span><br>        <span class="hljs-keyword">if</span> ser_obj.is<span class="hljs-constructor">_valid()</span>:<br>            ser_obj.save<span class="hljs-literal">()</span><br>            return <span class="hljs-constructor">Response(<span class="hljs-params">ser_obj</span>.<span class="hljs-params">validated_data</span>)</span><br>        return <span class="hljs-constructor">Response(<span class="hljs-params">ser_obj</span>.<span class="hljs-params">errors</span>)</span><br></code></pre></td></tr></table></figure>

<h3 id="serializers-Serializer序列总结"><a href="#serializers-Serializer序列总结" class="headerlink" title="serializers.Serializer序列总结"></a>serializers.Serializer序列总结</h3><p>使用serializers.Serializer方法序列化时注意以下几点：  </p>
<ol>
<li>正序与反序字段不一致  </li>
<li>字段中的参数 required&#x3D;False 指明反序时（前端提交数据过来）不做数据校验  </li>
<li>read_only&#x3D;True 参数指明该字段只做序列化，反序列化时不走该字段；那么反序列化时就必须重新指定字段名  </li>
<li>write_only 参数指明该字段只用做反序列化  </li>
<li>序列化器中必须实现create()与update()方法，分别对应创建与更新  </li>
<li>前端提交的参数校验与Django中的form表单校验数据一样</li>
</ol>
<h2 id="seriarizers-ModelSerializer序列化"><a href="#seriarizers-ModelSerializer序列化" class="headerlink" title="seriarizers.ModelSerializer序列化"></a>seriarizers.ModelSerializer序列化</h2><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><h3 id="4-1-depth"><a href="#4-1-depth" class="headerlink" title="4.1 depth"></a>4.1 depth</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 只修改了book表的序列化器，其他文件不动</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookSerializer</span><span class="hljs-params">(serializers.ModelSerializer)</span>:</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        model = Book<br>        fields = <span class="hljs-string">'__all__'</span><br></code></pre></td></tr></table></figure>

<p>序列化后的数据如下：  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>    <span class="hljs-string">"id"</span>:<span class="hljs-number">2</span>,<br>    <span class="hljs-string">"title"</span>: <span class="hljs-string">"天龙八部"</span>,<br>    <span class="hljs-string">"authors"</span>: [<br>        <span class="hljs-number">1</span>,<br>        <span class="hljs-number">2</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>外键关联的字段只显示了id，添加一个depth参数</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookSerializer</span></span>(serializers.ModelSerializer):<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:<span class="hljs-type"></span></span><br>        model = Book<br>        fields = <span class="hljs-string">'__all__'</span><br>        depth = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>序列化后的数据如下：  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>    <span class="hljs-string">"id"</span>:<span class="hljs-number">2</span>,<br>    <span class="hljs-string">"title"</span>: <span class="hljs-string">"天龙八部"</span>,<br>    <span class="hljs-string">"authors"</span>: [<br>        &#123;<span class="hljs-string">"id"</span>:<span class="hljs-number">1</span> , <span class="hljs-string">"name"</span>: <span class="hljs-string">"a"</span>&#125;,<br>        &#123;<span class="hljs-string">"id"</span>:<span class="hljs-number">2</span> , <span class="hljs-string">"name"</span>: <span class="hljs-string">"b"</span>&#125;,<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>depth&#x3D;1，意为找到一层关联的数据，即找到publisher关联表，如果publisher中有还有关联的表，不会再往下去找。  </p>
<p>注意：</p>
<ol>
<li>depth最多不要超过四层</li>
<li>depth会让所有的外键关系字段变成read_only&#x3D;True</li>
<li>生产环境depth不常用</li>
</ol>
<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookSerializer</span><span class="hljs-params">(serializers.ModelSerializer)</span>:</span><br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        model = Book<br>        fields = <span class="hljs-string">'__all__'</span><br>        <span class="hljs-comment"># exclude = ['id']</span><br>        <span class="hljs-comment"># depth = 1   # 注意： depth会让所有的外键关系字段变成read_only=True</span><br>        extra_kwargs = &#123;<br>            <span class="hljs-string">'publisher'</span>: &#123;<span class="hljs-string">'write_only'</span>: <span class="hljs-literal">True</span>&#125;,<br>            <span class="hljs-string">'authors'</span>: &#123;<span class="hljs-string">'write_only'</span>: <span class="hljs-literal">True</span>&#125;,<br>        &#125;<br>    <span class="hljs-comment"># 重写正序字段</span><br>    publisher_info = serializers.SerializerMethodField(read_only=<span class="hljs-literal">True</span>)<br>    <span class="hljs-comment"># SerializerMethodField是一个方法字段，即需要一个方法的返回值再赋给该字段</span><br>    authors_info = serializers.SerializerMethodField(read_only=<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_publisher_info</span><span class="hljs-params">(self, obj)</span>:</span><br>        publisher_obj = obj.publisher<br>        print(publisher_obj)<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">'id'</span>: publisher_obj.id, <span class="hljs-string">'title'</span>: publisher_obj.title&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_authors_info</span><span class="hljs-params">(self, obj)</span>:</span><br>        authors_queryset = obj.authors.all()<br>        <span class="hljs-keyword">return</span> [&#123;<span class="hljs-string">'id'</span>: author.id, <span class="hljs-string">'name'</span>: author.name&#125; <span class="hljs-keyword">for</span> author <span class="hljs-keyword">in</span> authors_queryset]<br></code></pre></td></tr></table></figure>

<p>外键关联的字段正序使用的是publisher_info与authors_info，那么反序还是使用的publisher与authors字段。字段的校验与上面的一样。</p>
<h3 id="自定义序列字段的两种写法"><a href="#自定义序列字段的两种写法" class="headerlink" title="自定义序列字段的两种写法"></a>自定义序列字段的两种写法</h3><p>这里所说的自定义序列字段可以另一张表中的字段，也可以自定要序列化的字段，也可以是外键关联的字段。<br>这种字段可以使用serializers.SerializerMethodField方法写在序列化器中<br>也可以在模型类中定义方法  </p>
<p>1：写在序列化器中</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookSerializer</span>(<span class="hljs-title">serializers</span>.<span class="hljs-title">ModelSerializer</span>):</span><br>    publisher = serializers.SerializerMethodField()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_publisher</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, obj)</span></span><span class="hljs-symbol">:</span><br>        <span class="hljs-keyword">return</span> obj.publisher.name<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        model = Book<br>        fields = [<span class="hljs-string">'name'</span>, <span class="hljs-string">'price'</span>, <span class="hljs-string">'publisher'</span>]<br></code></pre></td></tr></table></figure>

<p>注意：使用serializers.SerializerMethodField方法时，在fields列表中必须写上该字段，如上面代码中的publisher。如果fields列表中没有指定publiser字段，会报如下异常：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">The</span> <span class="hljs-meta">field</span> <span class="hljs-string">'publisher'</span> was declared on serializer <span class="hljs-keyword">BookSerializer, </span><span class="hljs-keyword">but </span>has not <span class="hljs-keyword">been </span>included in the <span class="hljs-string">'fields'</span> option.<br></code></pre></td></tr></table></figure>

<p>2：写在模型类中</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">class</span> <span class="hljs-constructor">Book(BaseModel)</span>:<br>    name = models.<span class="hljs-constructor">CharField(<span class="hljs-params">max_length</span>=64)</span><br>    price = models.<span class="hljs-constructor">DecimalField(<span class="hljs-params">max_digits</span>=5, <span class="hljs-params">decimal_places</span>=2)</span><br>    img = models.<span class="hljs-constructor">ImageField(<span class="hljs-params">upload_to</span>='<span class="hljs-params">img</span>', <span class="hljs-params">default</span>='<span class="hljs-params">img</span><span class="hljs-operator">/</span><span class="hljs-params">default</span>.<span class="hljs-params">jpg</span>')</span><br>    publisher = models.<span class="hljs-constructor">ForeignKey(<span class="hljs-params">to</span>='Publisher', <span class="hljs-params">on_delete</span>=<span class="hljs-params">models</span>.CASCADE)</span><br>    authors = models.<span class="hljs-constructor">ManyToManyField(<span class="hljs-params">to</span>='Author')</span><br><br>    <span class="hljs-keyword">class</span> Meta:<br>        db_table = 'gin_book'<br><br>    def <span class="hljs-constructor">__str__(<span class="hljs-params">self</span>)</span>:<br>        return self.name<br><br>    @property<br>    def publisher<span class="hljs-constructor">_name(<span class="hljs-params">self</span>)</span>:           # 定义成一个方法属性，方法名与属性名不能重复<br>        return self.publisher.name<br></code></pre></td></tr></table></figure>

<p>序列化类中的fields列表，可以指定publisher_name；不指定也不报异常</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookSerializer</span><span class="hljs-params">(serializers.ModelSerializer)</span>:</span><br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        model = Book<br>        fields = [<span class="hljs-string">'name'</span>, <span class="hljs-string">'price'</span>, <span class="hljs-string">'publisher_name'</span>]	<span class="hljs-comment"># 不指定publisher_name字段不会抛异常</span><br></code></pre></td></tr></table></figure>

<p>使用该方法时反序列化如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookSerializer</span><span class="hljs-params">(serializers.ModelSerializer)</span>:</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        model = Book<br>        fields = [<span class="hljs-string">'name'</span>, <span class="hljs-string">'price'</span>, <span class="hljs-string">'publisher_name'</span>, <span class="hljs-string">'img'</span>, <span class="hljs-string">'author_list'</span>, <span class="hljs-string">'publisher'</span>, <span class="hljs-string">'authors'</span>]<br>        extra_kwargs = &#123;<br>            <span class="hljs-string">'publisher'</span>: &#123;<span class="hljs-string">'write_only'</span>: <span class="hljs-literal">True</span>&#125;,<br>            <span class="hljs-string">'authors'</span>: &#123;<span class="hljs-string">'write_only'</span>: <span class="hljs-literal">True</span>&#125;,<br>            <span class="hljs-string">'name'</span>: &#123;<br>                <span class="hljs-string">'required'</span>: <span class="hljs-literal">True</span>,<br>                <span class="hljs-string">'min_length'</span>: <span class="hljs-number">3</span>,<br>                <span class="hljs-string">'error_messages'</span>: &#123;<br>                    <span class="hljs-string">'required'</span>: <span class="hljs-string">'必填项'</span>,<br>                    <span class="hljs-string">'min_length'</span>: <span class="hljs-string">'至少3个字符'</span><br>                &#125;<br>            &#125;<br>        &#125;<br></code></pre></td></tr></table></figure>

<p>视图类：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">class</span> <span class="hljs-constructor">BooksView(APIView)</span>:<br>    def get(self, request):<br>        queryset = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Book</span>.</span></span>objects.filter(is_delete = False)<br>        serializer = <span class="hljs-constructor">BookSerializer(<span class="hljs-params">queryset</span>, <span class="hljs-params">many</span> = True)</span><br>        return <span class="hljs-constructor">Response(<span class="hljs-params">serializer</span>.<span class="hljs-params">data</span>)</span><br>    def post(self, request):<br>        ser_obj = <span class="hljs-constructor">BookSerializer(<span class="hljs-params">data</span> = <span class="hljs-params">request</span>.<span class="hljs-params">data</span>)</span><br>        ser_obj.is<span class="hljs-constructor">_valid(<span class="hljs-params">raise_exception</span>=True)</span>  # 当校验失败会马上终止当前视图方法，抛出异常给前台<br>        book_obj = ser_obj.save<span class="hljs-literal">()</span><br>        return <span class="hljs-constructor">Response(&#123;'<span class="hljs-params">status</span>': 0, '<span class="hljs-params">message</span>': 'OK', '<span class="hljs-params">result</span>': BookSerializer(<span class="hljs-params">book_obj</span>)</span>.data&#125;)<br></code></pre></td></tr></table></figure>

<h3 id="自定义联表深度（嵌套）"><a href="#自定义联表深度（嵌套）" class="headerlink" title="自定义联表深度（嵌套）"></a>自定义联表深度（嵌套）</h3><p>模型类如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs routeros">class Book(BaseModel):<br>    name = models.CharField(<span class="hljs-attribute">max_length</span>=64)<br>    price = models.DecimalField(<span class="hljs-attribute">max_digits</span>=5, <span class="hljs-attribute">decimal_places</span>=2)<br>    img = models.ImageField(<span class="hljs-attribute">upload_to</span>=<span class="hljs-string">'img'</span>, <span class="hljs-attribute">default</span>=<span class="hljs-string">'img/default.jpg'</span>)<br>    publisher = models.ForeignKey(<span class="hljs-attribute">to</span>=<span class="hljs-string">'Publisher'</span>, <span class="hljs-attribute">on_delete</span>=models.CASCADE)<br>    authors = models.ManyToManyField(<span class="hljs-attribute">to</span>=<span class="hljs-string">'Author'</span>)<br>    class Meta:<br>        db_table = <span class="hljs-string">'gin_book'</span><br>    def __str__(self):<br>        return self.name<br><br>class Publisher(BaseModel):<br>    name = models.CharField(<span class="hljs-attribute">max_length</span>=64)<br>   <span class="hljs-built_in"> address </span>= models.CharField(<span class="hljs-attribute">max_length</span>=64)<br>    class Meta:<br>        db_table = <span class="hljs-string">'gin_publisher'</span><br>    def __str__(self):<br>        return self.name<br></code></pre></td></tr></table></figure>

<p>需求：Book表序列化时，也要序列化Pulisher表中指定的字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PublisherSerializer</span><span class="hljs-params">(serializers.ModelSerializer)</span>:</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        model = Publisher<br>        fields = [<span class="hljs-string">'name'</span>, <span class="hljs-string">'address'</span>]<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookSerializer</span><span class="hljs-params">(serializers.ModelSerializer)</span>:</span><br>    <span class="hljs-comment"># 自定义连表深度 - 子序列化方式</span><br>    publisher = PublisherSerializer()<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        model = Book<br>        fields = [<span class="hljs-string">'name'</span>, <span class="hljs-string">'price'</span>, <span class="hljs-string">'publisher'</span>]<br></code></pre></td></tr></table></figure>

<p><img src="/picture/1629438957-c24132aedb596049b26f0f597e1e1039.png" srcset="/img/loading.gif" lazyload alt="Django Rest Framework之序列化器"></p>
<h3 id="单增群增"><a href="#单增群增" class="headerlink" title="单增群增"></a>单增群增</h3><p>序列化器如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookSerializer</span><span class="hljs-params">(serializers.ModelSerializer)</span>:</span><br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        model = Book<br>        fields = [<span class="hljs-string">'name'</span>, <span class="hljs-string">'price'</span>, <span class="hljs-string">'publisher_name'</span>, <span class="hljs-string">'img'</span>, <span class="hljs-string">'author_list'</span>, <span class="hljs-string">'publisher'</span>, <span class="hljs-string">'authors'</span>]<br>        extra_kwargs = &#123;<br>            <span class="hljs-string">'publisher'</span>: &#123;<span class="hljs-string">'write_only'</span>: <span class="hljs-literal">True</span>&#125;,<br>            <span class="hljs-string">'authors'</span>: &#123;<span class="hljs-string">'write_only'</span>: <span class="hljs-literal">True</span>&#125;,<br>            <span class="hljs-string">'name'</span>: &#123;<br>                <span class="hljs-string">'required'</span>: <span class="hljs-literal">True</span>,<br>                <span class="hljs-string">'min_length'</span>: <span class="hljs-number">3</span>,<br>                <span class="hljs-string">'error_messages'</span>: &#123;<br>                    <span class="hljs-string">'required'</span>: <span class="hljs-string">'必填项'</span>,<br>                    <span class="hljs-string">'min_length'</span>: <span class="hljs-string">'至少3个字符'</span><br>                &#125;<br>            &#125;<br>        &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate_name</span><span class="hljs-params">(self, value)</span>:</span><br>        <span class="hljs-keyword">if</span> Book.objects.filter(name = value).exists():<br>            <span class="hljs-keyword">raise</span> serializers.ValidationError(<span class="hljs-string">'书籍名已存在'</span>)<br>        <span class="hljs-keyword">return</span> value<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate</span><span class="hljs-params">(self, attrs)</span>:</span><br>        <span class="hljs-comment"># todo: do something</span><br>        <span class="hljs-keyword">return</span> attrs<br></code></pre></td></tr></table></figure>

<p>单增群增，序列化器不用改。但需要判断前台数据为字典时为单增，为列表时是群增</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">class</span> <span class="hljs-constructor">BooksView(APIView)</span>:<br>    def get(self, request):<br>        queryset = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Book</span>.</span></span>objects.filter(is_delete=False)<br>        serializer = <span class="hljs-constructor">BookSerializer(<span class="hljs-params">queryset</span>, <span class="hljs-params">many</span>=True)</span><br>        return <span class="hljs-constructor">Response(<span class="hljs-params">serializer</span>.<span class="hljs-params">data</span>)</span><br><br>    def post(self, request):<br>        <span class="hljs-keyword">if</span> isinstance(request.data, dict):<br>            many = False<br>        elif isinstance(request.data, <span class="hljs-built_in">list</span>):<br>            many = True<br>        <span class="hljs-keyword">else</span>:<br>            return <span class="hljs-constructor">Response(&#123;'<span class="hljs-params">status</span>': 1, '<span class="hljs-params">message</span>': '<span class="hljs-params">invalid</span> <span class="hljs-params">data</span>'&#125;)</span><br><br>        ser_obj = <span class="hljs-constructor">BookSerializer(<span class="hljs-params">data</span>=<span class="hljs-params">request</span>.<span class="hljs-params">data</span>, <span class="hljs-params">many</span>=<span class="hljs-params">many</span>)</span><br>        ser_obj.is<span class="hljs-constructor">_valid(<span class="hljs-params">raise_exception</span>=True)</span>  # 当校验失败会马上终止当前视图方法，抛出异常给前台<br>        results = ser_obj.save<span class="hljs-literal">()</span><br>        return <span class="hljs-constructor">Response(&#123;'<span class="hljs-params">status</span>': 0, '<span class="hljs-params">message</span>': 'OK', '<span class="hljs-params">result</span>': BookSerializer(<span class="hljs-params">results</span>, <span class="hljs-params">many</span>=<span class="hljs-params">many</span>)</span>.data&#125;)<br></code></pre></td></tr></table></figure>

<p>前台传递数据格式如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">[<br>	&#123;<br>	    <span class="hljs-string">"name"</span>: <span class="hljs-string">"better man"</span>,<br>	    <span class="hljs-string">"price"</span>: <span class="hljs-number">96.66</span>,<br>	    <span class="hljs-string">"authors"</span>: [<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],<br>	    <span class="hljs-string">"publisher"</span>: <span class="hljs-number">1</span><br>	&#125;,<br>	&#123;<br>		<span class="hljs-string">"name"</span>: <span class="hljs-string">"tomorrow will be better"</span>,<br>		<span class="hljs-string">"price"</span>: <span class="hljs-number">100</span>,<br>		<span class="hljs-string">"authors"</span>: [<span class="hljs-number">2</span>],<br>		<span class="hljs-string">"publisher"</span>: <span class="hljs-number">2</span><br>	&#125;<br>]<br></code></pre></td></tr></table></figure>

<h3 id="单删群删"><a href="#单删群删" class="headerlink" title="单删群删"></a>单删群删</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span><span class="hljs-params">(self, request, *args, **kwargs)</span>:</span><br>    pk = kwargs.get(<span class="hljs-string">'pk'</span>)<br>    <span class="hljs-keyword">if</span> pk:<br>        pks = [pk]		<span class="hljs-comment"># 单删在URL中传递主键id</span><br>    <span class="hljs-keyword">else</span>:<br>        pks = request.data.get(<span class="hljs-string">'pks'</span>)	<span class="hljs-comment"># 群删传递JSON数据：&#123;'pks': [2,4,5,6]&#125;</span><br>    <span class="hljs-keyword">if</span> Book.objects.filter(pk__in = pks, is_delete = <span class="hljs-literal">False</span>).update(is_delete = <span class="hljs-literal">True</span>):<br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">'status'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'message'</span>: <span class="hljs-string">'success'</span>&#125;)<br>    <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">'status'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'message'</span>: <span class="hljs-string">'failed'</span>&#125;)<br></code></pre></td></tr></table></figure>

<h3 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h3><p>1：单整体修改<br>即修改数据时所传递的数据字段不能少</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">def</span> put(<span class="hljs-keyword">self, </span>request, pk):<br>    <span class="hljs-keyword">book_obj </span>= <span class="hljs-keyword">Book.objects.filter(pk </span>= pk).first()<br>    serializer = <span class="hljs-keyword">BookSerializer(instance </span>= <span class="hljs-keyword">book_obj, </span><span class="hljs-meta">data</span> = request<span class="hljs-meta">.data</span>)<br>    # 有 instance = <span class="hljs-keyword">book_obj </span>参数，当serializer.save()时会走update方法；如果没有instance = <span class="hljs-keyword">book_obj </span>参数会走create方法<br>    # <span class="hljs-meta">data</span> = request<span class="hljs-meta">.data</span> 必须要有，因为下面的is_valid方法校验的就是<span class="hljs-meta">data</span>中的数据<br>    serializer.is_valid(raise_exception<span class="hljs-symbol">=True</span>)<br>    <span class="hljs-keyword">book </span>= serializer.save()<br>    return Response(<span class="hljs-keyword">BookSerializer(book).data, </span>status = status.HTTP_201_CREATED)<br></code></pre></td></tr></table></figure>

<p>前端传递数据如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>	<span class="hljs-string">"name"</span>: <span class="hljs-string">"take me to you heart"</span>,<br>	<span class="hljs-string">"price"</span>: <span class="hljs-number">68.3</span>,<br>	<span class="hljs-string">"publisher"</span>: <span class="hljs-number">1</span>,<br>	<span class="hljs-string">"authors"</span>: [<span class="hljs-number">1</span>]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>2：单局部修改<br>即前端只传递部分字段，传递过来的字段做数据校验，校验通过后更新；没传递过来的字段不做数据校验</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">def patch(self, request, pk):<br>    book_obj = Book.objects.filter(<span class="hljs-attribute">pk</span>=pk).first()<br>    # 方法同上，只是多了个 <span class="hljs-attribute">partial</span>=<span class="hljs-literal">True</span> 参数；即传递过来的字段做校验，没有传递过来的字段不做校验<br>    serializer = BookSerializer(<span class="hljs-attribute">instance</span>=book_obj, <span class="hljs-attribute">data</span>=request.data, <span class="hljs-attribute">partial</span>=<span class="hljs-literal">True</span>)<br>    serializer.is_valid(<span class="hljs-attribute">raise_exception</span>=<span class="hljs-literal">True</span>)<br>    book = serializer.save()<br>    return Response(BookSerializer(book).data, <span class="hljs-attribute">status</span>=status.HTTP_201_CREATED)<br></code></pre></td></tr></table></figure>

<h3 id="批量修改数据"><a href="#批量修改数据" class="headerlink" title="批量修改数据"></a>批量修改数据</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs routeros">class BooksAPIView(APIView):<br>	<span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><br>    # 请求数据格式：[&#123;pk:1, name: 123&#125;, &#123;&#125;, &#123;&#125;]<br>    def patch(self, request, <span class="hljs-number">*a</span>rgs, **kwargs):<br>        request_data = request.data<br>        pk = kwargs.<span class="hljs-builtin-name">get</span>(<span class="hljs-string">'pk'</span>)<br>        <span class="hljs-keyword">if</span> pk <span class="hljs-keyword">and</span> isinstance(request_data, dict):<br>            # 单改<br>            pks = [pk]<br>            request_data = [request.data]<br>        elif <span class="hljs-keyword">not</span> pk <span class="hljs-keyword">and</span> isinstance(request_data, list):<br>            # 群改<br>            pks = []<br>            <span class="hljs-keyword">for</span> dic <span class="hljs-keyword">in</span> request_data:<br>                pk = dic.pop(<span class="hljs-string">'pk'</span>, None)<br>                pks.append(pk)<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> pks:<br>                return Response(&#123;<span class="hljs-string">'status'</span>: 1, <span class="hljs-string">'message'</span>: <span class="hljs-string">'invalid data'</span>, <span class="hljs-string">'result'</span>: <span class="hljs-string">''</span>&#125;)<br>        <span class="hljs-keyword">else</span>:<br>            return Response(&#123;<span class="hljs-string">'status'</span>: 1, <span class="hljs-string">'message'</span>: <span class="hljs-string">'invalid data'</span>, <span class="hljs-string">'result'</span>: <span class="hljs-string">''</span>&#125;)<br>        objs = []<br>        new_request_data = []<br><br>        <span class="hljs-keyword">for</span> index, pk <span class="hljs-keyword">in</span> enumerate(pks):<br>            try:<br>                obj = Book.objects.<span class="hljs-builtin-name">get</span>(pk = pk, is_delete = <span class="hljs-literal">False</span>)<br>                objs.append(obj)<br>                new_request_data.append(request_data[index])<br>            except Exception as e:<br>                continue<br>        <span class="hljs-builtin-name">print</span>(objs)<br>        <span class="hljs-builtin-name">print</span>(new_request_data)<br>        book_ser = BookSerializer(instance = objs, data = new_request_data, partial = <span class="hljs-literal">True</span>, many = <span class="hljs-literal">True</span>)<br>        book_ser.is_valid(<span class="hljs-attribute">raise_exception</span>=<span class="hljs-literal">True</span>)<br>        book_obj = book_ser.save()<br>        return Response(&#123;<span class="hljs-string">'status'</span>: 1, <span class="hljs-string">'message'</span>: <span class="hljs-string">'success'</span>, <span class="hljs-string">'result'</span>: BookSerializer(book_obj, many = <span class="hljs-literal">True</span>).data&#125;)<br></code></pre></td></tr></table></figure>

<p>注意：批量修改数据，序列化器中必须要有ListSerializer，如果没有会抛出异常：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">NotImplementedError: Serializers <span class="hljs-keyword">with</span> many=<span class="hljs-literal">True</span> <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> support multiple <span class="hljs-keyword">update</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">default</span>, <span class="hljs-keyword">only</span> multiple create. <span class="hljs-keyword">For</span> updates it <span class="hljs-keyword">is</span> unclear how <span class="hljs-keyword">to</span> deal <span class="hljs-keyword">with</span> insertions <span class="hljs-keyword">and</span> deletions. <span class="hljs-keyword">If</span> you need <span class="hljs-keyword">to</span> support multiple <span class="hljs-keyword">update</span>, <span class="hljs-keyword">use</span> a <span class="hljs-string">`ListSerializer`</span> <span class="hljs-keyword">class</span> <span class="hljs-keyword">and</span> override <span class="hljs-string">`.update()`</span> so you can specify the behavior exactly.<br></code></pre></td></tr></table></figure>

<p>序列化类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ListSerializer与ModelSerializer建立关联的是：ModelSerializer的Meta类的 list_serializer_class</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookListSerializer</span><span class="hljs-params">(serializers.ListSerializer)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, instance, validated_data)</span>:</span><br>        print(instance)         <span class="hljs-comment"># 要更新的对象们</span><br>        print(self.child)       <span class="hljs-comment"># 服务的模型序列化类（BookSerializer）</span><br><br>        <span class="hljs-keyword">for</span> index, obj <span class="hljs-keyword">in</span> enumerate(instance):<br>            self.child.update(obj, validated_data[index])<br>        <span class="hljs-keyword">return</span> instance<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookSerializer</span><span class="hljs-params">(serializers.ModelSerializer)</span>:</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        model = Book<br>        fields = [<span class="hljs-string">'name'</span>, <span class="hljs-string">'price'</span>, <span class="hljs-string">'publisher'</span>, <span class="hljs-string">'img'</span>, <span class="hljs-string">'author_list'</span>, <span class="hljs-string">'publisher_name'</span>, <span class="hljs-string">'authors'</span>]<br>        extra_kwargs = &#123;<br>            <span class="hljs-string">'name'</span>: &#123;<span class="hljs-string">'required'</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">'min_length'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'error_messages'</span>: &#123;<span class="hljs-string">'required'</span>: <span class="hljs-string">'必填项'</span>, <span class="hljs-string">'min_length'</span>: <span class="hljs-string">'至少3个字符'</span>&#125;&#125;,<br>            <span class="hljs-string">'publisher'</span>: &#123;<span class="hljs-string">'write_only'</span>: <span class="hljs-literal">True</span>&#125;,<br>            <span class="hljs-string">'authors'</span>: &#123;<span class="hljs-string">'write_only'</span>: <span class="hljs-literal">True</span>&#125;<br>        &#125;<br>        list_serializer_class = BookListSerializer<br></code></pre></td></tr></table></figure>

<h3 id="视图类与序列化类传参"><a href="#视图类与序列化类传参" class="headerlink" title="视图类与序列化类传参"></a>视图类与序列化类传参</h3><p>在视图类中，可以通过request得到登陆用户request.user<br>在序列化类中，要完成数据库数据的校验与入库操作，可能会需要知道当前的登录用户，但序列化类无法访问request对象<br>在视图类中实例化序列化对象时，可以通过context参数将request对象传递进去</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">book_ser = BookSerializer(context = &#123;<span class="hljs-string">'request'</span>: request&#125;,<span class="hljs-built_in"> instance </span>= objs, data = new_request_data, partial = <span class="hljs-literal">True</span>, many = <span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>

<p>序列化类中可以在钩子函数中接受该参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookSerializer</span><span class="hljs-params">(serializers.ModelSerializer)</span>:</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        model = Book<br>        fields = [<span class="hljs-string">'name'</span>, <span class="hljs-string">'price'</span>, <span class="hljs-string">'publisher'</span>, <span class="hljs-string">'img'</span>, <span class="hljs-string">'author_list'</span>, <span class="hljs-string">'publisher_name'</span>, <span class="hljs-string">'authors'</span>]<br>        extra_kwargs = &#123;<br>            <span class="hljs-string">'name'</span>: &#123;<span class="hljs-string">'required'</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">'min_length'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'error_messages'</span>: &#123;<span class="hljs-string">'required'</span>: <span class="hljs-string">'必填项'</span>, <span class="hljs-string">'min_length'</span>: <span class="hljs-string">'至少3个字符'</span>&#125;&#125;,<br>            <span class="hljs-string">'publisher'</span>: &#123;<span class="hljs-string">'write_only'</span>: <span class="hljs-literal">True</span>&#125;,<br>            <span class="hljs-string">'authors'</span>: &#123;<span class="hljs-string">'write_only'</span>: <span class="hljs-literal">True</span>&#125;<br>        &#125;<br>        list_serializer_class = BookListSerializer<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate</span><span class="hljs-params">(self, attrs)</span>:</span><br>        print(self.context.get(<span class="hljs-string">'request'</span>).method)<br>        <span class="hljs-keyword">return</span> attrs<br></code></pre></td></tr></table></figure>


<h2 id="序列化组件修改返回值to-representation、to-internal-value"><a href="#序列化组件修改返回值to-representation、to-internal-value" class="headerlink" title="序列化组件修改返回值to_representation、to_internal_value"></a>序列化组件修改返回值to_representation、to_internal_value</h2><p>to_representation(self, instance)：如果序列化器定义了此方法，可以改变序列化对象data的值，也就是serializer.data的值，你可以根据自己的业务场景去重新构造返回值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">def to_representation(self, instance):<br>    &quot;&quot;&quot;Convert &#96;username&#96; to lowercase.&quot;&quot;&quot;<br>    ret &#x3D; super().to_representation(instance)<br>    ret[&#39;username&#39;] &#x3D; ret[&#39;username&#39;].lower()<br>    return ret<br></code></pre></td></tr></table></figure>

<p>to_internal_value(self, data)： data为未经校验的数据字段， 此方法可以实现校验和修改反序列化后的值，然后返回。如果不想修改反序列化后的值只是做校验的话，完全可以使用validate方法替代。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">def to_internal_value(self, value):<br>    if value &#x3D;&#x3D; None:<br>        return 0<br>    return value<br></code></pre></td></tr></table></figure>

<p>总而言之，这两个方法一个是用于重新构造validated_data并返回，一个用于重新构造serializer.data的值并返回。</p>
<ul>
<li><a href="https://www.cnblogs.com/yoyoketang/p/14347488.html" target="_blank" rel="noopener">python测试开发django-rest-framework-91.反序列化(ModelSerializer)之ChoiceField选项字段校验</a></li>
<li><a href="https://blog.csdn.net/pcn01/article/details/103952474" target="_blank" rel="noopener">Django Rest Framework之序列化</a></li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Python/" class="category-chain-item">Python</a>
  
  
    <span>></span>
    
  <a href="/categories/Python/Django/" class="category-chain-item">Django</a>
  
  
    <span>></span>
    
  <a href="/categories/Python/Django/DRF/" class="category-chain-item">DRF</a>
  
  

  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Python/" class="print-no-link">#Python</a>
      
        <a href="/tags/Django/" class="print-no-link">#Django</a>
      
        <a href="/tags/DRF/" class="print-no-link">#DRF</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Django REST framework 序列化</div>
      <div>https://flepeng.github.io/021-Python-34-框架-Django-REST-framework-Django-REST-framework-序列化/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Lepeng</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2016年8月4日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/021-Python-34-%E6%A1%86%E6%9E%B6-Django-REST-framework-Django-REST-framework-%E5%BA%8F%E5%88%97%E5%8C%96-%E5%AD%97%E6%AE%B5%E5%90%AB%E4%B9%89/" title="Django REST framework 序列化-字段含义">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Django REST framework 序列化-字段含义</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/021-Python-34-%E6%A1%86%E6%9E%B6-Django-REST-framework-Django-REST-framework-%E8%A7%86%E5%9B%BE/" title="Django REST framework 视图">
                        <span class="hidden-mobile">Django REST framework 视图</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
    <div id="giscus" class="giscus"></div>
    <script type="text/javascript">
      Fluid.utils.loadComments('#giscus', function() {
        var options = {"repo":"flepeng/hexo-blog-comment","repo-id":"R_kgDOL0qaig","category":"Announcements","category-id":"DIC_kwDOL0qais4CfBIv","theme-light":"light","theme-dark":"dark","mapping":"pathname","reactions-enabled":1,"emit-metadata":0,"input-position":"top","lang":"zh-CN"};
        var attributes = {};
        for (let option in options) {
          if (!option.startsWith('theme-')) {
            var key = option.startsWith('data-') ? option : 'data-' + option;
            attributes[key] = options[option];
          }
        }
        var light = 'light';
        var dark = 'dark';
        window.GiscusThemeLight = light;
        window.GiscusThemeDark = dark;
        attributes['data-theme'] = document.documentElement.getAttribute('data-user-color-scheme') === 'dark' ? dark : light;
        for (let attribute in attributes) {
          var value = attributes[attribute];
          if (value === undefined || value === null || value === '') {
            delete attributes[attribute];
          }
        }
        var s = document.createElement('script');
        s.setAttribute('src', 'https://giscus.app/client.js');
        s.setAttribute('crossorigin', 'anonymous');
        for (let attribute in attributes) {
          s.setAttribute(attribute, attributes[attribute]);
        }
        var ss = document.getElementsByTagName('script');
        var e = ss.length > 0 ? ss[ss.length - 1] : document.head || document.documentElement;
        e.parentNode.insertBefore(s, e.nextSibling);
      });
    </script>
    <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
