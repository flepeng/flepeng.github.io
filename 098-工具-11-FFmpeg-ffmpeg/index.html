

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2488174175014870" crossorigin="anonymous"></script><!-- google 广告 -->
  <meta name="google-site-verification" content="40lMg4eqLLbXoDcpN3h-cEnfmselbQ8tUzNvuC0IRIs" /><!-- google 站点认证 -->
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Lepeng">
  <meta name="keywords" content="">
  
    <meta name="description" content="简介FFmpeg 的主要组成部分：  libavcodec：一个包含了所有FFmpeg音视频编解码器的库。 libavformat：一个包含了所有的普通音视格式的解析器和产生器的库。  三个实例程序(这三个实例基本可以作为API使用手册)：  ffmpeg：命令行的视频格式转换程序。 ffplay：视频播放程序。（需要SDL支持） ffserver：多媒体服务器  了解了它的大体组织结构，就明确了">
<meta property="og:type" content="article">
<meta property="og:title" content="ffmpeg">
<meta property="og:url" content="https://flepeng.github.io/098-%E5%B7%A5%E5%85%B7-11-FFmpeg-ffmpeg/index.html">
<meta property="og:site_name" content="Lepeng">
<meta property="og:description" content="简介FFmpeg 的主要组成部分：  libavcodec：一个包含了所有FFmpeg音视频编解码器的库。 libavformat：一个包含了所有的普通音视格式的解析器和产生器的库。  三个实例程序(这三个实例基本可以作为API使用手册)：  ffmpeg：命令行的视频格式转换程序。 ffplay：视频播放程序。（需要SDL支持） ffserver：多媒体服务器  了解了它的大体组织结构，就明确了">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://flepeng.github.io/img/ffmpeg01.jpg">
<meta property="og:image" content="https://flepeng.github.io/img/ffmpeg02.jpg">
<meta property="article:published_time" content="2021-03-11T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-03T10:25:30.415Z">
<meta property="article:author" content="Feng Lepeng">
<meta property="article:tag" content="ffmpeg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://flepeng.github.io/img/ffmpeg01.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>ffmpeg - Lepeng</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"flepeng.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"f3d259b9efd9ce8655c180fd01bf0045","google":{"measurement_id":"G-LFTE4C7W3W"},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?f3d259b9efd9ce8655c180fd01bf0045";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-LFTE4C7W3W", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-LFTE4C7W3W');
        });
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Lepeng 的 blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ffmpeg"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-03-12 00:00" pubdate>
          2021年3月12日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          5.7k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          48 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">ffmpeg</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>FFmpeg 的主要组成部分：</p>
<ol>
<li>libavcodec：一个包含了所有FFmpeg音视频编解码器的库。</li>
<li>libavformat：一个包含了所有的普通音视格式的解析器和产生器的库。</li>
</ol>
<p>三个实例程序(这三个实例基本可以作为API使用手册)：</p>
<ul>
<li>ffmpeg：命令行的视频格式转换程序。</li>
<li>ffplay：视频播放程序。（需要SDL支持）</li>
<li>ffserver：多媒体服务器</li>
</ul>
<p>了解了它的大体组织结构，就明确了ffmpeg是视频格式压缩转换的第一选择！</p>
<h3 id="一些地址"><a href="#一些地址" class="headerlink" title="一些地址"></a>一些地址</h3><ul>
<li>官网：<a href="https://ffmpeg.org/" target="_blank" rel="noopener">https://ffmpeg.org</a></li>
<li>Git: <a href="https://github.com/FFmpeg/FFmpeg" target="_blank" rel="noopener">https://github.com/FFmpeg/FFmpeg</a></li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>官网下载地址：<a href="https://ffmpeg.org/download.html#build-windows" target="_blank" rel="noopener">https://ffmpeg.org/download.html#build-windows</a></li>
</ul>
<h3 id="windows-安装"><a href="#windows-安装" class="headerlink" title="windows 安装"></a>windows 安装</h3><p>windows 安装包下载地址</p>
<ul>
<li><a href="https://www.gyan.dev/ffmpeg/builds/" target="_blank" rel="noopener">https://www.gyan.dev/ffmpeg/builds/</a></li>
<li><a href="https://github.com/BtbN/FFmpeg-Builds/releases" target="_blank" rel="noopener">https://github.com/BtbN/FFmpeg-Builds/releases</a><ul>
<li>例如：<a href="https://objects.githubusercontent.com/github-production-release-asset-2e65be/292087234/61b5caff-a375-45fb-a47c-d9be426fae61?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIWNJYAX4CSVEH53A/20220325/us-east-1/s3/aws4_request&X-Amz-Date=20220325T064125Z&X-Amz-Expires=300&X-Amz-Signature=a2bc37e97fdcacf0d9cae3f069aeb761048cbbaa74e7c5a4a8b11b6ab75f4a88&X-Amz-SignedHeaders=host&actor_id=0&key_id=0&repo_id=292087234&response-content-disposition=attachment;%20filename=ffmpeg-n4.4-latest-win64-gpl-4.4.zip&response-content-type=application/octet-stream" target="_blank" rel="noopener">https://objects.githubusercontent.com/github-production-release-asset-2e65be/292087234/61b5caff-a375-45fb-a47c-d9be426fae61?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20220325%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20220325T064125Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=a2bc37e97fdcacf0d9cae3f069aeb761048cbbaa74e7c5a4a8b11b6ab75f4a88&amp;X-Amz-SignedHeaders=host&amp;actor_id=0&amp;key_id=0&amp;repo_id=292087234&amp;response-content-disposition=attachment%3B%20filename%3Dffmpeg-n4.4-latest-win64-gpl-4.4.zip&amp;response-content-type=application%2Foctet-stream</a></li>
</ul>
</li>
</ul>
<p>下载之后，解压安装包会得到如下目录：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">bin<br>doc<br><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">LICENSE</span>.</span></span>txt<br></code></pre></td></tr></table></figure>

<p>进入bin目录并获取路径</p>
<h4 id="添加到环境变量"><a href="#添加到环境变量" class="headerlink" title="添加到环境变量"></a>添加到环境变量</h4><p>在此电脑界面下右击选择属性 &gt; 高级系统设置 &gt; 环境变量</p>
<p>在用户环境变量双击path，选择新建（注意不要更改其他环境变量），将刚才的bin路径粘贴进去</p>
<p>记得点下方的确定，再关闭当前窗口再点确定以保存</p>
<p>到这里，ffmpeg的配置就差不多了，调用命令行（windows+R输入cmd）输入“ffmpeg –version”，如果出现如下说明配置成功</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">ffmpeg</span> <span class="hljs-comment">version</span> <span class="hljs-comment">n4</span><span class="hljs-string">.</span><span class="hljs-comment">4</span><span class="hljs-string">.</span><span class="hljs-comment">1</span><span class="hljs-literal">-</span><span class="hljs-comment">50</span><span class="hljs-literal">-</span><span class="hljs-comment">ga4e1dd6940</span><span class="hljs-literal">-</span><span class="hljs-comment">20220324</span> <span class="hljs-comment">Copyright</span> <span class="hljs-comment">(c)</span> <span class="hljs-comment">2000</span><span class="hljs-literal">-</span><span class="hljs-comment">2021</span> <span class="hljs-comment">the</span> <span class="hljs-comment">FFmpeg</span> <span class="hljs-comment">developers</span><br><span class="hljs-comment">built</span> <span class="hljs-comment">with</span> <span class="hljs-comment">gcc</span> <span class="hljs-comment">11</span><span class="hljs-string">.</span><span class="hljs-comment">2</span><span class="hljs-string">.</span><span class="hljs-comment">0</span> <span class="hljs-comment">(crosstool</span><span class="hljs-literal">-</span><span class="hljs-comment">NG</span> <span class="hljs-comment">1</span><span class="hljs-string">.</span><span class="hljs-comment">24</span><span class="hljs-string">.</span><span class="hljs-comment">0</span><span class="hljs-string">.</span><span class="hljs-comment">533_681aaef)</span><br><span class="hljs-comment">configuration:</span> --<span class="hljs-comment">prefix=/ffbuild/prefix</span> --<span class="hljs-comment">pkg</span><span class="hljs-literal">-</span><span class="hljs-comment">config</span><span class="hljs-literal">-</span><span class="hljs-comment">flags=</span>--<span class="hljs-comment">static</span> --<span class="hljs-comment">pkg</span><span class="hljs-literal">-</span><span class="hljs-comment">config=pkg</span><span class="hljs-literal">-</span><span class="hljs-comment">config</span> --<span class="hljs-comment">cross</span><span class="hljs-literal">-</span><span class="hljs-comment">prefix=x86_64</span><span class="hljs-literal">-</span><span class="hljs-comment">w64</span><span class="hljs-literal">-</span><span class="hljs-comment">mingw32</span><span class="hljs-literal">-</span> --<span class="hljs-comment">arch=x86_64</span> --<span class="hljs-comment">target</span><span class="hljs-literal">-</span><span class="hljs-comment">os=mingw32</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">gpl</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">version3</span> --<span class="hljs-comment">disable</span><span class="hljs-literal">-</span><span class="hljs-comment">debug</span> --<span class="hljs-comment">disable</span><span class="hljs-literal">-</span><span class="hljs-comment">w32threads</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">pthreads</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">iconv</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libxml2</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">zlib</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libfreetype</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libfribidi</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">gmp</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">lzma</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">fontconfig</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libvorbis</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">opencl</span> --<span class="hljs-comment">disable</span><span class="hljs-literal">-</span><span class="hljs-comment">libpulse</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libvmaf</span> --<span class="hljs-comment">disable</span><span class="hljs-literal">-</span><span class="hljs-comment">libxcb</span> --<span class="hljs-comment">disable</span><span class="hljs-literal">-</span><span class="hljs-comment">xlib</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">amf</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libaom</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">avisynth</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libdav1d</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libdavs2</span> --<span class="hljs-comment">disable</span><span class="hljs-literal">-</span><span class="hljs-comment">libfdk</span><span class="hljs-literal">-</span><span class="hljs-comment">aac</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">ffnvcodec</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">cuda</span><span class="hljs-literal">-</span><span class="hljs-comment">llvm</span> --<span class="hljs-comment">disable</span><span class="hljs-literal">-</span><span class="hljs-comment">frei0r</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libgme</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libass</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libbluray</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libmp3lame</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libopus</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">librist</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libtheora</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libvpx</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libwebp</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">lv2</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libmfx</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libopencore</span><span class="hljs-literal">-</span><span class="hljs-comment">amrnb</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libopencore</span><span class="hljs-literal">-</span><span class="hljs-comment">amrwb</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libopenh264</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libopenjpeg</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libopenmpt</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">librav1e</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">librubberband</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">schannel</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">sdl2</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libsoxr</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libsrt</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libsvtav1</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libtwolame</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libuavs3d</span> --<span class="hljs-comment">disable</span><span class="hljs-literal">-</span><span class="hljs-comment">libdrm</span> --<span class="hljs-comment">disable</span><span class="hljs-literal">-</span><span class="hljs-comment">vaapi</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libvidstab</span> --<span class="hljs-comment">disable</span><span class="hljs-literal">-</span><span class="hljs-comment">vulkan</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libx264</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libx265</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libxavs2</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libxvid</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libzimg</span> --<span class="hljs-comment">enable</span><span class="hljs-literal">-</span><span class="hljs-comment">libzvbi</span> --<span class="hljs-comment">extra</span><span class="hljs-literal">-</span><span class="hljs-comment">cflags=</span><span class="hljs-literal">-</span><span class="hljs-comment">DLIBTWOLAME_STATIC</span> --<span class="hljs-comment">extra</span><span class="hljs-literal">-</span><span class="hljs-comment">cxxflags=</span> --<span class="hljs-comment">extra</span><span class="hljs-literal">-</span><span class="hljs-comment">ldflags=</span><span class="hljs-literal">-</span><span class="hljs-comment">pthread</span> --<span class="hljs-comment">extra</span><span class="hljs-literal">-</span><span class="hljs-comment">ldexeflags=</span> --<span class="hljs-comment">extra</span><span class="hljs-literal">-</span><span class="hljs-comment">libs=</span><span class="hljs-literal">-</span><span class="hljs-comment">lgomp</span> --<span class="hljs-comment">extra</span><span class="hljs-literal">-</span><span class="hljs-comment">version=20220324</span><br><span class="hljs-comment">libavutil</span>      <span class="hljs-comment">56</span><span class="hljs-string">.</span> <span class="hljs-comment">70</span><span class="hljs-string">.</span><span class="hljs-comment">100</span> <span class="hljs-comment">/</span> <span class="hljs-comment">56</span><span class="hljs-string">.</span> <span class="hljs-comment">70</span><span class="hljs-string">.</span><span class="hljs-comment">100</span><br><span class="hljs-comment">libavcodec</span>     <span class="hljs-comment">58</span><span class="hljs-string">.</span><span class="hljs-comment">134</span><span class="hljs-string">.</span><span class="hljs-comment">100</span> <span class="hljs-comment">/</span> <span class="hljs-comment">58</span><span class="hljs-string">.</span><span class="hljs-comment">134</span><span class="hljs-string">.</span><span class="hljs-comment">100</span><br><span class="hljs-comment">libavformat</span>    <span class="hljs-comment">58</span><span class="hljs-string">.</span> <span class="hljs-comment">76</span><span class="hljs-string">.</span><span class="hljs-comment">100</span> <span class="hljs-comment">/</span> <span class="hljs-comment">58</span><span class="hljs-string">.</span> <span class="hljs-comment">76</span><span class="hljs-string">.</span><span class="hljs-comment">100</span><br><span class="hljs-comment">libavdevice</span>    <span class="hljs-comment">58</span><span class="hljs-string">.</span> <span class="hljs-comment">13</span><span class="hljs-string">.</span><span class="hljs-comment">100</span> <span class="hljs-comment">/</span> <span class="hljs-comment">58</span><span class="hljs-string">.</span> <span class="hljs-comment">13</span><span class="hljs-string">.</span><span class="hljs-comment">100</span><br><span class="hljs-comment">libavfilter</span>     <span class="hljs-comment">7</span><span class="hljs-string">.</span><span class="hljs-comment">110</span><span class="hljs-string">.</span><span class="hljs-comment">100</span> <span class="hljs-comment">/</span>  <span class="hljs-comment">7</span><span class="hljs-string">.</span><span class="hljs-comment">110</span><span class="hljs-string">.</span><span class="hljs-comment">100</span><br><span class="hljs-comment">libswscale</span>      <span class="hljs-comment">5</span><span class="hljs-string">.</span>  <span class="hljs-comment">9</span><span class="hljs-string">.</span><span class="hljs-comment">100</span> <span class="hljs-comment">/</span>  <span class="hljs-comment">5</span><span class="hljs-string">.</span>  <span class="hljs-comment">9</span><span class="hljs-string">.</span><span class="hljs-comment">100</span><br><span class="hljs-comment">libswresample</span>   <span class="hljs-comment">3</span><span class="hljs-string">.</span>  <span class="hljs-comment">9</span><span class="hljs-string">.</span><span class="hljs-comment">100</span> <span class="hljs-comment">/</span>  <span class="hljs-comment">3</span><span class="hljs-string">.</span>  <span class="hljs-comment">9</span><span class="hljs-string">.</span><span class="hljs-comment">100</span><br><span class="hljs-comment">libpostproc</span>    <span class="hljs-comment">55</span><span class="hljs-string">.</span>  <span class="hljs-comment">9</span><span class="hljs-string">.</span><span class="hljs-comment">100</span> <span class="hljs-comment">/</span> <span class="hljs-comment">55</span><span class="hljs-string">.</span>  <span class="hljs-comment">9</span><span class="hljs-string">.</span><span class="hljs-comment">100</span><br></code></pre></td></tr></table></figure>


<h3 id="Linux-安装"><a href="#Linux-安装" class="headerlink" title="Linux 安装"></a>Linux 安装</h3><ul>
<li>官网下载地址：<a href="https://www.johnvansickle.com/ffmpeg/old-releases/" target="_blank" rel="noopener">https://www.johnvansickle.com/ffmpeg/old-releases/</a></li>
</ul>
<p>1、下载解压</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">wget http:<span class="hljs-comment">//www.ffmpeg.org/releases/ffmpeg-3.1.tar.gz</span><br>tar -xvf ffmpeg<span class="hljs-number">-3.1</span>.tar.gz<br></code></pre></td></tr></table></figure>

<p>2、 进入解压后目录,输入如下命令&#x2F;usr&#x2F;local&#x2F;ffmpeg为自己指定的安装目录</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gauss">cd ffmpeg<span class="hljs-number">-3.1</span><br>./configure --prefix=/usr/<span class="hljs-keyword">local</span>/ffmpeg<br><span class="hljs-built_in">make</span> &amp;&amp; <span class="hljs-built_in">make</span> install<br></code></pre></td></tr></table></figure>

<p>3、配置变量</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">vi /etc/profile<br><span class="hljs-comment"># 在最后PATH添加环境变量：</span><br><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">PATH</span>=<span class="hljs-variable">$PATH</span>:/usr/local/ffmpeg/bin<br><br><span class="hljs-comment"># 保存退出，查看是否生效</span><br><span class="hljs-comment"># 设置生效</span><br>source /ect/profile<br></code></pre></td></tr></table></figure>

<p>4、查看版本</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">ffmpeg -<span class="hljs-built_in">version</span>    查看版本<br></code></pre></td></tr></table></figure>

<p>注意：</p>
<p>若安装过程中出现以下错误：</p>
<blockquote>
<p>yasm&#x2F;nasm not found or too old. Use –disable-yasm for a crippled build. If you think configure made a mistake, make sure you are using the latest version from Git. If the latest version fails, report the problem to the <a href="mailto:&#x66;&#x66;&#109;&#112;&#101;&#x67;&#x2d;&#117;&#x73;&#x65;&#x72;&#x40;&#x66;&#x66;&#x6d;&#x70;&#x65;&#103;&#x2e;&#111;&#x72;&#x67;">&#x66;&#x66;&#109;&#112;&#101;&#x67;&#x2d;&#117;&#x73;&#x65;&#x72;&#x40;&#x66;&#x66;&#x6d;&#x70;&#x65;&#103;&#x2e;&#111;&#x72;&#x67;</a> mailing list or IRC #ffmpeg on irc.freenode.net. Include the log file “config.log” produced by configure as this will help solve the problem.</p>
</blockquote>
<p>需要安装 yasm</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">wget http:<span class="hljs-comment">//www.tortall.net/projects/yasm/releases/yasm-1.3.0.tar.gz</span><br>tar -zxvf yasm<span class="hljs-number">-1.3</span><span class="hljs-number">.0</span>.tar.gz<br>cd yasm<span class="hljs-number">-1.3</span><span class="hljs-number">.0</span><br>./configure<br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure>


<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="0-命令格式"><a href="#0-命令格式" class="headerlink" title="0.命令格式"></a>0.命令格式</h3><blockquote>
<p>基本使用方式：ffmpeg [[options][`-i’ input_file]] {[options] output_file}</p>
</blockquote>
<h4 id="通用选项"><a href="#通用选项" class="headerlink" title="通用选项"></a>通用选项</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs haml">-<span class="ruby">L license</span><br><span class="ruby">-h 帮助</span><br><span class="ruby">-fromats 显示可用的格式，编解码的，协议的。。。</span><br><span class="ruby">-f 设定输出格式：</span><br><span class="ruby">    -f fmt 强迫采用格式fmt</span><br><br><span class="ruby">-i filename 输入流</span><br><span class="ruby">-y 覆盖输出文件（即如果test.***文件已经存在的话，不经提示就覆盖掉了）</span><br><span class="ruby">-t duration 设置纪录时间 <span class="hljs-symbol">hh:</span><span class="hljs-symbol">mm:</span>ss[.xxx]格式的记录时间也支持</span><br><span class="ruby">-ss position 任务开始的时间 [-]<span class="hljs-symbol">hh:</span><span class="hljs-symbol">mm:</span>ss[.xxx]的格式也支持。</span><br><span class="ruby">    使用-ss参数的作用，可以从指定时间点开始转换任务，-ss后的时间单位为秒</span><br><br><span class="ruby">-title string 设置标题（比如PSP中显示影片的标题）</span><br><span class="ruby">-author string 设置作者</span><br><span class="ruby">-copyright string 设置版权</span><br><span class="ruby">-comment string 设置评论</span><br><span class="ruby">-target type 设置目标文件类型(vcd,svcd,dvd) 所有的格式选项（比特率，编解码以及缓冲区大小）自动设置 ，只需要输入如下的就可以了</span><br><span class="ruby">    ffmpeg -i myfile.avi -target vcd vcd.mpg</span><br><br><span class="ruby">-hq 激活高质量设置</span><br><span class="ruby">-itsoffset offset 设置以秒为基准的时间偏移，该选项影响所有后面的输入文件。该偏移被加到输入文件的时戳，定义一个正偏移意味着相应的流被延迟了 offset秒。 [-]<span class="hljs-symbol">hh:</span><span class="hljs-symbol">mm:</span>ss[.xxx]的格式也支持。</span><br></code></pre></td></tr></table></figure>

<h4 id="视频选项"><a href="#视频选项" class="headerlink" title="视频选项"></a>视频选项</h4><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-b bitrate 设置比特率，视频流量(码率)，缺省200kb/s</span><br><span class="hljs-deletion">-vb bitrate   set bitrate (in bits/s)</span><br><span class="hljs-deletion">-vframes number  设置要编码多少帧 </span><br><span class="hljs-deletion">-r fps 设置帧频，帧速率， 缺省25</span><br><span class="hljs-deletion">-s size 设定画面的宽与高，帧大小 格式为W*H 缺省160X128.也可以直接使用简写，也认：Sqcif  qcif  cif 4cif 等</span><br><span class="hljs-deletion">-aspect aspect 设置横纵比 4:3 16:9 或 1.3333 1.7777</span><br><span class="hljs-deletion">-croptop size 设置顶部切除带大小 像素单位</span><br><span class="hljs-deletion">-cropbottom size -cropleft size -cropright size</span><br><span class="hljs-deletion">-padtop size 设置顶部补齐的大小 像素单位</span><br><span class="hljs-deletion">-padbottom size -padleft size -padright size -padcolor color 设置补齐条颜色(hex,6个16进制的数，红:绿:兰排列，比如 000000代表黑色)</span><br><span class="hljs-deletion">-vn 不做视频记录，不处理视频</span><br><span class="hljs-deletion">-bt tolerance 设置视频码率容忍度kbit/s （固定误差）</span><br><span class="hljs-deletion">-maxrate bitrate设置最大视频码率容忍度 （可变误差）</span><br><span class="hljs-deletion">-minrate bitreate 设置最小视频码率容忍度（可变误差）</span><br><span class="hljs-deletion">-bufsize size 设置码率控制缓冲区大小</span><br><span class="hljs-deletion">-vcodec codec 强制使用codec编解码方式，如-vcodec xvid 使用xvid压缩 如果用copy表示原始编解码数据必须被拷贝。</span><br><span class="hljs-deletion">-sameq 使用同样视频质量作为源（VBR）</span><br><span class="hljs-deletion">-pass n 选择处理遍数（1或者2）。两遍编码非常有用。第一遍生成统计信息，第二遍生成精确的请求的码率</span><br><span class="hljs-deletion">-passlogfile file 选择两遍的纪录文件名为file</span><br></code></pre></td></tr></table></figure>

<h4 id="高级视频选项"><a href="#高级视频选项" class="headerlink" title="高级视频选项"></a>高级视频选项</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">-g gop_size 设置图像组大小 这里设置GOP大小，也表示两个I帧之间的间隔<br>-<span class="hljs-built_in">int</span>ra 仅适用帧内编码<br>-qscale q  使用固定的视频量化标度(VBR)  以&lt;q&gt;质量为基础的VBR，取值<span class="hljs-number">0.01</span><span class="hljs-number">-255</span>，约小质量越好，即qscale <span class="hljs-number">4</span>和-qscale <span class="hljs-number">6</span>，<span class="hljs-number">4</span>的质量比<span class="hljs-number">6</span>高 。此参数使用次数较多，实际使用时发现，qscale是种固定量化因子，设置qscale之后，前面设置的-b好像就无效了，而是自动调整了比特率。<br>-qmin q 最小视频量化标度(VBR) 设定最小质量，与-qmax（设定最大质量）共用<br>-qmax q 最大视频量化标度(VBR) 使用了该参数，就可以不使用qscale参数<br>-qdiff q 量化标度间最大偏差 (VBR)<br>-qblur blur 视频量化标度柔化(VBR)<br>-qcomp compression 视频量化标度压缩(VBR)<br>-rc_init_cplx complexity 一遍编码的初始复杂度<br>-b_qfactor factor 在p和b帧间的qp因子<br>-i_qfactor factor 在p和i帧间的qp因子<br>-b_qoffset offset 在p和b帧间的qp偏差<br>-i_qoffset offset 在p和i帧间的qp偏差<br>-rc_eq equation 设置码率控制方程 默认tex^qComp<br>-rc_override <span class="hljs-keyword">override</span> 特定间隔下的速率控制重载<br>-me method 设置运动估计的方法 可用方法有 zero phods log x1 epzs(缺省) full<br>-dct_algo algo 设置dct的算法 可用：<br>    <span class="hljs-number">0</span> FF_DCT_AUTO 缺省的DCT <br>    <span class="hljs-number">1</span> FF_DCT_FASTINT<br>    <span class="hljs-number">2</span> FF_DCT_INT<br>    <span class="hljs-number">3</span> FF_DCT_MMX<br>    <span class="hljs-number">4</span> FF_DCT_MLIB<br>    <span class="hljs-number">5</span> FF_DCT_ALTIVEC<br><br>-idct_algo algo 设置idct算法。可用的有：<br>    <span class="hljs-number">0</span> FF_IDCT_AUTO 缺省的IDCT<br>    <span class="hljs-number">1</span> FF_IDCT_INT <br>    <span class="hljs-number">2</span> FF_IDCT_SIMPLE <br>    <span class="hljs-number">3</span> FF_IDCT_SIMPLEMMX <br>    <span class="hljs-number">4</span> FF_IDCT_LIBMPEG2MMX<br>    <span class="hljs-number">5</span> FF_IDCT_PS2 <br>    <span class="hljs-number">6</span> FF_IDCT_MLIB<br>    <span class="hljs-number">7</span> FF_IDCT_ARM<br>    <span class="hljs-number">8</span> FF_IDCT_ALTIVEC<br>    <span class="hljs-number">9</span> FF_IDCT_SH4<br>    <span class="hljs-number">10</span> FF_IDCT_SIMPLEARM<br><br>-er n 设置错误残留为n<br>    <span class="hljs-number">1</span> FF_ER_CAREFULL 缺省<br>    <span class="hljs-number">2</span> FF_ER_COMPLIANT<br>    <span class="hljs-number">3</span> FF_ER_AGGRESSIVE<br>    <span class="hljs-number">4</span> FF_ER_VERY_AGGRESSIVE<br><br>-ec bit_mask 设置错误掩蔽为bit_mask,该值为如下值的位掩码 <span class="hljs-number">1</span> FF_EC_GUESS_MVS (<span class="hljs-keyword">default</span>=enabled) <span class="hljs-number">2</span> FF_EC_DEBLOCK (<span class="hljs-keyword">default</span>=enabled)<br>-bf frames 使用frames个B 帧，支持mpeg1,mpeg2,mpeg4（即如果-bf <span class="hljs-number">2</span>的话，在两个非b帧中间隔的b帧数目为<span class="hljs-number">2</span>，即IBBPBBPBBP结构）<br>-mbd mode 宏块决策<br>    <span class="hljs-number">0</span> FF_MB_DECISION_SIMPLE 使用mb_cmp<br>    <span class="hljs-number">1</span> FF_MB_DECISION_BITS <span class="hljs-number">2</span> FF_MB_DECISION_RD<br><br><span class="hljs-number">-4</span>mv 使用<span class="hljs-number">4</span>个运动矢量 仅用于mpeg4<br>-part 使用数据划分 仅用于mpeg4<br>-bug param 绕过没有被自动监测到编码器的问题<br>-strict strictness 跟标准的严格性<br>-aic 使能高级帧内编码 h263+<br>-umv 使能无限运动矢量 h263+<br>-deinterlace 不采用交织方法<br>-<span class="hljs-built_in">int</span>erlace 强迫交织法编码 仅对mpeg2和mpeg4有效。当你的输入是交织的并且你想要保持交织以最小图像损失的时候采用该选项。可选的方法是不交织，但是损失更大<br>-psnr 计算压缩帧的psnr<br>-vstats 输出视频编码统计到vstats_hhmmss.log<br>-vhook module 插入视频处理模块 module 包括了模块名和参数，用空格分开<br>-bitexact 使用标准比特率<br>-max_qdiff  视频中所有桢（包括i/b/P）的最大Q值差距<br>-b_qfactor 表示i/p与B的Q值比例因子,值越大B桢劣化越严重<br>-b_qoffset 表示<span class="hljs-number">1</span>/p与B的Q值比例的偏移量,值越大B桢劣化越严重.如果大于<span class="hljs-number">0</span>,那么下一个B的Q=前一个P的Q乘以b_quant_factor再加上offset,如果小于<span class="hljs-number">0</span>,则B的Q=负的normal_Q乘以factor加上offset.<br>-i_qfactor   p和i的Q值比例因子,越接近<span class="hljs-number">1</span>则P越优化.<br>-i_qoffset   p和i的Q的偏移量<br></code></pre></td></tr></table></figure>


<h4 id="音频选项"><a href="#音频选项" class="headerlink" title="音频选项"></a>音频选项</h4><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs haml">-<span class="ruby">ab bitrate 设置音频码率</span><br><span class="ruby">-ar freq 设置音频采样率</span><br><span class="ruby">-ac channels 设置通道 缺省为<span class="hljs-number">1</span>，即单通道</span><br><span class="ruby">-an 不使能音频纪录，不处理音频</span><br><span class="ruby">-acodec 设定声音编解码器，未设定时则使用与输入流相同的编解码器 </span><br><span class="ruby">    -acodec codec 使用codec编解码 </span><br><span class="ruby">    -acodec AAC 使用AAC音频编码</span><br><span class="ruby">    -acodec copy 使用源格式编解码</span><br></code></pre></td></tr></table></figure>


<h3 id="1-视频格式转换"><a href="#1-视频格式转换" class="headerlink" title="1. 视频格式转换"></a>1. 视频格式转换</h3><p><strong>（其实格式转换说法不太准确，但大家都这么叫，准确的说，应该是视频容器转换）</strong>  </p>
<p>比如一个avi文件，想转为mp4，或者一个mp4想转为ts。  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ffmpeg -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.avi</span> output.mp4<br>ffmpeg -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span> output.ts<br></code></pre></td></tr></table></figure>

<h3 id="2-保存-m3u8-类型文件"><a href="#2-保存-m3u8-类型文件" class="headerlink" title="2 保存 m3u8 类型文件"></a>2 保存 m3u8 类型文件</h3><p>某天我在知乎上看到一段视频，想转给微信好友看，怎么操作呢。</p>
<p>参考<a href="https://baijiahao.baidu.com/s?id=1595252673329058399&wfr=spider&for=pc" target="_blank" rel="noopener">如何全自动下载知乎上的视频到本地(注意不要滥用)</a></p>
<p>先打开要观看的视频页面，再F12清空，然后开始播放视频，不用理会那堆TS文件，我们只需找出来类似这种 <code>https://vdn.vzuu.com/Act-ss-m3u8......</code> 链接即可，m3u8是里面的关键文件，关于m3u8大家可以自网上行搜索.</p>
<p>这是一种将零散的视频资源组织起来的视频格式，也就是说那几十一百个TS文件都被这一个m3u8文件管理起来了，我们只需要找到其中的m3u8，FFmpeg就可以帮我们自动下载好全部的ts文件并按顺序合并成一个视频！对整个过程都是全自动，命令行界面输入</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">ffmpeg - i <span class="hljs-string">"href="</span>http<span class="hljs-variable">s:</span>//vdn.vzuu.<span class="hljs-keyword">com</span>/Act-ss-m3u8/(此处省略后面)<span class="hljs-comment">" test.mp4</span><br></code></pre></td></tr></table></figure>

<p>一杯茶的时间，最终的视频就会生成在你打开命令行所在的文件夹下</p>
<h3 id="3-提取音频"><a href="#3-提取音频" class="headerlink" title="3. 提取音频"></a>3. 提取音频</h3><p>比如我有一个“晓松奇谈”，可是我不想看到他的脸，我只想听声音， 地铁上可以听，咋办？  </p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vala">ffmpeg -i 晓松奇谈.mp4 -acodec copy -vn output.aac<br><span class="hljs-meta"># - vn 不处理视频</span><br><span class="hljs-meta"># -acodec 设定声音编解码器，未设定时则使用与输入流相同的编解码器 </span><br><span class="hljs-meta">#    -acodec codec 使用codec编解码 </span><br><span class="hljs-meta">#    -acodec AAC 使用AAC音频编码</span><br><span class="hljs-meta">#    -acodec copy 使用源格式编解码</span><br></code></pre></td></tr></table></figure>

<p>上面的命令，默认mp4的audio codec是aac，如果不是会出错，咱可以暴力一点，不管什么音频，都转为最常见的aac。  </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">ffmpeg</span> <span class="hljs-selector-tag">-i</span> 晓松奇谈<span class="hljs-selector-class">.mp4</span> <span class="hljs-selector-tag">-acodec</span> <span class="hljs-selector-tag">aac</span> <span class="hljs-selector-tag">-vn</span> <span class="hljs-selector-tag">output</span><span class="hljs-selector-class">.aac</span><br></code></pre></td></tr></table></figure>


<h3 id="4-提取视频"><a href="#4-提取视频" class="headerlink" title="4. 提取视频"></a>4. 提取视频</h3><p>有些IT员工，特别是做嵌入式的，比如机顶盒，想debug一下，没有音频的情况下，播放一个视频几天几夜会不会crash，这时候你需要一个纯视频文件，可以这么干。  </p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">ffmpeg -i input.mp4 -vcodec <span class="hljs-keyword">copy</span><span class="bash"> -an output.mp4</span><br><span class="hljs-comment"># -an 不处理音频</span><br></code></pre></td></tr></table></figure>


<h3 id="5-视频剪切"><a href="#5-视频剪切" class="headerlink" title="5. 视频剪切"></a>5. 视频剪切</h3><p>经常要测试视频，但是只需要测几秒钟，可是视频却有几个G，咋办？切啊！  </p>
<p>下面的命令，就可以从时间为00:00:15开始，截取5秒钟的视频。  </p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vala">ffmpeg -ss <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">15</span> -t <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">05</span> -i input.mp4 -vcodec copy -acodec copy output.mp4<br><span class="hljs-meta"># -vcodec 视频编码</span><br><span class="hljs-meta"># -acodec 音频编码</span><br><span class="hljs-meta"># -ss 表示开始切割的时间</span><br><span class="hljs-meta"># -t 表示要切多少。</span><br></code></pre></td></tr></table></figure>

<p>摘自<a href="https://zhuanlan.zhihu.com/p/26374202" target="_blank" rel="noopener">使用 MediaSource 搭建流式播放器</a></p>
<blockquote>
<p>注意一个问题，ffmpeg 在切割视频的时候无法做到时间绝对准确，因为视频编码中关键帧（I帧）和跟随它的B帧、P帧是无法分割开的，否则就需要进行重新帧内编码，会让视频体积增大。所以，如果切割的位置刚好在两个关键帧中间，那么 ffmpeg 会向前&#x2F;向后切割，所以最后切割出的 chunk 长度总是会大于等于应有的长度。</p>
</blockquote>
<h3 id="6-码率控制"><a href="#6-码率控制" class="headerlink" title="6. 码率控制"></a>6. 码率控制</h3><p>码率控制对于在线视频比较重要。因为在线视频需要考虑其能提供的带宽。</p>
<p>那么，什么是码率？很简单： <code>bitrate = file size / duration</code></p>
<p>比如一个文件20.8M，时长1分钟，那么，码率就是：</p>
<p><code>biterate = 20.8M bit/60s = 20.8*1024*1024*8 bit/60s= 2831Kbps</code>  </p>
<p>一般音频的码率只有固定几种，比如是128Kbps， 那么，video的就是  </p>
<p><code>video biterate = 2831Kbps -128Kbps = 2703Kbps。</code></p>
<p>说完背景了。好了，来说ffmpeg如何控制码率。 ffmpg控制码率有3种选择，<code>-minrate -b:v -maxrate</code></p>
<ul>
<li><p>-b:v主要是控制平均码率。 比如一个视频源的码率太高了，有10Mbps，文件太大，想把文件弄小一点，但是又不破坏分辨率。 <code>ffmpeg -i input.mp4 -b:v 2000k output.mp4</code>上面把码率从原码率转成2Mbps码率，这样其实也间接让文件变小了。目测接近一半。</p>
</li>
<li><p>不过，ffmpeg官方wiki比较建议，设置b:v时，同时加上 -bufsize<br>-bufsize 用于设置码率控制缓冲器的大小，设置的好处是，让整体的码率更趋近于希望的值，减少波动。（简单来说，比如1 2的平均值是1.5， 1.49 1.51 也是1.5, 当然是第二种比较好） <code>ffmpeg -i input.mp4 -b:v 2000k -bufsize 2000k output.mp4</code></p>
</li>
<li><p>-minrate -maxrate就简单了，在线视频有时候，希望码率波动，不要超过一个阈值，可以设置maxrate。<br><code>ffmpeg -i input.mp4 -b:v 2000k -bufsize 2000k -maxrate 2500k output.mp4</code></p>
</li>
</ul>
<h3 id="7-视频编码格式转换"><a href="#7-视频编码格式转换" class="headerlink" title="7. 视频编码格式转换"></a>7. 视频编码格式转换</h3><p>比如一个视频的编码是MPEG4，想用H264编码，咋办？  </p>
<p><code>ffmpeg -i input.mp4 -vcodec h264 output.mp4</code>  </p>
<p>相反也一样  </p>
<p><code>ffmpeg -i input.mp4 -vcodec mpeg4 output.mp4</code></p>
<p>当然了，如果ffmpeg当时编译时，添加了外部的x265或者X264，那也可以用外部的编码器来编码。（不知道什么是X265，可以Google一下，简单的说，就是她不包含在ffmpeg的源码里，是独立的一个开源代码，用于编码HEVC，ffmpeg编码时可以调用它。当然了，ffmpeg自己也有编码器）  </p>
<p><code>ffmpeg -i input.mp4 -c:v libx265 output.mp4</code><br><code>ffmpeg -i input.mp4 -c:v libx264 output.mp4</code></p>
<h3 id="8-只提取视频ES数据"><a href="#8-只提取视频ES数据" class="headerlink" title="8. 只提取视频ES数据"></a>8. 只提取视频ES数据</h3><p>这个可能做开发的人会用到，顺便提一下吧。  </p>
<p><code>ffmpeg –i input.mp4 –vcodec copy –an –f m4v output.h264</code></p>
<h3 id="9-过滤器的使用"><a href="#9-过滤器的使用" class="headerlink" title="9. 过滤器的使用"></a>9. 过滤器的使用</h3><p>这个我在另一篇博客提到了，具体参考<a href="https://blog.csdn.net/newchenxf/article/details/51364105" target="_blank" rel="noopener">ffmpeg filter过滤器 基础实例及全面解析</a></p>
<h4 id="9-1-将输入的1920x1080缩小到960x540输出"><a href="#9-1-将输入的1920x1080缩小到960x540输出" class="headerlink" title="9.1 将输入的1920x1080缩小到960x540输出:"></a>9.1 将输入的1920x1080缩小到960x540输出:</h4><p><code>ffmpeg -i input.mp4 -vf scale=960:540 output.mp4</code>  </p>
<p>&#x2F;&#x2F;ps: 如果540不写，写成-1，即scale&#x3D;960:-1, 那也是可以的，ffmpeg会通知缩放滤镜在输出时保持原始的宽高比。</p>
<h4 id="9-2-为视频添加logo"><a href="#9-2-为视频添加logo" class="headerlink" title="9.2 为视频添加logo"></a>9.2 为视频添加logo</h4><p>比如，我有这么一个图片  </p>
<p><img src="/img/ffmpeg01.jpg" srcset="/img/loading.gif" lazyload></p>
<p>想要贴到一个视频上，那可以用如下命令：  </p>
<p><code>./ffmpeg -i input.mp4 -i iQIYI_logo.png -filter_complex overlay output.mp4</code>  </p>
<p>结果如下所示：  </p>
<p><img src="/img/ffmpeg02.jpg" srcset="/img/loading.gif" lazyload></p>
<h3 id="10-抓取视频的一些帧，存为jpeg图片"><a href="#10-抓取视频的一些帧，存为jpeg图片" class="headerlink" title="10. 抓取视频的一些帧，存为jpeg图片"></a>10. 抓取视频的一些帧，存为jpeg图片</h3><p>比如，一个视频，我想提取一些帧，存为图片，咋办？  </p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">ffmpeg -i input.mp4 -r <span class="hljs-number">1</span> -q:v <span class="hljs-number">2</span> -f image2 pic-%<span class="hljs-number">03</span>d.jpeg<br><br># -r 表示每一秒几帧<br># -q:v表示存储jpeg的图像质量，一般<span class="hljs-number">2</span>是高质量。<br></code></pre></td></tr></table></figure>

<p>如此，ffmpeg会把input.mp4，每隔一秒，存一张图片下来。假设有60s，那会有60张。60张？什么？这么多？不要不要。。。。。不要咋办？？ 可以设置开始的时间，和你想要截取的时间呀。  </p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">ffmpeg -i input.mp4 -ss <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">20</span> -t <span class="hljs-number">10</span> -r <span class="hljs-number">1</span> -q:v <span class="hljs-number">2</span> -f image2 pic-%<span class="hljs-number">03</span>d.jpeg<br># -ss 表示开始时间  <br># -t表示共要多少时间。<br></code></pre></td></tr></table></figure>

<p>如此，ffmpeg会从input.mp4的第20s时间开始，往下10s，即20~30s这10秒钟之间，每隔1s就抓一帧，总共会抓10帧。</p>
<h3 id="11-输出YUV420原始数据"><a href="#11-输出YUV420原始数据" class="headerlink" title="11.输出YUV420原始数据"></a>11.输出YUV420原始数据</h3><p>对于做底层编解码的人来说，有时候常要提取视频的YUV原始数据。 怎么做？很简单： <code>ffmpeg -i input.mp4 output.yuv</code>怎么样，是不是太简单啦？！！！哈哈(如果你想问yuv的数据，如何播放，我不会告诉你，RawPlayer挺好用的！！)</p>
<p>那如果我只想要抽取某一帧YUV呢？ 简单，你先用上面的方法，先抽出jpeg图片，然后把jpeg转为YUV。 比如： 你先抽取10帧图片。 <code>ffmpeg -i input.mp4 -ss 00:00:20 -t 10 -r 1 -q:v 2 -f image2 pic-%03d.jpeg</code>  </p>
<p>结果：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">-rw-rw-r-- <span class="hljs-number">1</span> chenxf chenxf    <span class="hljs-number">296254</span>  <span class="hljs-number">7</span>月 <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">08</span> pic<span class="hljs-number">-001.</span>jpeg<br>-rw-rw-r-- <span class="hljs-number">1</span> chenxf chenxf    <span class="hljs-number">300975</span>  <span class="hljs-number">7</span>月 <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">08</span> pic<span class="hljs-number">-002.</span>jpeg<br>-rw-rw-r-- <span class="hljs-number">1</span> chenxf chenxf    <span class="hljs-number">310130</span>  <span class="hljs-number">7</span>月 <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">08</span> pic<span class="hljs-number">-003.</span>jpeg<br>-rw-rw-r-- <span class="hljs-number">1</span> chenxf chenxf    <span class="hljs-number">268694</span>  <span class="hljs-number">7</span>月 <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">08</span> pic<span class="hljs-number">-004.</span>jpeg<br>-rw-rw-r-- <span class="hljs-number">1</span> chenxf chenxf    <span class="hljs-number">301056</span>  <span class="hljs-number">7</span>月 <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">08</span> pic<span class="hljs-number">-005.</span>jpeg<br>-rw-rw-r-- <span class="hljs-number">1</span> chenxf chenxf    <span class="hljs-number">293927</span>  <span class="hljs-number">7</span>月 <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">08</span> pic<span class="hljs-number">-006.</span>jpeg<br>-rw-rw-r-- <span class="hljs-number">1</span> chenxf chenxf    <span class="hljs-number">340295</span>  <span class="hljs-number">7</span>月 <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">08</span> pic<span class="hljs-number">-007.</span>jpeg<br>-rw-rw-r-- <span class="hljs-number">1</span> chenxf chenxf    <span class="hljs-number">430787</span>  <span class="hljs-number">7</span>月 <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">08</span> pic<span class="hljs-number">-008.</span>jpeg<br>-rw-rw-r-- <span class="hljs-number">1</span> chenxf chenxf    <span class="hljs-number">404552</span>  <span class="hljs-number">7</span>月 <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">08</span> pic<span class="hljs-number">-009.</span>jpeg<br>-rw-rw-r-- <span class="hljs-number">1</span> chenxf chenxf    <span class="hljs-number">412691</span>  <span class="hljs-number">7</span>月 <span class="hljs-number">20</span> <span class="hljs-number">16</span>:<span class="hljs-number">08</span> pic<span class="hljs-number">-010.</span>jpeg<br></code></pre></td></tr></table></figure>

<p>然后，你就随便挑一张，转为YUV: <code>ffmpeg -i pic-001.jpeg -s 1440x1440 -pix_fmt yuv420p xxx3.yuv</code>如果-s参数不写，则输出大小与输入一样。当然了，YUV还有yuv422p啥的，你在-pix_fmt 换成yuv422p就行啦！</p>
<h3 id="12-H264编码profile-amp-level控制"><a href="#12-H264编码profile-amp-level控制" class="headerlink" title="12.H264编码profile &amp; level控制"></a>12.H264编码profile &amp; level控制</h3><p>举3个例子吧</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">ffmpeg</span> <span class="hljs-selector-tag">-i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span> <span class="hljs-selector-tag">-profile</span><span class="hljs-selector-pseudo">:v</span> <span class="hljs-selector-tag">baseline</span> <span class="hljs-selector-tag">-level</span> 3<span class="hljs-selector-class">.0</span> <span class="hljs-selector-tag">output</span><span class="hljs-selector-class">.mp4</span><br><span class="hljs-selector-tag">ffmpeg</span> <span class="hljs-selector-tag">-i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span> <span class="hljs-selector-tag">-profile</span><span class="hljs-selector-pseudo">:v</span> <span class="hljs-selector-tag">main</span> <span class="hljs-selector-tag">-level</span> 4<span class="hljs-selector-class">.2</span> <span class="hljs-selector-tag">output</span><span class="hljs-selector-class">.mp4</span><br><span class="hljs-selector-tag">ffmpeg</span> <span class="hljs-selector-tag">-i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span> <span class="hljs-selector-tag">-profile</span><span class="hljs-selector-pseudo">:v</span> <span class="hljs-selector-tag">high</span> <span class="hljs-selector-tag">-level</span> 5<span class="hljs-selector-class">.1</span> <span class="hljs-selector-tag">output</span><span class="hljs-selector-class">.mp4</span><br></code></pre></td></tr></table></figure>

<p>如果ffmpeg编译时加了external的libx264，那就这么写：  </p>
<p><code>ffmpeg -i input.mp4 -c:v libx264 -x264-params &quot;profile=high:level=3.0&quot; output.mp4</code>  </p>
<p>从压缩比例来说，baseline&lt; main &lt; high，对于带宽比较局限的在线视频，可能会选择high，但有些时候，做个小视频，希望所有的设备基本都能解码（有些低端设备或早期的设备只能解码baseline），那就牺牲文件大小吧，用baseline。自己取舍吧！</p>
<h3 id="13-旋转视频"><a href="#13-旋转视频" class="headerlink" title="13.旋转视频"></a>13.旋转视频</h3><p>在手机上录的视频，在电脑放，是颠倒的，需要旋转90度。使用格式工厂失败了……  </p>
<p>参考<a href="https://blog.csdn.net/yu540135101/article/details/94481549" target="_blank" rel="noopener">ffmpeg视频的翻转vflip、hflip，旋转rotate、transpose</a>  </p>
<p>使用<code>ffmpeg -i 3.mp4 -vf rotate=PI/2 rotate8.mp4</code>画面确实旋转过来了，但是尺寸不对，变成横屏后，两侧的画面看不到了。改用<code>ffmpeg -i 3.mp4 -vf transpose=1 rotate8.mp4</code>解决了问题</p>
<h3 id="14-dshow"><a href="#14-dshow" class="headerlink" title="14.dshow"></a>14.dshow</h3><p>参考<a href="https://blog.csdn.net/ai2000ai/article/details/82150546" target="_blank" rel="noopener">FFMPEG学习（一）—【命令行】采集视频和音频</a>  </p>
<p>Windows DirectShow输入设备,用于采集windows下的视频和音频设备。  </p>
<p>通过命令 <code>ffmpeg -list_devices true -f dshow -i dummy</code> 查看支持的设备列表，包含设备名称，设备类型等信息。  </p>
<p>得到如下结果</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-selector-attr">[dshow @ 0000022890f18f40]</span> DirectShow <span class="hljs-selector-tag">video</span> devices (some may be both <span class="hljs-selector-tag">video</span> and <span class="hljs-selector-tag">audio</span> devices)<br><span class="hljs-selector-attr">[dshow @ 0000022890f18f40]</span>  "HP TrueVision HD Camera"<br><span class="hljs-selector-attr">[dshow @ 0000022890f18f40]</span>     Alternative name "<span class="hljs-keyword">@device</span>_pnp_\\?<br>\usb#vid_0408&amp;pid_5365&amp;mi_00<span class="hljs-number">#6</span>&amp;<span class="hljs-number">193</span>fc2d2&amp;<span class="hljs-number">0</span>&amp;<span class="hljs-number">0000</span>#&#123;65e8773d-8f56-11d0-a3b9-00a0c9223196&#125;\global"<br><span class="hljs-selector-attr">[dshow @ 0000022890f18f40]</span> DirectShow <span class="hljs-selector-tag">audio</span> devices<br><span class="hljs-selector-attr">[dshow @ 0000022890f18f40]</span>  "麦克风阵列 (英特尔® 智音技术)"<br><span class="hljs-selector-attr">[dshow @ 0000022890f18f40]</span>     Alternative name "<span class="hljs-keyword">@device</span>_cm_&#123;33D9A762-90C8-11D0-BD43-<br>00A0C911CE86&#125;\wave_&#123;1F376599-992B-457F-A4B1-45C06BD5C148&#125;"<br>dummy: Immediate exit requested<br></code></pre></td></tr></table></figure>

<p>使用以下命令录制视频或音频，按Q可以停止。</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crystal">ffmpeg -f dshow -i video=<span class="hljs-string">"HP TrueVision HD Camera"</span> -vcodec libx264 <span class="hljs-number">0</span>01.mp4<br>ffmpeg -f dshow -i audio=<span class="hljs-string">"麦克风阵列 (英特尔® 智音技术)"</span>  -ar <span class="hljs-number">16000</span> -ac <span class="hljs-number">1</span> <span class="hljs-class"><span class="hljs-keyword">lib</span>.<span class="hljs-title">wav</span></span><br></code></pre></td></tr></table></figure>

<p>音视频联合录制</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ffmpeg -f dshow -<span class="hljs-selector-tag">i</span> video=<span class="hljs-string">"HP TrueVision HD Camera"</span>:audio=<span class="hljs-string">"麦克风阵列 (英特尔® 智音技术)"</span> <br>-s <span class="hljs-number">640</span>x360 -<span class="hljs-selector-tag">b</span>:v <span class="hljs-number">1000</span>k -<span class="hljs-selector-tag">b</span>:<span class="hljs-selector-tag">a</span> <span class="hljs-number">128</span>k output.mkv<br></code></pre></td></tr></table></figure>

<p>音视频推流</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy">ffmpeg -f dshow -i video=<span class="hljs-string">"HP TrueVision HD Camera"</span>:audio=<span class="hljs-string">"麦克风阵列 (英特尔® 智音技术)"</span> <br>-vcodec libx264 -r <span class="hljs-number">25</span> -<span class="hljs-string">preset:</span>v ultrafast -<span class="hljs-string">tune:</span>v zerolatency -f rtsp <span class="hljs-string">rtsp:</span><span class="hljs-comment">//127.0.0.1/test</span><br></code></pre></td></tr></table></figure>

<h3 id="15-FFmpeg使用gdigrab采集窗口"><a href="#15-FFmpeg使用gdigrab采集窗口" class="headerlink" title="15.FFmpeg使用gdigrab采集窗口"></a>15.FFmpeg使用gdigrab采集窗口</h3><p><a href="https://www.jianshu.com/p/a70afe5bf229" target="_blank" rel="noopener">FFmpeg采集设备（3）</a></p>
<h2 id="三、小丸工具箱"><a href="#三、小丸工具箱" class="headerlink" title="三、小丸工具箱"></a>三、<a href="https://maruko.appinn.me/index.html#" target="_blank" rel="noopener">小丸工具箱</a></h2><p>小丸工具箱是一款用于处理音视频等多媒体文件的软件。是一款x264、ffmpeg等命令行程序的图形界面。它的目标是让视频压制变得简单、轻松。</p>
<p>主要功能：</p>
<ul>
<li>高质量的H264+AAC视频压制</li>
<li>ASS&#x2F;SRT字幕内嵌到视频</li>
<li>AAC&#x2F;WAV&#x2F;FLAC&#x2F;ALAC音频转换</li>
<li>MP4&#x2F;MKV&#x2F;FLV的无损抽取和封装</li>
</ul>
<blockquote>
<p>参考自<a href="https://www.cnbeining.com/2013/11/how-do-i-report-an-error/" target="_blank" rel="noopener">小丸FAQ</a>：小丸工具箱是一个x264(taro编译版,现在是7mod)、MP4Box、ffmpeg、MediaInfo等软件的GUI。工具箱只是一个调用其他程序的程序，自己没有压制功能！只是把平常需要命令行完成的工作图形化了！其实一切转换软件都是这个意思。</p>
</blockquote>
<h2 id="四、fluent-ffmpeg"><a href="#四、fluent-ffmpeg" class="headerlink" title="四、fluent-ffmpeg"></a>四、<a href="https://www.npmjs.com/package/fluent-ffmpeg-extended" target="_blank" rel="noopener">fluent-ffmpeg</a></h2><p>参考自  </p>
<ul>
<li><a href="https://www.bilibili.com/read/cv859" target="_blank" rel="noopener">[FFmpeg探秘]Ep.(1) 什么是FFmpeg?</a>  </li>
<li><a href="https://www.bilibili.com/read/cv1073" target="_blank" rel="noopener">[FFmpeg探秘]Ep.(2) 从node-fluent-ffmpeg开始</a>  </li>
<li><a href="https://segmentfault.com/a/1190000012049916" target="_blank" rel="noopener">NODEJS基于FFMPEG视频推流测试</a></li>
</ul>
<p>该nodejs包封装了ffmpeg的命令行调用部分,加强了代码的可读性,若熟悉ffmpeg 命令行使用手册,亦可不使用该包。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">npm install --save fluent-ffmpeg<br><span class="hljs-comment">//使用js编码的用户,可以忽略下条命令</span><br>npm install --save <span class="hljs-meta">@types</span>/fluent-ffmpeg<br></code></pre></td></tr></table></figure>


<h2 id="五、使用ffmpeg推RTMP直播流"><a href="#五、使用ffmpeg推RTMP直播流" class="headerlink" title="五、使用ffmpeg推RTMP直播流"></a>五、使用ffmpeg推RTMP直播流</h2><p>1.安装nignx环境  </p>
<p>参考<a href="https://www.jianshu.com/p/43a3bd817f1f" target="_blank" rel="noopener">windows使用nginx配置rtmp,hls,httpflv</a></p>
<p>2.参考<a href="https://www.jianshu.com/p/06c2025edcd3" target="_blank" rel="noopener">手把手教你搭建Nginx-rtmp流媒体服务器+使用ffmpeg推流</a>  </p>
<p>在上述下载的demo中，看一下conf&#x2F;nginx.conf配置文件：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs csharp">rtmp &#123;<br>    server &#123;<br>        listen <span class="hljs-number">1935</span>;<br><br>        application live &#123;<br>            live <span class="hljs-keyword">on</span>;<br>        &#125;<br>        <br>        application vod &#123;<br>            play video;<br>        &#125;<br>        <br>        application hls &#123;<br>            live <span class="hljs-keyword">on</span>;<br>            hls <span class="hljs-keyword">on</span>;  <br>            hls_path temp/hls;  <br>            hls_fragment <span class="hljs-number">8</span>s;  <br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>其中rtmp就是rtmp服务器模块，端口是1935，application我理解为一个路径。可以通过访问<code>rtmp://localhost/live</code>来访问live这个资源。live on 表示这是实时的传输，这不同于点播，点播就好比我在某视频网站上想看一个视频，无论我什么时候去点击，它会从头开始播放。而实时传输（直播），就是好比看电视，我在19:20去打开电视（打开直播路），视频不会从头开始播放，而是从当前(19:20)的视频数据开始播放。</p>
<p>然后在nginx.exe路径下命令行运行nginx -s reload重新加载配置。</p>
<p>3.使用ffmpeg推流  </p>
<p>参考<a href="https://zhuanlan.zhihu.com/p/23951969" target="_blank" rel="noopener">使用FFmpeg在B站直播的姿势</a>  </p>
<p><code>ffmpeg -re -i 1.mp4 -vcodec copy -f flv rtmp://localhost/live</code>  </p>
<p>或者</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ffmpeg -re -<span class="hljs-selector-tag">i</span> <span class="hljs-number">1</span><span class="hljs-selector-class">.mp4</span> -vcodec copy -acodec copy<br> -<span class="hljs-selector-tag">b</span>:v <span class="hljs-number">800</span>k -<span class="hljs-selector-tag">b</span>:<span class="hljs-selector-tag">a</span> <span class="hljs-number">32</span>k -f flv rtmp:<span class="hljs-comment">//localhost/live</span><br></code></pre></td></tr></table></figure>

<p>-re : <strong>表示使用文件的原始帧率进行读取，因为ffmpeg读取视频帧的速度很快，如果不使用这个参数，ffmpeg可以在很短时间就把video.mp4中的视频帧全部读取完并进行推流，这样就无法体现出视频播放的效果了。</strong>官方文档中对这个参数的解释是：</p>
<blockquote>
<p>-re (input)<br>Read input at native frame rate. Mainly used to simulate a grab device, or live input stream (e.g. when reading from a file). Should not be used with actual grab devices or live input streams (where it can cause packet loss). By default ffmpeg attempts to read the input(s) as fast as possible. This option will slow down the reading of the input(s) to the native frame rate of the input(s). It is useful for real-time output (e.g. live streaming).</p>
</blockquote>
<p>-vcodec copy : -vcodec表示使用的视频编解码器 ，前缀v表示video。后面紧跟的copy 表示复制使用源文件的视频编解码器，比如原文件的编解码器(codec)是h264，则这里就使用h264。</p>
<p>-acodec copy : -acodec表示使用的音频编解码器，前缀a表示audio。后面的copy 表示使用源文件的音频编解码器。</p>
<p>-b:v 800k : -b:v表示视频的比特率(bitrate) ，为800k。</p>
<p>-b:a 32k : 表示音频的比特率为32k。</p>
<p>-f flv : -f表示format ，就是强制输出格式为flv，这一步其实也叫封装(mux)，封装要做的事就是把视频和音频混合在一起，进行同步。紧跟在后面的<code>rtmp://localhost/live</code> 表示输出的”文件名”，这个文件名可以是一个本地的文件，也可以指定为rtmp流媒体地址。指定为rtmp流媒体地址后，则ffmpeg就可以进行推流。</p>
<p>4.可以使用VLC或ffplay进行播放了</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/ffmpeg/" class="category-chain-item">ffmpeg</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/ffmpeg/" class="print-no-link">#ffmpeg</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>ffmpeg</div>
      <div>https://flepeng.github.io/098-工具-11-FFmpeg-ffmpeg/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Lepeng</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年3月12日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/098-%E5%B7%A5%E5%85%B7-11-FFmpeg-M3U8-%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/" title="M3U8 文件格式">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">M3U8 文件格式</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/098-%E5%B7%A5%E5%85%B7-21-%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7-01-fiddler-%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86-The-system-proxy-was-changeed-Click-to-reenable-capturing/" title="01-fiddler 问题处理 The system proxy was changeed.Click to reenable capturing">
                        <span class="hidden-mobile">01-fiddler 问题处理 The system proxy was changeed.Click to reenable capturing</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
    <div id="giscus" class="giscus"></div>
    <script type="text/javascript">
      Fluid.utils.loadComments('#giscus', function() {
        var options = {"repo":"flepeng/hexo-blog-comment","repo-id":"R_kgDOL0qaig","category":"Announcements","category-id":"DIC_kwDOL0qais4CfBIv","theme-light":"light","theme-dark":"dark","mapping":"pathname","reactions-enabled":1,"emit-metadata":0,"input-position":"top","lang":"zh-CN"};
        var attributes = {};
        for (let option in options) {
          if (!option.startsWith('theme-')) {
            var key = option.startsWith('data-') ? option : 'data-' + option;
            attributes[key] = options[option];
          }
        }
        var light = 'light';
        var dark = 'dark';
        window.GiscusThemeLight = light;
        window.GiscusThemeDark = dark;
        attributes['data-theme'] = document.documentElement.getAttribute('data-user-color-scheme') === 'dark' ? dark : light;
        for (let attribute in attributes) {
          var value = attributes[attribute];
          if (value === undefined || value === null || value === '') {
            delete attributes[attribute];
          }
        }
        var s = document.createElement('script');
        s.setAttribute('src', 'https://giscus.app/client.js');
        s.setAttribute('crossorigin', 'anonymous');
        for (let attribute in attributes) {
          s.setAttribute(attribute, attributes[attribute]);
        }
        var ss = document.getElementsByTagName('script');
        var e = ss.length > 0 ? ss[ss.length - 1] : document.head || document.documentElement;
        e.parentNode.insertBefore(s, e.nextSibling);
      });
    </script>
    <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
