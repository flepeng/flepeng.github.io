

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2488174175014870" crossorigin="anonymous"></script><!-- google 广告 -->
  <meta name="google-site-verification" content="40lMg4eqLLbXoDcpN3h-cEnfmselbQ8tUzNvuC0IRIs" /><!-- google 站点认证 -->
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Lepeng">
  <meta name="keywords" content="">
  
    <meta name="description" content="转自：https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;516151901 Home常用开发库 - Apache Common包Apache Commons是对JDK的拓展，包含了很多开源的工具，用于解决平时编程经常会遇到的问题，减少重复劳动。官网网址:http:&#x2F;&#x2F;commons.apache.org 常用包梳理Commons BeanUtils这玩意我没找到，我感觉org.spring">
<meta property="og:type" content="article">
<meta property="og:title" content="常用开发库知识体系">
<meta property="og:url" content="https://flepeng.github.io/021-Java-%E5%B8%B8%E7%94%A8%E5%BC%80%E5%8F%91%E5%BA%93%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/index.html">
<meta property="og:site_name" content="Lepeng">
<meta property="og:description" content="转自：https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;516151901 Home常用开发库 - Apache Common包Apache Commons是对JDK的拓展，包含了很多开源的工具，用于解决平时编程经常会遇到的问题，减少重复劳动。官网网址:http:&#x2F;&#x2F;commons.apache.org 常用包梳理Commons BeanUtils这玩意我没找到，我感觉org.spring">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://flepeng.github.io/assets/1712902838-707e18e566c507670ed6ad077950435b.webp">
<meta property="og:image" content="https://flepeng.github.io/assets/1712902838-22725d231153d14ceb773f3c81dcc267.svg">
<meta property="og:image" content="https://flepeng.github.io/assets/1712902838-508802e98da2ff19f2fa52f49f35a79c.svg">
<meta property="og:image" content="https://flepeng.github.io/assets/1712902838-be06c3cc23862a66a097e70faed8dd27.svg">
<meta property="og:image" content="https://flepeng.github.io/assets/1712902838-be06c3cc23862a66a097e70faed8dd27.svg">
<meta property="og:image" content="https://flepeng.github.io/assets/1712902838-937dc9a4ed78eca946dab78a0845781c.svg">
<meta property="og:image" content="https://flepeng.github.io/assets/1712902838-65981fa8cb40832f3a13cf976831adb3.svg">
<meta property="og:image" content="https://flepeng.github.io/assets/1712902838-6d7a1ba652e187416dab17b8298c8382.svg">
<meta property="og:image" content="https://flepeng.github.io/assets/1712902838-6aa1f5cc3a432d0c20941f94b2704f6c.svg">
<meta property="og:image" content="https://flepeng.github.io/assets/1712902838-75df3bcf4843a615f1b07dd422dd8498.svg">
<meta property="og:image" content="https://flepeng.github.io/assets/1712902838-65981fa8cb40832f3a13cf976831adb3.svg">
<meta property="og:image" content="https://flepeng.github.io/assets/1712902838-6d7a1ba652e187416dab17b8298c8382.svg">
<meta property="article:published_time" content="2021-05-13T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-03T10:25:30.331Z">
<meta property="article:author" content="Feng Lepeng">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://flepeng.github.io/assets/1712902838-707e18e566c507670ed6ad077950435b.webp">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>常用开发库知识体系 - Lepeng</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"flepeng.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"f3d259b9efd9ce8655c180fd01bf0045","google":{"measurement_id":"G-LFTE4C7W3W"},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?f3d259b9efd9ce8655c180fd01bf0045";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=G-LFTE4C7W3W", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', 'G-LFTE4C7W3W');
        });
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Lepeng 的 blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="常用开发库知识体系"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-05-14 00:00" pubdate>
          2021年5月14日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          18k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          154 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">常用开发库知识体系</h1>
            
            
              <div class="markdown-body">
                
                <p>转自：<a href="https://zhuanlan.zhihu.com/p/516151901" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/516151901</a></p>
<h2 id="Home"><a href="#Home" class="headerlink" title="Home"></a><a href="https://link.zhihu.com/?target=https://www.pdai.tech/">Home</a></h2><h2 id="常用开发库-Apache-Common包"><a href="#常用开发库-Apache-Common包" class="headerlink" title="常用开发库 - Apache Common包"></a>常用开发库 - Apache Common包</h2><p>Apache Commons是对JDK的拓展，包含了很多开源的工具，用于解决平时编程经常会遇到的问题，减少重复劳动。官网网址:<a href="https://link.zhihu.com/?target=http://commons.apache.org">http://commons.apache.org</a></p>
<h2 id="常用包梳理"><a href="#常用包梳理" class="headerlink" title="常用包梳理"></a>常用包梳理</h2><h3 id="Commons-BeanUtils"><a href="#Commons-BeanUtils" class="headerlink" title="Commons BeanUtils"></a>Commons BeanUtils</h3><p>这玩意我没找到，我感觉org.springframework.beans.BeanUtils用的挺多哈。</p>
<p>Spring的BeanUtils（性能好），Apache的BeanUtils (性能差 不推荐使用)</p>
<p><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/Eric-F/p/9681996.html">https://www.cnblogs.com/Eric-F/p/9681996.html</a></p>
<p><a href="https://link.zhihu.com/?target=https://wenku.baidu.com/view/52997bb4d9ef5ef7ba0d4a7302768e9951e76ec0.html">https://wenku.baidu.com/view/52997bb4d9ef5ef7ba0d4a7302768e9951e76ec0.html</a></p>
<h3 id="Commons-Codec"><a href="#Commons-Codec" class="headerlink" title="Commons Codec"></a>Commons Codec</h3><p>是编码和解码组件，提供常用的编码和解码方法，如DES、SHA1、MD5、Base64、URL和Soundx等。</p>
<p>org.apache.commons.codec.digest.DigestUtils.md5Hex()</p>
<h3 id="Commons-Collections"><a href="#Commons-Collections" class="headerlink" title="Commons Collections"></a>Commons Collections</h3><p>是一个集合组件，扩展了Java标准Collections API，对常用的集合操作进行了很好的封装、抽象和补充，在保证性能的同时大大简化代码。目前更新的是org.apache.commons.collections4</p>
<p>我们先来浏览一下它的包结构。一共是12个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs text">org.apache.commons.collections – CommonsCollections自定义的一组公用的接口和工具类<br><br>org.apache.commons.collections.bag – 实现Bag接口的一组类<br><br>org.apache.commons.collections.bidimap – 实现BidiMap系列接口的一组类<br><br>org.apache.commons.collections.buffer – 实现Buffer接口的一组类<br><br>org.apache.commons.collections.collection –实现java.util.Collection接口的一组类<br><br>org.apache.commons.collections.comparators– 实现java.util.Comparator接口的一组类<br><br>org.apache.commons.collections.functors –Commons Collections自定义的一组功能类<br><br>org.apache.commons.collections.iterators – 实现java.util.Iterator接口的一组类<br><br>org.apache.commons.collections.keyvalue – 实现集合和键&#x2F;值映射相关的一组类<br><br>org.apache.commons.collections.list – 实现java.util.List接口的一组类<br><br>org.apache.commons.collections.map – 实现Map系列接口的一组类<br><br>org.apache.commons.collections.set – 实现Set系列接口的一组类<br></code></pre></td></tr></table></figure>

<ul>
<li>作为容器类的补充，我们可以找到Bag、Buffer、BidiMap、OrderedMap等等；</li>
<li>作为操作类的补充，我们可以找到CollectionUtils、IteratorUtils、ListUtils、SetUtils等等；</li>
<li>作为辅助类的补充，我们可以找到MapIterator、Closure、Predicate、Transformer等等；</li>
</ul>
<h3 id="Commons-Compress"><a href="#Commons-Compress" class="headerlink" title="Commons Compress"></a>Commons Compress</h3><p>是一个压缩、解压缩文件的组件，可以操作rar、cpio、Unix dump、tar、zip、gzip、XZ、Pack200和bzip2格式的压缩文件。</p>
<h3 id="Commons-Configuration"><a href="#Commons-Configuration" class="headerlink" title="Commons Configuration"></a>Commons Configuration</h3><p>是一个Java应用程序的配置管理工具，可以从properties或者xml文件中加载配置信息。</p>
<h3 id="Commons-CSV"><a href="#Commons-CSV" class="headerlink" title="Commons CSV"></a>Commons CSV</h3><p>是一个用来读写各种Comma Separated Value(CSV)格式文件的Java类库。</p>
<h3 id="Commons-Daemon"><a href="#Commons-Daemon" class="headerlink" title="Commons Daemon"></a>Commons Daemon</h3><p>实现将普通的Java应用变成系统的后台服务,例如 Tomcat 就是利用这个项目来实现作为 Linux 和 Windows 的服务启动和停止的。</p>
<h3 id="Commons-DBCP"><a href="#Commons-DBCP" class="headerlink" title="Commons DBCP"></a>Commons DBCP</h3><p>数据库连接池。</p>
<h3 id="Commons-DBUtils"><a href="#Commons-DBUtils" class="headerlink" title="Commons DBUtils"></a>Commons DBUtils</h3><p>是JDBC工具组件，对传统操作数据库的类进行二次封装，可以把结果集转化成List。</p>
<h3 id="Commons-Digester"><a href="#Commons-Digester" class="headerlink" title="Commons Digester"></a>Commons Digester</h3><p>是XML到Java对象的映射工具集。</p>
<h3 id="Commons-Email"><a href="#Commons-Email" class="headerlink" title="Commons Email"></a>Commons Email</h3><p>是邮件操作组件，对Java Mail API进行了封装，提供了常用的邮件发送和接收类，简化邮件操作。该组件依赖Java Mail API。</p>
<h3 id="Commons-Exec"><a href="#Commons-Exec" class="headerlink" title="Commons Exec"></a>Commons Exec</h3><p>提供一些常用的方法用来执行外部进程，如执行exe文件或命令行。</p>
<h3 id="Commons-FileUpload"><a href="#Commons-FileUpload" class="headerlink" title="Commons FileUpload"></a>Commons FileUpload</h3><p>为Web应用程序或Servlet提供文件上传功能，Struts2和SpringMVC的文件上传组件。</p>
<h3 id="Commons-IO"><a href="#Commons-IO" class="headerlink" title="Commons IO"></a>Commons IO</h3><p>是处理IO的工具类包，对<a href="https://link.zhihu.com/?target=http://java.io">http://java.io</a>进行扩展，提供了更加方便的IO操作。</p>
<h3 id="Commons-JCI"><a href="#Commons-JCI" class="headerlink" title="Commons JCI"></a>Commons JCI</h3><p>提供通用的Java编译器接口。</p>
<h3 id="Commons-Lang3"><a href="#Commons-Lang3" class="headerlink" title="Commons Lang3"></a>Commons Lang3</h3><p>是处理Java基本对象方法的工具类包，该类包提供对字符、数组等基本对象的操作，弥补了java.lang api基本处理方法上的不足。</p>
<p><a href="https://link.zhihu.com/?target=https://commons.apache.org/proper/commons-lang/javadocs/api-release/index.html">https://commons.apache.org/proper/commons-lang/javadocs/api-release/index.html</a></p>
<p><img src="/assets/1712902838-707e18e566c507670ed6ad077950435b.webp" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs text">ArrayUtils – 用于对数组的操作，如添加、查找、删除、子数组、倒序、元素类型转换等；<br><br>BitField – 用于操作位元，提供了一些方便而安全的方法；<br><br>BooleanUtils – 用于操作和转换boolean或者Boolean及相应的数组；<br><br>CharEncoding – 包含了Java环境支持的字符编码，提供是否支持某种编码的判断；<br><br>CharRange – 用于设定字符范围并做相应检查；<br><br>CharSet – 用于设定一组字符作为范围并做相应检查；<br><br>CharSetUtils – 用于操作CharSet；<br><br>CharUtils – 用于操作char值和Character对象；<br><br>ClassUtils – 用于对Java类的操作，不使用反射；<br><br>ObjectUtils – 用于操作Java对象，提供null安全的访问和其他一些功能；<br><br>RandomStringUtils – 用于生成随机的字符串；<br><br>SerializationUtils – 用于处理对象序列化，提供比一般Java序列化更高级的处理能力；<br><br>StringEscapeUtils – 用于正确处理转义字符，产生正确的Java、JavaScript、HTML、XML和SQL代码；<br><br>StringUtils – 处理String的核心类，提供了相当多的功能；<br><br>SystemUtils – 在java.lang.System基础上提供更方便的访问，如用户路径、Java版本、时区、操作系统等判断；<br><br>Validate – 提供验证的操作，有点类似assert断言；<br><br>WordUtils – 用于处理单词大小写、换行等。<br></code></pre></td></tr></table></figure>

<h3 id="Commons-Logging"><a href="#Commons-Logging" class="headerlink" title="Commons Logging"></a>Commons Logging</h3><p>提供统一的日志接口，同时兼顾轻量级和不依赖于具体的实现。类包给中间件&#x2F;日志工具开发者一个简单的日志操作抽象，允许程序开发人员使用不同的具体日志实现工具。</p>
<h3 id="Commons-Math"><a href="#Commons-Math" class="headerlink" title="Commons Math"></a>Commons Math</h3><p>轻量级自容器的数学和统计计算方法类包，包含大多数常用的数值算法。</p>
<h3 id="Commons-Net"><a href="#Commons-Net" class="headerlink" title="Commons Net"></a>Commons Net</h3><p>封装了各种网络协议的客户端，支持FTP、NNTP、SMTP、POP3、Telnet等协议。</p>
<h3 id="Commons-Pool"><a href="#Commons-Pool" class="headerlink" title="Commons Pool"></a>Commons Pool</h3><p>提供了一整套用于实现对象池化的框架，以及若干各具特色的对象池实现，可以有效地减少处理对象池化时的工作量。类包用于提高像文件句柄、数据库连接、socket通信这类大对象的调用效率，简单的说就是一种对象一次创建多次使用的技术。</p>
<h3 id="Commons-Primitives"><a href="#Commons-Primitives" class="headerlink" title="Commons Primitives"></a>Commons Primitives</h3><p>提供了一个更小，更快和更易使用的对Java基本类型的支持。</p>
<h3 id="Commons-Validator"><a href="#Commons-Validator" class="headerlink" title="Commons Validator"></a>Commons Validator</h3><p>提供了一个简单的、可扩展的框架来在一个XML文件中定义校验器(校验方法)和校验规则。支持校验规则的和错误消息的国际化。</p>
<h3 id="Apache-HttpClient"><a href="#Apache-HttpClient" class="headerlink" title="Apache HttpClient"></a>Apache HttpClient</h3><p>曾经是Apache Commons的子项目，后来独立出来。HttpClient简化HTTP客户端与服务器的各种通讯，实现HTTP客户端程序（也就是浏览器程序）的功能。</p>
<h2 id="Common-包检索和使用"><a href="#Common-包检索和使用" class="headerlink" title="Common 包检索和使用"></a>Common 包检索和使用</h2><p>在这里检索吧：<a href="https://link.zhihu.com/?target=https://mvnrepository.com/artifact/org.apache.commons">Apache Common 包</a></p>
<h2 id="常用开发库-Google-Guava包"><a href="#常用开发库-Google-Guava包" class="headerlink" title="常用开发库 - Google Guava包"></a>常用开发库 - Google Guava包</h2><h2 id="Google-Guava简介"><a href="#Google-Guava简介" class="headerlink" title="Google Guava简介"></a>Google Guava简介</h2><p><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/moongeek/p/12831296.html">https://www.cnblogs.com/moongeek/p/12831296.html</a></p>
<p>Guava工程包含了若干被Google的 Java项目广泛依赖 的核心库，例如：集合 [collections] 、缓存 [caching] 、原生类型支持 [primitives support] 、并发库 [concurrency libraries] 、通用注解 [common annotations] 、字符串处理 [string processing] 、I&#x2F;O 等等。 所有这些工具每天都在被Google的工程师应用在产品服务中。</p>
<p>guava的优点：</p>
<ul>
<li>高效设计良好的API，被Google的开发者设计，实现和使用</li>
<li>遵循高效的java语法实践</li>
<li>使代码更刻度，简洁，简单</li>
<li>节约时间，资源，提高生产力</li>
</ul>
<h2 id="推荐网址"><a href="#推荐网址" class="headerlink" title="推荐网址"></a>推荐网址</h2><ul>
<li><a href="https://link.zhihu.com/?target=https://github.com/google/guava/wiki/Home">Guava Wiki(opens new window)</a></li>
<li><a href="https://link.zhihu.com/?target=https://guava.dev/releases/snapshot-jre/api/docs/">Guava API Doc(opens new window)</a></li>
<li><a href="https://link.zhihu.com/?target=https://github.com/google/guava">Guava Github(opens new window)</a></li>
<li><a href="https://link.zhihu.com/?target=http://ifeve.com/google-guava/">Guava 中文教程 - ifeve.com</a></li>
</ul>
<h2 id="使用Guava"><a href="#使用Guava" class="headerlink" title="使用Guava"></a>使用Guava</h2><p>注意：JDK 1.8 or higher.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;dependency&gt;<br>  &lt;groupId&gt;com.google.guava&lt;&#x2F;groupId&gt;<br>  &lt;artifactId&gt;guava&lt;&#x2F;artifactId&gt;<br>  &lt;version&gt;28.2-jre&lt;&#x2F;version&gt;<br>  &lt;!-- or, for Android: --&gt;<br>  &lt;version&gt;28.2-android&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>

<h2 id="常用开发库-Hutool包"><a href="#常用开发库-Hutool包" class="headerlink" title="常用开发库 - Hutool包"></a>常用开发库 - Hutool包</h2><p>Hutool作为后起之秀，功能上也比较全。但是要注意一点，它的开源协议是：中国第一个开源协议<a href="https://link.zhihu.com/?target=http://license.coscl.org.cn/MulanPSL">木兰宽松许可证, 第1版(opens new window)</a>，对此在商业项目中需要谨慎些，在个人项目无所谓。所以公司项目没有使用这个的。</p>
<h2 id="包含组件"><a href="#包含组件" class="headerlink" title="包含组件"></a>包含组件</h2><p>一个Java基础工具类，对文件、流、加密解密、转码、正则、线程、XML等JDK方法进行封装，组成各种Util工具类，同时提供以下组件：</p>
<table data-draft-node="block" data-draft-type="table" data-size="normal" data-row-style="normal"><tbody><tr><td>模块</td><td>介绍</td></tr><tr><td>hutool-aop</td><td>JDK动态代理封装，提供非IOC下的切面支持</td></tr><tr><td>hutool-bloomFilter</td><td>布隆过滤，提供一些Hash算法的布隆过滤</td></tr><tr><td>hutool-cache</td><td>简单缓存实现</td></tr><tr><td>hutool-core</td><td>核心，包括Bean操作、日期、各种Util等</td></tr><tr><td>hutool-cron</td><td>定时任务模块，提供类Crontab表达式的定时任务</td></tr><tr><td>hutool-crypto</td><td>加密解密模块，提供对称、非对称和摘要算法封装</td></tr><tr><td>hutool-db</td><td>JDBC封装后的数据操作，基于ActiveRecord思想</td></tr><tr><td>hutool-dfa</td><td>基于DFA模型的多关键字查找</td></tr><tr><td>hutool-extra</td><td>扩展模块，对第三方封装（模板引擎、邮件、Servlet、二维码、Emoji、FTP、分词等）</td></tr><tr><td>hutool-http</td><td>基于HttpUrlConnection的Http客户端封装</td></tr><tr><td>hutool-log</td><td>自动识别日志实现的日志门面</td></tr><tr><td>hutool-script</td><td>脚本执行封装，例如Javascript</td></tr><tr><td>hutool-setting</td><td>功能更强大的Setting配置文件和Properties封装</td></tr><tr><td>hutool-system</td><td>系统参数调用封装（JVM信息等）</td></tr><tr><td>hutool-json</td><td>JSON实现</td></tr><tr><td>hutool-captcha</td><td>图片验证码实现</td></tr><tr><td>hutool-poi</td><td>针对POI中Excel的封装</td></tr><tr><td>hutool-socket</td><td>基于Java的NIO和AIO的Socket封装</td></tr></tbody></table>

<p>可以根据需求对每个模块单独引入，也可以通过引入hutool-all方式引入所有模块。</p>
<h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><ul>
<li><a href="https://link.zhihu.com/?target=https://www.hutool.cn/docs/">中文文档(opens new window)</a>看这里</li>
<li><a href="https://link.zhihu.com/?target=https://www.hutool.club/docs/">中文文档（备用）(opens new window)</a></li>
<li><a href="https://link.zhihu.com/?target=https://apidoc.gitee.com/loolly/hutool/">参考API</a></li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><p>在项目的pom.xml的dependencies中加入以下内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;dependency&gt;<br>    &lt;groupId&gt;cn.hutool&lt;&#x2F;groupId&gt;<br>    &lt;artifactId&gt;hutool-all&lt;&#x2F;artifactId&gt;<br>    &lt;version&gt;5.1.0&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>

<h3 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">compile &#39;cn.hutool:hutool-all:5.1.0&#39;<br></code></pre></td></tr></table></figure>

<h3 id="非Maven项目"><a href="#非Maven项目" class="headerlink" title="非Maven项目"></a>非Maven项目</h3><p>点击以下任一链接，下载hutool-all-X.X.X.jar即可：</p>
<ul>
<li><a href="https://link.zhihu.com/?target=https://repo1.maven.org/maven2/cn/hutool/hutool-all/5.1.0/">Maven中央库1(opens new window)</a></li>
<li><a href="https://link.zhihu.com/?target=http://repo2.maven.org/maven2/cn/hutool/hutool-all/5.1.0/">Maven中央库2(opens new window)</a></li>
</ul>
<p>注意 Hutool 5.x支持JDK8+，对Android平台没有测试，不能保证所有工具类获工具方法可用。 如果你的项目使用JDK7，请使用Hutool 4.x版本</p>
<h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><p>访问Hutool的码云主页：<a href="https://link.zhihu.com/?target=https://gitee.com/loolly/hutool">https://gitee.com/loolly/hutool(opens new window)</a> 下载整个项目源码（v5-master或v5-dev分支都可）然后进入Hutool项目目录执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">.&#x2F;hutool.sh install<br></code></pre></td></tr></table></figure>

<p>然后就可以使用Maven引入了。</p>
<h2 id="常用开发库-Spring常用工具类"><a href="#常用开发库-Spring常用工具类" class="headerlink" title="常用开发库 - Spring常用工具类"></a>常用开发库 - Spring常用工具类</h2><p>Spring作为常用的开发框架，在Spring框架应用中，排在ApacheCommon，Guava, Huool等通用库后，第二优先级可以考虑使用Spring-core-xxx.jar中的util包。</p>
<h2 id="内置的resouce类型"><a href="#内置的resouce类型" class="headerlink" title="内置的resouce类型"></a>内置的resouce类型</h2><ul>
<li>UrlResource</li>
<li>ClassPathResource</li>
<li>FileSystemResource</li>
<li>ServletContextResource</li>
<li>InputStreamResource</li>
<li>ByteArrayResource</li>
<li>EncodedResource 也就是Resource加上encoding, 可以认为是有编码的资源</li>
<li>VfsResource(在jboss里经常用到, 相应还有 工具类 VfsUtils)</li>
<li>org.springframework.util.xml.ResourceUtils 用于处理表达资源字符串前缀描述资源的工具. 如: “classpath:”. 有 getURL, getFile, isFileURL, isJarURL, extractJarFileURL</li>
</ul>
<h2 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h2><ul>
<li>org.springframework.core.annotation.AnnotationUtils 处理注解</li>
<li>org.springframework.core.io.support.PathMatchingResourcePatternResolver 用 于处理 ant 匹配风格(com&#x2F;<em>.jsp, com&#x2F;</em>&#x2F;.jsp),找出所有的资源, 结合上面的resource的概念一起使用,对于遍历文件很有用. 具体请详细查看javadoc</li>
<li>org.springframework.core.io.support.PropertiesLoaderUtils 加载Properties资源工具类,和Resource结合</li>
<li>org.springframework.core.BridgeMethodResolver 桥接方法分析器. 关于桥接方法请参考: <a href="https://link.zhihu.com/?target=http://java.sun.com/docs/books/jls/third_edition/html/expressions.html%2315.12.4.5">http://java.sun.com/docs/books/jls/third_edition&#x2F;html&#x2F;expressions.html#15.12.4.5</a></li>
<li>org.springframework.core.GenericTypeResolver 范型分析器, 在用于对范型方法, 参数分析.</li>
<li>org.springframework.core.NestedExceptionUtils</li>
</ul>
<h2 id="xml工具"><a href="#xml工具" class="headerlink" title="xml工具"></a>xml工具</h2><ul>
<li>org.springframework.util.xml.AbstractStaxContentHandler</li>
<li>org.springframework.util.xml.AbstractStaxXMLReader</li>
<li>org.springframework.util.xml.AbstractXMLReader</li>
<li>org.springframework.util.xml.AbstractXMLStreamReader</li>
<li>org.springframework.util.xml.DomUtils</li>
<li>org.springframework.util.xml.SimpleNamespaceContext</li>
<li>org.springframework.util.xml.SimpleSaxErrorHandler</li>
<li>org.springframework.util.xml.SimpleTransformErrorListener</li>
<li>org.springframework.util.xml.StaxUtils</li>
<li>org.springframework.util.xml.TransformerUtils</li>
</ul>
<h2 id="其它工具集"><a href="#其它工具集" class="headerlink" title="其它工具集"></a>其它工具集</h2><ul>
<li>org.springframework.util.xml.AntPathMatcherant风格的处理</li>
<li>org.springframework.util.xml.AntPathStringMatcher</li>
<li>org.springframework.util.xml.Assert断言,在我们的参数判断时应该经常用</li>
<li>org.springframework.util.xml.CachingMapDecorator</li>
<li>org.springframework.util.xml.ClassUtils用于Class的处理</li>
<li>org.springframework.util.xml.CollectionUtils用于处理集合的工具</li>
<li>org.springframework.util.xml.CommonsLogWriter</li>
<li>org.springframework.util.xml.CompositeIterator</li>
<li>org.springframework.util.xml.ConcurrencyThrottleSupport</li>
<li>org.springframework.util.xml.CustomizableThreadCreator</li>
<li>org.springframework.util.xml.DefaultPropertiesPersister</li>
<li>org.springframework.util.xml.DigestUtils摘要处理, 这里有用于md5处理信息的</li>
<li>org.springframework.util.xml.FileCopyUtils文件的拷贝处理, 结合Resource的概念一起来处理, 真的是很方便</li>
<li>org.springframework.util.xml.FileSystemUtils</li>
<li>org.springframework.util.xml.LinkedCaseInsensitiveMap key值不区分大小写的LinkedMap</li>
<li>org.springframework.util.xml.LinkedMultiValueMap一个key可以存放多个值的LinkedMap</li>
<li>org.springframework.util.xml.Log4jConfigurer一个log4j的启动加载指定配制文件的工具类</li>
<li>org.springframework.util.xml.NumberUtils处理数字的工具类, 有parseNumber 可以把字符串处理成我们指定的数字格式, 还支持format格式, convertNumberToTargetClass 可以实现Number类型的转化.</li>
<li>org.springframework.util.xml.ObjectUtils有很多处理null object的方法. 如nullSafeHashCode, nullSafeEquals, isArray, containsElement, addObjectToArray, 等有用的方法</li>
<li>org.springframework.util.xml.PatternMatchUtilsspring里用于处理简单的匹配. 如 Spring’s typical “xxx”, “xxx” and “xxx” pattern styles</li>
<li>org.springframework.util.xml.PropertyPlaceholderHelper用于处理占位符的替换</li>
<li>org.springframework.util.xml.ReflectionUtils反映常用工具方法. 有 findField, setField, getField, findMethod, invokeMethod等有用的方法</li>
<li>org.springframework.util.xml.SerializationUtils用于java的序列化与反序列化. serialize与deserialize方法</li>
<li>org.springframework.util.xml.StopWatch一个很好的用于记录执行时间的工具类, 且可以用于任务分阶段的测试时间. 最后支持一个很好看的打印格式. 这个类应该经常用</li>
<li>org.springframework.util.xml.StringUtils</li>
<li>org.springframework.util.xml.SystemPropertyUtils</li>
<li>org.springframework.util.xml.TypeUtils用于类型相容的判断. isAssignable</li>
<li>org.springframework.util.xml.WeakReferenceMonitor弱引用的监控</li>
</ul>
<h2 id="和web相关的工具"><a href="#和web相关的工具" class="headerlink" title="和web相关的工具"></a>和web相关的工具</h2><ul>
<li><p>org.springframework.web.util.CookieGenerator</p>
</li>
<li><p>org.springframework.web.util.HtmlCharacterEntityDecoder</p>
</li>
<li><p>org.springframework.web.util.HtmlCharacterEntityReferences</p>
</li>
<li><p>org.springframework.web.util.HtmlUtils</p>
</li>
<li><p>org.springframework.web.util.HttpUrlTemplate</p>
</li>
<li><p>这个类用于用字符串模板构建url, 它会自动处理url里的汉字及其它相关的编码. 在读取别人提供的url资源时, 应该经常用</p>
</li>
<li><p>String url &#x3D; “<a href="http://localhost/myapp/%7Bname%7D/%7Bid%7D" target="_blank" rel="noopener">http://localhost/myapp/{name}/{id}</a>“;</p>
</li>
<li><p>org.springframework.web.util.JavaScriptUtils</p>
</li>
<li><p>org.springframework.web.util.Log4jConfigListener</p>
</li>
<li><p>用listener的方式来配制log4j在web环境下的初始化</p>
</li>
<li><p>org.springframework.web.util.UriTemplate</p>
</li>
<li><p>org.springframework.web.util.UriUtils处理uri里特殊字符的编码</p>
</li>
<li><p>org.springframework.web.util.WebUtils</p>
</li>
</ul>
<h2 id="常用开发库-日志类库详解"><a href="#常用开发库-日志类库详解" class="headerlink" title="常用开发库 - 日志类库详解"></a>常用开发库 - 日志类库详解</h2><p>Java日志库是最能体现Java库在进化中的渊源关系的，在理解时重点理解日志框架本身和日志门面，以及比较好的实践等。要关注其历史渊源和设计（比如桥接），而具体在使用时查询接口即可， 否则会陷入JUL(Java Util Log), JCL(Commons Logging), Log4j, SLF4J, Logback，Log4j2傻傻分不清楚的境地。</p>
<h2 id="日志库简介"><a href="#日志库简介" class="headerlink" title="日志库简介"></a>日志库简介</h2><ul>
<li>最重要的一点是 区分<strong>日志系统</strong>和<strong>日志门面</strong>;</li>
<li>其次是日志库的使用, 包含配置与API使用；配置侧重于日志系统的配置，API使用侧重于日志门面；</li>
<li>最后是选型，改造和最佳实践等</li>
</ul>
<h2 id="日志库之日志系统"><a href="#日志库之日志系统" class="headerlink" title="日志库之日志系统"></a>日志库之日志系统</h2><h3 id="java-util-logging-JUL"><a href="#java-util-logging-JUL" class="headerlink" title="java.util.logging (JUL)"></a>java.util.logging (JUL)</h3><p>JDK1.4 开始，通过 java.util.logging 提供日志功能。虽然是官方自带的log lib，JUL的使用确不广泛。主要原因:</p>
<ul>
<li>JUL从JDK1.4 才开始加入(2002年)，当时各种第三方log lib已经被广泛使用了</li>
<li>JUL早期存在性能问题，到JDK1.5上才有了不错的进步，但现在和Logback&#x2F;Log4j2相比还是有所不如</li>
<li>JUL的功能不如Logback&#x2F;Log4j2等完善，比如Output Handler就没有Logback&#x2F;Log4j2的丰富，有时候需要自己来继承定制，又比如默认没有从ClassPath里加载配置文件的功能</li>
</ul>
<h3 id="Log4j"><a href="#Log4j" class="headerlink" title="Log4j"></a>Log4j</h3><p>Log4j 是 apache 的一个开源项目，创始人 Ceki Gulcu。Log4j 应该说是 Java 领域资格最老，应用最广的日志工具。Log4j 是高度可配置的，并可通过在运行时的外部文件配置。它根据记录的优先级别，并提供机制，以指示记录信息到许多的目的地，诸如：数据库，文件，控制台，UNIX 系统日志等。</p>
<p>Log4j 中有三个主要组成部分：</p>
<ul>
<li>loggers - 负责捕获记录信息。</li>
<li>appenders - 负责发布日志信息，以不同的首选目的地。</li>
<li>layouts - 负责格式化不同风格的日志信息。</li>
</ul>
<p>官网地址：<a href="https://link.zhihu.com/?target=http://logging.apache.org/log4j/2.x/">http://logging.apache.org/log4j/2.x/(opens new window)</a></p>
<p>Log4j 的短板在于性能，在Logback 和 Log4j2 出来之后，Log4j的使用也减少了。</p>
<h3 id="Logback"><a href="#Logback" class="headerlink" title="Logback"></a>Logback</h3><p>Logback 是由 log4j 创始人 Ceki Gulcu 设计的又一个开源日志组件，是作为 Log4j 的继承者来开发的，提供了性能更好的实现，异步 logger，Filter等更多的特性。</p>
<p>logback 当前分成三个模块：logback-core、logback-classic 和 logback-access。</p>
<ul>
<li>logback-core - 是其它两个模块的基础模块。</li>
<li>logback-classic - 是 log4j 的一个 改良版本。此外 logback-classic 完整实现 SLF4J API 使你可以很方便地更换成其它日志系统如 log4j 或 JDK14 Logging。</li>
<li>logback-access - 访问模块与 Servlet 容器集成提供通过 Http 来访问日志的功能。</li>
</ul>
<p>官网地址: <a href="https://link.zhihu.com/?target=http://logback.qos.ch/">http://logback.qos.ch/</a></p>
<h3 id="Log4j2"><a href="#Log4j2" class="headerlink" title="Log4j2"></a>Log4j2</h3><p>维护 Log4j 的人为了性能又搞出了 Log4j2。</p>
<p>Log4j2 和 Log4j1.x 并不兼容，设计上很大程度上模仿了 SLF4J&#x2F;Logback，性能上也获得了很大的提升。</p>
<p>Log4j2 也做了 Facade&#x2F;Implementation 分离的设计，分成了 log4j-api 和 log4j-core。</p>
<p>官网地址: <a href="https://link.zhihu.com/?target=http://logging.apache.org/log4j/2.x/">http://logging.apache.org/log4j/2.x/</a></p>
<h3 id="Log4j-vs-Logback-vs-Log4j2"><a href="#Log4j-vs-Logback-vs-Log4j2" class="headerlink" title="Log4j vs Logback vs Log4j2"></a>Log4j vs Logback vs Log4j2</h3><p>从性能上Log4J2要强，但从生态上Logback+SLF4J优先。</p>
<h3 id="初步对比"><a href="#初步对比" class="headerlink" title="初步对比"></a>初步对比</h3><p>撇开血统不谈，比较一下log4j2和logback：</p>
<ul>
<li>log4j2比logback更新：log4j2的GA版在2014年底才推出，比logback晚了好几年，这期间log4j2确实吸收了slf4j和logback的一些优点（比如日志模板），同时应用了不少的新技术</li>
<li>由于采用了更先进的锁机制和LMAX Disruptor库，log4j2的性能优于logback，特别是在多线程环境下和使用异步日志的环境下</li>
<li>二者都支持Filter（应该说是log4j2借鉴了logback的Filter），能够实现灵活的日志记录规则（例如仅对一部分用户记录debug级别的日志）</li>
<li>二者都支持对配置文件的动态更新</li>
<li>二者都能够适配slf4j，logback与slf4j的适配应该会更好一些，毕竟省掉了一层适配库</li>
<li>logback能够自动压缩&#x2F;删除旧日志</li>
<li>logback提供了对日志的HTTP访问功能</li>
<li>log4j2实现了“无垃圾”和“低垃圾”模式。简单地说，log4j2在记录日志时，能够重用对象（如String等），尽可能避免实例化新的临时对象，减少因日志记录产生的垃圾对象，减少垃圾回收带来的性能下降</li>
<li>log4j2和logback各有长处，总体来说，如果对性能要求比较高的话，log4j2相对还是较优的选择。</li>
</ul>
<h2 id="日志库之日志门面"><a href="#日志库之日志门面" class="headerlink" title="日志库之日志门面"></a>日志库之日志门面</h2><h3 id="common-logging"><a href="#common-logging" class="headerlink" title="common-logging"></a>common-logging</h3><p>common-logging 是 apache 的一个开源项目。也称Jakarta Commons Logging，缩写 JCL。</p>
<p>common-logging 的功能是提供日志功能的 API 接口，本身并不提供日志的具体实现（当然，common-logging 内部有一个 Simple logger 的简单实现，但是功能很弱，直接忽略），而是在运行时动态的绑定日志实现组件来工作（如 log4j、java.util.loggin）。</p>
<p>官网地址: <a href="https://link.zhihu.com/?target=http://commons.apache.org/proper/commons-logging/">http://commons.apache.org/proper/commons-logging/(opens new window)</a></p>
<h3 id="slf4j"><a href="#slf4j" class="headerlink" title="slf4j"></a>slf4j</h3><p>全称为 Simple Logging Facade for Java，即 java 简单日志门面。</p>
<p>类似于 Common-Logging，slf4j 是对不同日志框架提供的一个 API 封装，可以在部署的时候不修改任何配置即可接入一种日志实现方案。但是，slf4j 在编译时静态绑定真正的 Log 库。使用 SLF4J 时，如果你需要使用某一种日志实现，那么你必须选择正确的 SLF4J 的 jar 包的集合（各种桥接包）。</p>
<p>官网地址: <a href="https://link.zhihu.com/?target=http://www.slf4j.org/">http://www.slf4j.org/</a></p>
<p><img src="/assets/1712902838-22725d231153d14ceb773f3c81dcc267.svg" srcset="/img/loading.gif" lazyload></p>
<h3 id="common-logging-vs-slf4j"><a href="#common-logging-vs-slf4j" class="headerlink" title="common-logging vs slf4j"></a>common-logging vs slf4j</h3><p>slf4j 库类似于 Apache Common-Logging。但是，他在编译时静态绑定真正的日志库。这点似乎很麻烦，其实也不过是导入桥接 jar 包而已。</p>
<p>slf4j 一大亮点是提供了更方便的日志记录方式：</p>
<p>不需要使用logger.isDebugEnabled()来解决日志因为字符拼接产生的性能问题。slf4j 的方式是使用{}作为字符串替换符，形式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">logger.debug(&quot;id: &#123;&#125;, name: &#123;&#125; &quot;, id, name);<br></code></pre></td></tr></table></figure>

<h2 id="日志库使用方案"><a href="#日志库使用方案" class="headerlink" title="日志库使用方案"></a>日志库使用方案</h2><p>使用日志解决方案基本可分为三步：</p>
<ul>
<li>引入 jar 包</li>
<li>配置</li>
<li>使用 API</li>
</ul>
<p>常见的各种日志解决方案的第 2 步和第 3 步基本一样，实施上的差别主要在第 1 步，也就是使用不同的库。</p>
<h3 id="日志库jar包"><a href="#日志库jar包" class="headerlink" title="日志库jar包"></a>日志库jar包</h3><p>这里首选推荐使用 slf4j + logback 的组合。</p>
<p>如果你习惯了 common-logging，可以选择 common-logging+log4j。</p>
<p>强烈建议不要直接使用日志实现组件(logback、log4j、java.util.logging)，理由前面也说过，就是无法灵活替换日志库。</p>
<p>还有一种情况：你的老项目使用了 common-logging，或是直接使用日志实现组件。如果修改老的代码，工作量太大，需要兼容处理。在下文，都将看到各种应对方法。</p>
<p>注：据我所知，当前仍没有方法可以将 slf4j 桥接到 common-logging。如果我孤陋寡闻了，请不吝赐教。</p>
<h3 id="slf4j-直接绑定日志组件"><a href="#slf4j-直接绑定日志组件" class="headerlink" title="slf4j 直接绑定日志组件"></a>slf4j 直接绑定日志组件</h3><ul>
<li>slf4j + logback</li>
</ul>
<p>添加依赖到 pom.xml 中即可。</p>
<p>logback-classic-1.0.13.jar 会自动将 slf4j-api-1.7.21.jar 和 logback-core-1.0.13.jar 也添加到你的项目中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;dependency&gt;<br>  &lt;groupId&gt;ch.qos.logback&lt;&#x2F;groupId&gt;<br>  &lt;artifactId&gt;logback-classic&lt;&#x2F;artifactId&gt;<br>  &lt;version&gt;1.0.13&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>slf4j + log4j</li>
</ul>
<p>添加依赖到 pom.xml 中即可。</p>
<p>slf4j-log4j12-1.7.21.jar 会自动将 slf4j-api-1.7.21.jar 和 log4j-1.2.17.jar 也添加到你的项目中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;dependency&gt;<br>  &lt;groupId&gt;org.slf4j&lt;&#x2F;groupId&gt;<br>  &lt;artifactId&gt;slf4j-log4j12&lt;&#x2F;artifactId&gt;<br>  &lt;version&gt;1.7.21&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>slf4j + java.util.logging</li>
</ul>
<p>添加依赖到 pom.xml 中即可。</p>
<p>slf4j-jdk14-1.7.21.jar 会自动将 slf4j-api-1.7.21.jar 也添加到你的项目中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;dependency&gt;<br>  &lt;groupId&gt;org.slf4j&lt;&#x2F;groupId&gt;<br>  &lt;artifactId&gt;slf4j-jdk14&lt;&#x2F;artifactId&gt;<br>  &lt;version&gt;1.7.21&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>

<h3 id="日志库配置-针对于日志框架"><a href="#日志库配置-针对于日志框架" class="headerlink" title="日志库配置 - 针对于日志框架"></a>日志库配置 - 针对于日志框架</h3><h3 id="log4j2-配置"><a href="#log4j2-配置" class="headerlink" title="log4j2 配置"></a>log4j2 配置</h3><p>log4j2 基本配置形式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;;<br>&lt;Configuration&gt;<br>  &lt;Properties&gt;<br>    &lt;Property name&#x3D;&quot;name1&quot;&gt;value&lt;&#x2F;property&gt;<br>    &lt;Property name&#x3D;&quot;name2&quot; value&#x3D;&quot;value2&quot;&#x2F;&gt;<br>  &lt;&#x2F;Properties&gt;<br>  &lt;Filter type&#x3D;&quot;type&quot; ... &#x2F;&gt;<br>  &lt;Appenders&gt;<br>    &lt;Appender type&#x3D;&quot;type&quot; name&#x3D;&quot;name&quot;&gt;<br>      &lt;Filter type&#x3D;&quot;type&quot; ... &#x2F;&gt;<br>    &lt;&#x2F;Appender&gt;<br>    ...<br>  &lt;&#x2F;Appenders&gt;<br>  &lt;Loggers&gt;<br>    &lt;Logger name&#x3D;&quot;name1&quot;&gt;<br>      &lt;Filter type&#x3D;&quot;type&quot; ... &#x2F;&gt;<br>    &lt;&#x2F;Logger&gt;<br>    ...<br>    &lt;Root level&#x3D;&quot;level&quot;&gt;<br>      &lt;AppenderRef ref&#x3D;&quot;name&quot;&#x2F;&gt;<br>    &lt;&#x2F;Root&gt;<br>  &lt;&#x2F;Loggers&gt;<br>&lt;&#x2F;Configuration&gt;<br></code></pre></td></tr></table></figure>

<p>配置示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;<br>&lt;Configuration status&#x3D;&quot;debug&quot; strict&#x3D;&quot;true&quot; name&#x3D;&quot;XMLConfigTest&quot;<br>               packages&#x3D;&quot;org.apache.logging.log4j.test&quot;&gt;<br>  &lt;Properties&gt;<br>    &lt;Property name&#x3D;&quot;filename&quot;&gt;target&#x2F;test.log&lt;&#x2F;Property&gt;<br>  &lt;&#x2F;Properties&gt;<br>  &lt;Filter type&#x3D;&quot;ThresholdFilter&quot; level&#x3D;&quot;trace&quot;&#x2F;&gt;<br> <br>  &lt;Appenders&gt;<br>    &lt;Appender type&#x3D;&quot;Console&quot; name&#x3D;&quot;STDOUT&quot;&gt;<br>      &lt;Layout type&#x3D;&quot;PatternLayout&quot; pattern&#x3D;&quot;%m MDC%X%n&quot;&#x2F;&gt;<br>      &lt;Filters&gt;<br>        &lt;Filter type&#x3D;&quot;MarkerFilter&quot; marker&#x3D;&quot;FLOW&quot; onMatch&#x3D;&quot;DENY&quot; onMismatch&#x3D;&quot;NEUTRAL&quot;&#x2F;&gt;<br>        &lt;Filter type&#x3D;&quot;MarkerFilter&quot; marker&#x3D;&quot;EXCEPTION&quot; onMatch&#x3D;&quot;DENY&quot; onMismatch&#x3D;&quot;ACCEPT&quot;&#x2F;&gt;<br>      &lt;&#x2F;Filters&gt;<br>    &lt;&#x2F;Appender&gt;<br>    &lt;Appender type&#x3D;&quot;Console&quot; name&#x3D;&quot;FLOW&quot;&gt;<br>      &lt;Layout type&#x3D;&quot;PatternLayout&quot; pattern&#x3D;&quot;%C&#123;1&#125;.%M %m %ex%n&quot;&#x2F;&gt;&lt;!-- class and line number --&gt;<br>      &lt;Filters&gt;<br>        &lt;Filter type&#x3D;&quot;MarkerFilter&quot; marker&#x3D;&quot;FLOW&quot; onMatch&#x3D;&quot;ACCEPT&quot; onMismatch&#x3D;&quot;NEUTRAL&quot;&#x2F;&gt;<br>        &lt;Filter type&#x3D;&quot;MarkerFilter&quot; marker&#x3D;&quot;EXCEPTION&quot; onMatch&#x3D;&quot;ACCEPT&quot; onMismatch&#x3D;&quot;DENY&quot;&#x2F;&gt;<br>      &lt;&#x2F;Filters&gt;<br>    &lt;&#x2F;Appender&gt;<br>    &lt;Appender type&#x3D;&quot;File&quot; name&#x3D;&quot;File&quot; fileName&#x3D;&quot;$&#123;filename&#125;&quot;&gt;<br>      &lt;Layout type&#x3D;&quot;PatternLayout&quot;&gt;<br>        &lt;Pattern&gt;%d %p %C&#123;1.&#125; [%t] %m%n&lt;&#x2F;Pattern&gt;<br>      &lt;&#x2F;Layout&gt;<br>    &lt;&#x2F;Appender&gt;<br>  &lt;&#x2F;Appenders&gt;<br> <br>  &lt;Loggers&gt;<br>    &lt;Logger name&#x3D;&quot;org.apache.logging.log4j.test1&quot; level&#x3D;&quot;debug&quot; additivity&#x3D;&quot;false&quot;&gt;<br>      &lt;Filter type&#x3D;&quot;ThreadContextMapFilter&quot;&gt;<br>        &lt;KeyValuePair key&#x3D;&quot;test&quot; value&#x3D;&quot;123&quot;&#x2F;&gt;<br>      &lt;&#x2F;Filter&gt;<br>      &lt;AppenderRef ref&#x3D;&quot;STDOUT&quot;&#x2F;&gt;<br>    &lt;&#x2F;Logger&gt;<br> <br>    &lt;Logger name&#x3D;&quot;org.apache.logging.log4j.test2&quot; level&#x3D;&quot;debug&quot; additivity&#x3D;&quot;false&quot;&gt;<br>      &lt;AppenderRef ref&#x3D;&quot;File&quot;&#x2F;&gt;<br>    &lt;&#x2F;Logger&gt;<br> <br>    &lt;Root level&#x3D;&quot;trace&quot;&gt;<br>      &lt;AppenderRef ref&#x3D;&quot;STDOUT&quot;&#x2F;&gt;<br>    &lt;&#x2F;Root&gt;<br>  &lt;&#x2F;Loggers&gt;<br> <br>&lt;&#x2F;Configuration&gt;<br></code></pre></td></tr></table></figure>

<h3 id="logback-配置"><a href="#logback-配置" class="headerlink" title="logback 配置"></a>logback 配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;<br> <br>&lt;!-- logback中一共有5种有效级别，分别是TRACE、DEBUG、INFO、WARN、ERROR，优先级依次从低到高 --&gt;<br>&lt;configuration scan&#x3D;&quot;true&quot; scanPeriod&#x3D;&quot;60 seconds&quot; debug&#x3D;&quot;false&quot;&gt;<br> <br>  &lt;property name&#x3D;&quot;DIR_NAME&quot; value&#x3D;&quot;spring-helloworld&quot;&#x2F;&gt;<br> <br>  &lt;!-- 将记录日志打印到控制台 --&gt;<br>  &lt;appender name&#x3D;&quot;STDOUT&quot; class&#x3D;&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;<br>    &lt;encoder&gt;<br>      &lt;pattern&gt;%d&#123;HH:mm:ss.SSS&#125; [%thread] [%-5p] %c&#123;36&#125;.%M - %m%n&lt;&#x2F;pattern&gt;<br>    &lt;&#x2F;encoder&gt;<br>  &lt;&#x2F;appender&gt;<br> <br>  &lt;!-- RollingFileAppender begin --&gt;<br>  &lt;appender name&#x3D;&quot;ALL&quot; class&#x3D;&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;<br>    &lt;!-- 根据时间来制定滚动策略 --&gt;<br>    &lt;rollingPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;<br>      &lt;fileNamePattern&gt;$&#123;user.dir&#125;&#x2F;logs&#x2F;$&#123;DIR_NAME&#125;&#x2F;all.%d&#123;yyyy-MM-dd&#125;.log&lt;&#x2F;fileNamePattern&gt;<br>      &lt;maxHistory&gt;30&lt;&#x2F;maxHistory&gt;<br>    &lt;&#x2F;rollingPolicy&gt;<br> <br>    &lt;!-- 根据文件大小来制定滚动策略 --&gt;<br>    &lt;triggeringPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;<br>      &lt;maxFileSize&gt;30MB&lt;&#x2F;maxFileSize&gt;<br>    &lt;&#x2F;triggeringPolicy&gt;<br> <br>    &lt;encoder&gt;<br>      &lt;pattern&gt;%d&#123;HH:mm:ss.SSS&#125; [%thread] [%-5p] %c&#123;36&#125;.%M - %m%n&lt;&#x2F;pattern&gt;<br>    &lt;&#x2F;encoder&gt;<br>  &lt;&#x2F;appender&gt;<br> <br>  &lt;appender name&#x3D;&quot;ERROR&quot; class&#x3D;&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;<br>    &lt;!-- 根据时间来制定滚动策略 --&gt;<br>    &lt;rollingPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;<br>      &lt;fileNamePattern&gt;$&#123;user.dir&#125;&#x2F;logs&#x2F;$&#123;DIR_NAME&#125;&#x2F;error.%d&#123;yyyy-MM-dd&#125;.log&lt;&#x2F;fileNamePattern&gt;<br>      &lt;maxHistory&gt;30&lt;&#x2F;maxHistory&gt;<br>    &lt;&#x2F;rollingPolicy&gt;<br> <br>    &lt;!-- 根据文件大小来制定滚动策略 --&gt;<br>    &lt;triggeringPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;<br>      &lt;maxFileSize&gt;10MB&lt;&#x2F;maxFileSize&gt;<br>    &lt;&#x2F;triggeringPolicy&gt;<br> <br>    &lt;filter class&#x3D;&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;<br>      &lt;level&gt;ERROR&lt;&#x2F;level&gt;<br>      &lt;onMatch&gt;ACCEPT&lt;&#x2F;onMatch&gt;<br>      &lt;onMismatch&gt;DENY&lt;&#x2F;onMismatch&gt;<br>    &lt;&#x2F;filter&gt;<br> <br>    &lt;encoder&gt;<br>      &lt;pattern&gt;%d&#123;HH:mm:ss.SSS&#125; [%thread] [%-5p] %c&#123;36&#125;.%M - %m%n&lt;&#x2F;pattern&gt;<br>    &lt;&#x2F;encoder&gt;<br>  &lt;&#x2F;appender&gt;<br> <br>  &lt;appender name&#x3D;&quot;WARN&quot; class&#x3D;&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;<br>    &lt;!-- 根据时间来制定滚动策略 --&gt;<br>    &lt;rollingPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;<br>      &lt;fileNamePattern&gt;$&#123;user.dir&#125;&#x2F;logs&#x2F;$&#123;DIR_NAME&#125;&#x2F;warn.%d&#123;yyyy-MM-dd&#125;.log&lt;&#x2F;fileNamePattern&gt;<br>      &lt;maxHistory&gt;30&lt;&#x2F;maxHistory&gt;<br>    &lt;&#x2F;rollingPolicy&gt;<br> <br>    &lt;!-- 根据文件大小来制定滚动策略 --&gt;<br>    &lt;triggeringPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;<br>      &lt;maxFileSize&gt;10MB&lt;&#x2F;maxFileSize&gt;<br>    &lt;&#x2F;triggeringPolicy&gt;<br> <br>    &lt;filter class&#x3D;&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;<br>      &lt;level&gt;WARN&lt;&#x2F;level&gt;<br>      &lt;onMatch&gt;ACCEPT&lt;&#x2F;onMatch&gt;<br>      &lt;onMismatch&gt;DENY&lt;&#x2F;onMismatch&gt;<br>    &lt;&#x2F;filter&gt;<br> <br>    &lt;encoder&gt;<br>      &lt;pattern&gt;%d&#123;HH:mm:ss.SSS&#125; [%thread] [%-5p] %c&#123;36&#125;.%M - %m%n&lt;&#x2F;pattern&gt;<br>    &lt;&#x2F;encoder&gt;<br>  &lt;&#x2F;appender&gt;<br> <br>  &lt;appender name&#x3D;&quot;INFO&quot; class&#x3D;&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;<br>    &lt;!-- 根据时间来制定滚动策略 --&gt;<br>    &lt;rollingPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;<br>      &lt;fileNamePattern&gt;$&#123;user.dir&#125;&#x2F;logs&#x2F;$&#123;DIR_NAME&#125;&#x2F;info.%d&#123;yyyy-MM-dd&#125;.log&lt;&#x2F;fileNamePattern&gt;<br>      &lt;maxHistory&gt;30&lt;&#x2F;maxHistory&gt;<br>    &lt;&#x2F;rollingPolicy&gt;<br> <br>    &lt;!-- 根据文件大小来制定滚动策略 --&gt;<br>    &lt;triggeringPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;<br>      &lt;maxFileSize&gt;10MB&lt;&#x2F;maxFileSize&gt;<br>    &lt;&#x2F;triggeringPolicy&gt;<br> <br>    &lt;filter class&#x3D;&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;<br>      &lt;level&gt;INFO&lt;&#x2F;level&gt;<br>      &lt;onMatch&gt;ACCEPT&lt;&#x2F;onMatch&gt;<br>      &lt;onMismatch&gt;DENY&lt;&#x2F;onMismatch&gt;<br>    &lt;&#x2F;filter&gt;<br> <br>    &lt;encoder&gt;<br>      &lt;pattern&gt;%d&#123;HH:mm:ss.SSS&#125; [%thread] [%-5p] %c&#123;36&#125;.%M - %m%n&lt;&#x2F;pattern&gt;<br>    &lt;&#x2F;encoder&gt;<br>  &lt;&#x2F;appender&gt;<br> <br>  &lt;appender name&#x3D;&quot;DEBUG&quot; class&#x3D;&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;<br>    &lt;!-- 根据时间来制定滚动策略 --&gt;<br>    &lt;rollingPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;<br>      &lt;fileNamePattern&gt;$&#123;user.dir&#125;&#x2F;logs&#x2F;$&#123;DIR_NAME&#125;&#x2F;debug.%d&#123;yyyy-MM-dd&#125;.log&lt;&#x2F;fileNamePattern&gt;<br>      &lt;maxHistory&gt;30&lt;&#x2F;maxHistory&gt;<br>    &lt;&#x2F;rollingPolicy&gt;<br> <br>    &lt;!-- 根据文件大小来制定滚动策略 --&gt;<br>    &lt;triggeringPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;<br>      &lt;maxFileSize&gt;10MB&lt;&#x2F;maxFileSize&gt;<br>    &lt;&#x2F;triggeringPolicy&gt;<br> <br>    &lt;filter class&#x3D;&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;<br>      &lt;level&gt;DEBUG&lt;&#x2F;level&gt;<br>      &lt;onMatch&gt;ACCEPT&lt;&#x2F;onMatch&gt;<br>      &lt;onMismatch&gt;DENY&lt;&#x2F;onMismatch&gt;<br>    &lt;&#x2F;filter&gt;<br> <br>    &lt;encoder&gt;<br>      &lt;pattern&gt;%d&#123;HH:mm:ss.SSS&#125; [%thread] [%-5p] %c&#123;36&#125;.%M - %m%n&lt;&#x2F;pattern&gt;<br>    &lt;&#x2F;encoder&gt;<br>  &lt;&#x2F;appender&gt;<br> <br>  &lt;appender name&#x3D;&quot;TRACE&quot; class&#x3D;&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;<br>    &lt;!-- 根据时间来制定滚动策略 --&gt;<br>    &lt;rollingPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;<br>      &lt;fileNamePattern&gt;$&#123;user.dir&#125;&#x2F;logs&#x2F;$&#123;DIR_NAME&#125;&#x2F;trace.%d&#123;yyyy-MM-dd&#125;.log&lt;&#x2F;fileNamePattern&gt;<br>      &lt;maxHistory&gt;30&lt;&#x2F;maxHistory&gt;<br>    &lt;&#x2F;rollingPolicy&gt;<br> <br>    &lt;!-- 根据文件大小来制定滚动策略 --&gt;<br>    &lt;triggeringPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;<br>      &lt;maxFileSize&gt;10MB&lt;&#x2F;maxFileSize&gt;<br>    &lt;&#x2F;triggeringPolicy&gt;<br> <br>    &lt;filter class&#x3D;&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;<br>      &lt;level&gt;TRACE&lt;&#x2F;level&gt;<br>      &lt;onMatch&gt;ACCEPT&lt;&#x2F;onMatch&gt;<br>      &lt;onMismatch&gt;DENY&lt;&#x2F;onMismatch&gt;<br>    &lt;&#x2F;filter&gt;<br> <br>    &lt;encoder&gt;<br>      &lt;pattern&gt;%d&#123;HH:mm:ss.SSS&#125; [%thread] [%-5p] %c&#123;36&#125;.%M - %m%n&lt;&#x2F;pattern&gt;<br>    &lt;&#x2F;encoder&gt;<br>  &lt;&#x2F;appender&gt;<br> <br>  &lt;appender name&#x3D;&quot;SPRING&quot; class&#x3D;&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;<br>    &lt;!-- 根据时间来制定滚动策略 --&gt;<br>    &lt;rollingPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;<br>      &lt;fileNamePattern&gt;$&#123;user.dir&#125;&#x2F;logs&#x2F;$&#123;DIR_NAME&#125;&#x2F;springframework.%d&#123;yyyy-MM-dd&#125;.log<br>      &lt;&#x2F;fileNamePattern&gt;<br>      &lt;maxHistory&gt;30&lt;&#x2F;maxHistory&gt;<br>    &lt;&#x2F;rollingPolicy&gt;<br> <br>    &lt;!-- 根据文件大小来制定滚动策略 --&gt;<br>    &lt;triggeringPolicy class&#x3D;&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;<br>      &lt;maxFileSize&gt;10MB&lt;&#x2F;maxFileSize&gt;<br>    &lt;&#x2F;triggeringPolicy&gt;<br> <br>    &lt;encoder&gt;<br>      &lt;pattern&gt;%d&#123;HH:mm:ss.SSS&#125; [%thread] [%-5p] %c&#123;36&#125;.%M - %m%n&lt;&#x2F;pattern&gt;<br>    &lt;&#x2F;encoder&gt;<br>  &lt;&#x2F;appender&gt;<br>  &lt;!-- RollingFileAppender end --&gt;<br> <br>  &lt;!-- logger begin --&gt;<br>  &lt;!-- 本项目的日志记录，分级打印 --&gt;<br>  &lt;logger name&#x3D;&quot;org.zp.notes.spring&quot; level&#x3D;&quot;TRACE&quot; additivity&#x3D;&quot;false&quot;&gt;<br>    &lt;appender-ref ref&#x3D;&quot;STDOUT&quot;&#x2F;&gt;<br>    &lt;appender-ref ref&#x3D;&quot;ERROR&quot;&#x2F;&gt;<br>    &lt;appender-ref ref&#x3D;&quot;WARN&quot;&#x2F;&gt;<br>    &lt;appender-ref ref&#x3D;&quot;INFO&quot;&#x2F;&gt;<br>    &lt;appender-ref ref&#x3D;&quot;DEBUG&quot;&#x2F;&gt;<br>    &lt;appender-ref ref&#x3D;&quot;TRACE&quot;&#x2F;&gt;<br>  &lt;&#x2F;logger&gt;<br> <br>  &lt;!-- SPRING框架日志 --&gt;<br>  &lt;logger name&#x3D;&quot;org.springframework&quot; level&#x3D;&quot;WARN&quot; additivity&#x3D;&quot;false&quot;&gt;<br>    &lt;appender-ref ref&#x3D;&quot;SPRING&quot;&#x2F;&gt;<br>  &lt;&#x2F;logger&gt;<br> <br>  &lt;root level&#x3D;&quot;TRACE&quot;&gt;<br>    &lt;appender-ref ref&#x3D;&quot;ALL&quot;&#x2F;&gt;<br>  &lt;&#x2F;root&gt;<br>  &lt;!-- logger end --&gt;<br> <br>&lt;&#x2F;configuration&gt;<br></code></pre></td></tr></table></figure>

<h3 id="日志库API-针对于日志门面"><a href="#日志库API-针对于日志门面" class="headerlink" title="日志库API - 针对于日志门面"></a>日志库API - 针对于日志门面</h3><h3 id="slf4j-用法"><a href="#slf4j-用法" class="headerlink" title="slf4j 用法"></a>slf4j 用法</h3><p>使用 slf4j 的 API 很简单。使用LoggerFactory初始化一个Logger实例，然后调用 Logger 对应的打印等级函数就行了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs text">import org.slf4j.Logger;<br>import org.slf4j.LoggerFactory;<br> <br>public class App &#123;<br>    private static final Logger log &#x3D; LoggerFactory.getLogger(App.class);<br>    public static void main(String[] args) &#123;<br>        String msg &#x3D; &quot;print log, current level: &#123;&#125;&quot;;<br>        log.trace(msg, &quot;trace&quot;);<br>        log.debug(msg, &quot;debug&quot;);<br>        log.info(msg, &quot;info&quot;);<br>        log.warn(msg, &quot;warn&quot;);<br>        log.error(msg, &quot;error&quot;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="common-logging-用法"><a href="#common-logging-用法" class="headerlink" title="common-logging 用法"></a>common-logging 用法</h3><p>common-logging 用法和 slf4j 几乎一样，但是支持的打印等级多了一个更高级别的：fatal。</p>
<p>此外，common-logging 不支持{}替换参数，你只能选择拼接字符串这种方式了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs text">import org.apache.commons.logging.Log;<br>import org.apache.commons.logging.LogFactory;<br> <br>public class JclTest &#123;<br>    private static final Log log &#x3D; LogFactory.getLog(JclTest.class);<br> <br>    public static void main(String[] args) &#123;<br>        String msg &#x3D; &quot;print log, current level: &quot;;<br>        log.trace(msg + &quot;trace&quot;);<br>        log.debug(msg + &quot;debug&quot;);<br>        log.info(msg + &quot;info&quot;);<br>        log.warn(msg + &quot;warn&quot;);<br>        log.error(msg + &quot;error&quot;);<br>        log.fatal(msg + &quot;fatal&quot;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="日志库选型与改造"><a href="#日志库选型与改造" class="headerlink" title="日志库选型与改造"></a>日志库选型与改造</h2><h3 id="对Java日志组件选型的建议"><a href="#对Java日志组件选型的建议" class="headerlink" title="对Java日志组件选型的建议"></a>对Java日志组件选型的建议</h3><p>slf4j已经成为了Java日志组件的明星选手，可以完美替代JCL，使用JCL桥接库也能完美兼容一切使用JCL作为日志门面的类库，现在的新系统已经没有不使用slf4j作为日志API的理由了。</p>
<p>日志记录服务方面，log4j在功能上输于logback和log4j2，在性能方面log4j2则全面超越log4j和logback。所以新系统应该在logback和log4j2中做出选择，对于性能有很高要求的系统，应优先考虑log4j2</p>
<h3 id="对日志架构使用比较好的实践"><a href="#对日志架构使用比较好的实践" class="headerlink" title="对日志架构使用比较好的实践"></a>对日志架构使用比较好的实践</h3><h3 id="总是使用Log-Facade，而不是具体Log-Implementation"><a href="#总是使用Log-Facade，而不是具体Log-Implementation" class="headerlink" title="总是使用Log Facade，而不是具体Log Implementation"></a>总是使用Log Facade，而不是具体Log Implementation</h3><p>正如之前所说的，使用 Log Facade 可以方便的切换具体的日志实现。而且，如果依赖多个项目，使用了不同的Log Facade，还可以方便的通过 Adapter 转接到同一个实现上。如果依赖项目使用了多个不同的日志实现，就麻烦的多了。</p>
<p>具体来说，现在推荐使用 Log4j-API 或者 SLF4j，不推荐继续使用 JCL。</p>
<h3 id="只添加一个-Log-Implementation依赖"><a href="#只添加一个-Log-Implementation依赖" class="headerlink" title="只添加一个 Log Implementation依赖"></a>只添加一个 Log Implementation依赖</h3><p>毫无疑问，项目中应该只使用一个具体的 Log Implementation，建议使用 Logback 或者Log4j2。如果有依赖的项目中，使用的 Log Facade不支持直接使用当前的 Log Implementation，就添加合适的桥接器依赖。具体的桥接关系可以看上一篇文章的图。</p>
<h3 id="具体的日志实现依赖应该设置为optional和使用runtime-scope"><a href="#具体的日志实现依赖应该设置为optional和使用runtime-scope" class="headerlink" title="具体的日志实现依赖应该设置为optional和使用runtime scope"></a>具体的日志实现依赖应该设置为optional和使用runtime scope</h3><p>在项目中，Log Implementation的依赖强烈建议设置为runtime scope，并且设置为optional。例如项目中使用了 SLF4J 作为 Log Facade，然后想使用 Log4j2 作为 Implementation，那么使用 maven 添加依赖的时候这样设置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;dependency&gt;<br>  &lt;groupId&gt;org.apache.logging.log4j&lt;&#x2F;groupId&gt;<br>  &lt;artifactId&gt;log4j-core&lt;&#x2F;artifactId&gt;<br>  &lt;version&gt;$&#123;log4j.version&#125;&lt;&#x2F;version&gt;<br>  &lt;scope&gt;runtime&lt;&#x2F;scope&gt;<br>  &lt;optional&gt;true&lt;&#x2F;optional&gt;<br>&lt;&#x2F;dependency&gt;<br>&lt;dependency&gt;<br>  &lt;groupId&gt;org.apache.logging.log4j&lt;&#x2F;groupId&gt;<br>  &lt;artifactId&gt;log4j-slf4j-impl&lt;&#x2F;artifactId&gt;<br>  &lt;version&gt;$&#123;log4j.version&#125;&lt;&#x2F;version&gt;<br>  &lt;scope&gt;runtime&lt;&#x2F;scope&gt;<br>  &lt;optional&gt;true&lt;&#x2F;optional&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>

<p>设为optional，依赖不会传递，这样如果你是个lib项目，然后别的项目使用了你这个lib，不会被引入不想要的Log Implementation 依赖；</p>
<p><a href="https://link.zhihu.com/?target=https://blog.csdn.net/qq_42449963/article/details/105439486">https://blog.csdn.net/qq_42449963&#x2F;article&#x2F;details&#x2F;105439486</a></p>
<p>Scope设置为runtime，是为了防止开发人员在项目中直接使用Log Implementation中的类，而不适用Log Facade中的类。</p>
<p><a href="https://link.zhihu.com/?target=https://blog.csdn.net/festone000/article/details/119425651">https://blog.csdn.net/festone000/article/details/119425651</a></p>
<h3 id="如果有必要-排除依赖的第三方库中的Log-Impementation依赖"><a href="#如果有必要-排除依赖的第三方库中的Log-Impementation依赖" class="headerlink" title="如果有必要, 排除依赖的第三方库中的Log Impementation依赖"></a>如果有必要, 排除依赖的第三方库中的Log Impementation依赖</h3><p>这是很常见的一个问题，第三方库的开发者未必会把具体的日志实现或者桥接器的依赖设置为optional，然后你的项目继承了这些依赖——具体的日志实现未必是你想使用的，比如他依赖了Log4j，你想使用Logback，这时就很尴尬。另外，如果不同的第三方依赖使用了不同的桥接器和Log实现，也极容易形成环。</p>
<p>这种情况下，推荐的处理方法，是使用exclude来排除所有的这些Log实现和桥接器的依赖，只保留第三方库里面对Log Facade的依赖。</p>
<p>比如阿里的JStorm就没有很好的处理这个问题，依赖jstorm会引入对Logback和log4j-over-slf4j的依赖，如果你想在自己的项目中使用Log4j或其他Log实现的话，就需要加上excludes:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;dependency&gt;<br>    &lt;groupId&gt;com.alibaba.jstorm&lt;&#x2F;groupId&gt;<br>    &lt;artifactId&gt;jstorm-core&lt;&#x2F;artifactId&gt;<br>    &lt;version&gt;2.1.1&lt;&#x2F;version&gt;<br>    &lt;exclusions&gt;<br>        &lt;exclusion&gt;<br>            &lt;groupId&gt;org.slf4j&lt;&#x2F;groupId&gt;<br>            &lt;artifactId&gt;log4j-over-slf4j&lt;&#x2F;artifactId&gt;<br>        &lt;&#x2F;exclusion&gt;<br>        &lt;exclusion&gt;<br>            &lt;groupId&gt;ch.qos.logback&lt;&#x2F;groupId&gt;<br>            &lt;artifactId&gt;logback-classic&lt;&#x2F;artifactId&gt;<br>        &lt;&#x2F;exclusion&gt;<br>    &lt;&#x2F;exclusions&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>

<h3 id="避免为不会输出的log付出代价"><a href="#避免为不会输出的log付出代价" class="headerlink" title="避免为不会输出的log付出代价"></a>避免为不会输出的log付出代价</h3><p>Log库都可以灵活的设置输出界别，所以每一条程序中的log，都是有可能不会被输出的。这时候要注意不要额外的付出代价。</p>
<p>先看两个有问题的写法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">logger.debug(&quot;start process request, url: &quot; + url);<br>logger.debug(&quot;receive request: &#123;&#125;&quot;, toJson(request));<br></code></pre></td></tr></table></figure>

<h3 id="避免为不会输出的log付出代价-1"><a href="#避免为不会输出的log付出代价-1" class="headerlink" title="避免为不会输出的log付出代价"></a>避免为不会输出的log付出代价</h3><p>Log库都可以灵活的设置输出界别，所以每一条程序中的log，都是有可能不会被输出的。这时候要注意不要额外的付出代价。</p>
<p>先看两个有问题的写法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">logger.debug(&quot;start process request, url: &quot; + url);<br>logger.debug(&quot;receive request: &#123;&#125;&quot;, toJson(request));<br></code></pre></td></tr></table></figure>

<p>第一条是直接做了字符串拼接，所以即使日志级别高于debug也会做一个字符串连接操作；第二条虽然用了SLF4J&#x2F;Log4j2 中的懒求值方式来避免不必要的字符串拼接开销，但是toJson()这个函数却是都会被调用并且开销更大。</p>
<p>推荐的写法如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">logger.debug(&quot;start process request, url:&#123;&#125;&quot;, url); &#x2F;&#x2F; SLF4J&#x2F;LOG4J2<br>logger.debug(&quot;receive request: &#123;&#125;&quot;, () -&gt; toJson(request)); &#x2F;&#x2F; LOG4J2<br>logger.debug(() -&gt; &quot;receive request: &quot; + toJson(request)); &#x2F;&#x2F; LOG4J2<br>if (logger.isDebugEnabled()) &#123; &#x2F;&#x2F; SLF4J&#x2F;LOG4J2<br>    logger.debug(&quot;receive request: &quot; + toJson(request)); <br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="日志格式中最好不要使用行号，函数名等字段"><a href="#日志格式中最好不要使用行号，函数名等字段" class="headerlink" title="日志格式中最好不要使用行号，函数名等字段"></a>日志格式中最好不要使用行号，函数名等字段</h3><p>原因是，为了获取语句所在的函数名，或者行号，log库的实现都是获取当前的stacktrace，然后分析取出这些信息，而获取stacktrace的代价是很昂贵的。如果有很多的日志输出，就会占用大量的CPU。在没有特殊需要的情况下，建议不要在日志中输出这些这些字段。</p>
<p>最后， log中不要输出稀奇古怪的字符！</p>
<p>部分开发人员为了方便看到自己的log，会在log语句中加上醒目的前缀，比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">logger.debug(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;start process request&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);<br></code></pre></td></tr></table></figure>

<p>虽然对于自己来说是方便了，但是如果所有人都这样来做的话，那log输出就没法看了！正确的做法是使用grep 来看只自己关心的日志。</p>
<h3 id="对现有系统日志架构的改造建议"><a href="#对现有系统日志架构的改造建议" class="headerlink" title="对现有系统日志架构的改造建议"></a>对现有系统日志架构的改造建议</h3><p>如果现有系统使用JCL作为日志门面，又确实面临着JCL的ClassLoader机制带来的问题，完全可以引入slf4j并通过桥接库将JCL api输出的日志桥接至slf4j，再通过适配库适配至现有的日志输出服务（如log4j），如下图：</p>
<p><img src="/assets/1712902838-508802e98da2ff19f2fa52f49f35a79c.svg" srcset="/img/loading.gif" lazyload></p>
<p>这样做不需要任何代码级的改造，就可以解决JCL的ClassLoader带来的问题，但没有办法享受日志模板等slf4j的api带来的优点。不过之后在现系统上开发的新功能就可以使用slf4j的api了，老代码也可以分批进行改造。</p>
<p>如果现有系统使用JCL作为日志门面，又头疼JCL不支持logback和log4j2等新的日志服务，也可以通过桥接库以slf4j替代JCL，但同样无法直接享受slf4j api的优点。</p>
<p>如果想要使用slf4j的api，那么就不得不进行代码改造了，当然改造也可以参考1中提到的方式逐步进行。</p>
<p>如果现系统面临着log4j的性能问题，可以使用Apache Logging提供的log4j到log4j2的桥接库log4j-1.2-api，把通过log4j api输出的日志桥接至log4j2。这样可以最快地使用上log4j2的先进性能，但组件中缺失了slf4j，对后续进行日志架构改造的灵活性有影响。另一种办法是先把log4j桥接至slf4j，再使用slf4j到log4j2的适配库。这样做稍微麻烦了一点，但可以逐步将系统中的日志输出标准化为使用slf4j的api，为后面的工作打好基础。</p>
<h2 id="常用开发库-JSON库详解"><a href="#常用开发库-JSON库详解" class="headerlink" title="常用开发库 - JSON库详解"></a>常用开发库 - JSON库详解</h2><p>JSON应用非常广泛，对于Java常用的JSON库要完全掌握; 其中考虑到FastJson代码质量，漏洞，坑等等，应该尽量避免使用。</p>
<h2 id="JSON简介"><a href="#JSON简介" class="headerlink" title="JSON简介"></a>JSON简介</h2><h3 id="JSON是什么"><a href="#JSON是什么" class="headerlink" title="JSON是什么"></a>JSON是什么</h3><ul>
<li>JSON 指的是 JavaScript 对象表示法（JavaScript Object Notation）</li>
<li>JSON 是轻量级的文本数据交换格式</li>
<li>JSON 独立于语言：JSON 使用 Javascript语法来描述数据对象，但是 JSON 仍然独立于语言和平台。JSON 解析器和 JSON 库支持许多不同的编程语言。 目前非常多的动态（PHP，JSP，.NET）编程语言都支持JSON。</li>
<li>JSON 具有自我描述性，更易理解</li>
</ul>
<h3 id="结构与类型"><a href="#结构与类型" class="headerlink" title="结构与类型"></a>结构与类型</h3><ul>
<li>只有两种结构：对象内的键值对集合结构和数组，对象用{}表示、内部是”key”:”value”，数组用[]表示，不同值用逗号分开</li>
<li>基本数值有7个： false &#x2F; null &#x2F; true &#x2F; object &#x2F; array &#x2F; number &#x2F; string</li>
<li>再加上结构可以嵌套，进而可以用来表达复杂的数据</li>
</ul>
<p>一个简单实例</p>
<h3 id="JSON优秀资源"><a href="#JSON优秀资源" class="headerlink" title="JSON优秀资源"></a>JSON优秀资源</h3><ul>
<li><a href="https://link.zhihu.com/?target=https://github.com/burningtree/awesome-json">awesome-json(opens new window)</a></li>
</ul>
<h3 id="JSON在线解析工具"><a href="#JSON在线解析工具" class="headerlink" title="JSON在线解析工具"></a>JSON在线解析工具</h3><ul>
<li><a href="https://link.zhihu.com/?target=http://c.runoob.com/front-end/53">JSON 在线解析</a></li>
</ul>
<h2 id="JSON类库"><a href="#JSON类库" class="headerlink" title="JSON类库"></a>JSON类库</h2><p>Java中并没有内置JSON的解析，因此使用JSON需要借助第三方类库。</p>
<p>下面是几个常用的 JSON 解析类库：</p>
<ul>
<li>FastJson: 阿里巴巴开发的 JSON 库，性能优秀。</li>
<li>Jackson: 社区十分活跃且更新速度很快。</li>
<li>Gson: 谷歌开发的 JSON 库，功能十分全面。</li>
</ul>
<h3 id="性能测试对比"><a href="#性能测试对比" class="headerlink" title="性能测试对比"></a>性能测试对比</h3><p>从下面的测试结果可以看出，序列化次数比较小的时候，Gson性能最好，当不断增加的时候到了100000，Gson明显弱于Jackson和FastJson， 这时候FastJson性能是真的牛，另外还可以看到不管数量少还是多，Jackson一直表现优异。而那个Json-lib可以直接忽略。</p>
<ul>
<li>JSON序列化性能</li>
</ul>
<p><img src="/assets/1712902838-be06c3cc23862a66a097e70faed8dd27.svg" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>JSON反序列化性能</li>
</ul>
<p><img src="/assets/1712902838-be06c3cc23862a66a097e70faed8dd27.svg" srcset="/img/loading.gif" lazyload></p>
<p>更多请参考： <a href="https://link.zhihu.com/?target=https://www.xncoding.com/2018/01/09/java/jsons.html">Java几种常用JSON库性能比较(opens new window)</a></p>
<h2 id="FastJson"><a href="#FastJson" class="headerlink" title="FastJson"></a>FastJson</h2><p>先泼一盆冷水，个人非常不推荐使用FastJson, 为什么？</p>
<ul>
<li>FastJson 源码质量较低</li>
<li>FastJson Bug、漏洞较多</li>
<li>FastJson 牺牲多数场景下的稳定性而提高的效率</li>
</ul>
<h3 id="Fastjson-简介"><a href="#Fastjson-简介" class="headerlink" title="Fastjson 简介"></a>Fastjson 简介</h3><p>Fastjson 是一个 Java 库，可以将 Java 对象转换为 JSON 格式，当然它也可以将 JSON 字符串转换为 Java 对象。</p>
<p>Fastjson 可以操作任何 Java 对象，即使是一些预先存在的没有源码的对象。</p>
<ul>
<li><a href="https://link.zhihu.com/?target=https://github.com/alibaba/fastjson">Fastjson Github(opens new window)</a>看这里</li>
<li><a href="https://link.zhihu.com/?target=https://github.com/alibaba/fastjson/wiki/Quick-Start-CN">Fastjson 中文 Wiki(opens new window)</a></li>
</ul>
<h3 id="Fastjson-特性"><a href="#Fastjson-特性" class="headerlink" title="Fastjson 特性"></a>Fastjson 特性</h3><ul>
<li>提供服务器端、安卓客户端两种解析工具，性能表现较好。</li>
<li>提供了 toJSONString() 和 parseObject() 方法来将 Java 对象与 JSON 相互转换。调用toJSONString方 法即可将对象转换成 JSON 字符串，parseObject 方法则反过来将 JSON 字符串转换成对象。</li>
<li>允许转换预先存在的无法修改的对象（只有class、无源代码）。</li>
<li>Java泛型的广泛支持。</li>
<li>允许对象的自定义表示、允许自定义序列化类。</li>
<li>支持任意复杂对象（具有深厚的继承层次和广泛使用的泛型类型）。</li>
</ul>
<h3 id="下载和使用"><a href="#下载和使用" class="headerlink" title="下载和使用"></a>下载和使用</h3><p>你可以在 maven 中央仓库中直接下载：<a href="https://link.zhihu.com/?target=http://repo1.maven.org/maven2/com/alibaba/fastjson/">http://repo1.maven.org/maven2/com/alibaba/fastjson/(opens new window)</a></p>
<p>配置 maven 依赖:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;dependency&gt;<br>  &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;<br>  &lt;artifactId&gt;fastjson&lt;&#x2F;artifactId&gt;<br>  &lt;version&gt;x.x.x&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>

<p>其中 x.x.x 是版本号，根据需要使用特定版本，建议使用最新版本。</p>
<h3 id="序列化一个对象成JSON字符串"><a href="#序列化一个对象成JSON字符串" class="headerlink" title="序列化一个对象成JSON字符串"></a>序列化一个对象成JSON字符串</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">User user &#x3D; new User();<br>user.setName(&quot;校长&quot;);<br>user.setAge(3);<br>user.setSalary(new BigDecimal(&quot;123456789.0123&quot;));<br>String jsonString &#x3D; JSON.toJSONString(user);<br>System.out.println(jsonString);<br>&#x2F;&#x2F; 输出 &#123;&quot;age&quot;:3,&quot;name&quot;:&quot;校长&quot;,&quot;old&quot;:false,&quot;salary&quot;:123456789.0123&#125;<br></code></pre></td></tr></table></figure>

<h3 id="反序列化一个JSON字符串成Java对象"><a href="#反序列化一个JSON字符串成Java对象" class="headerlink" title="反序列化一个JSON字符串成Java对象"></a>反序列化一个JSON字符串成Java对象</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs text">String jsonString &#x3D; &quot;&#123;\&quot;age\&quot;:3,\&quot;birthdate\&quot;:1496738822842,\&quot;name\&quot;:\&quot;校长\&quot;,\&quot;old\&quot;:true,\&quot;salary\&quot;:123456789.0123&#125;&quot;;<br> User u &#x3D; JSON.parseObject(jsonString ,User.class);<br> System.out.println(u.getName());<br> &#x2F;&#x2F; 输出 校长<br><br>String jsonStringArray &#x3D; &quot;[&#123;\&quot;age\&quot;:3,\&quot;birthdate\&quot;:1496738822842,\&quot;name\&quot;:\&quot;校长\&quot;,\&quot;old\&quot;:true,\&quot;salary\&quot;:123456789.0123&#125;]&quot;;<br>List&lt;User&gt; userList &#x3D; JSON.parseArray(jsonStringArray, User.class);<br>System.out.println(userList.size());<br>&#x2F;&#x2F; 输出 1<br></code></pre></td></tr></table></figure>

<h3 id="FastJson漏洞问题"><a href="#FastJson漏洞问题" class="headerlink" title="FastJson漏洞问题"></a>FastJson漏洞问题</h3><p>尽量使用最新版本。</p>
<ul>
<li><a href="https://link.zhihu.com/?target=http://blog.nsfocus.net/analysis-protection-fastjson-remote-code-execution-vulnerability/">fastjson远程代码执行漏洞技术分析与防护方案(opens new window)</a></li>
</ul>
<p>好了，我要开喷了。</p>
<p>DANGER</p>
<p>远离FastJson这个库，老程序员都知道这里有多少坑:</p>
<ul>
<li><a href="https://link.zhihu.com/?target=https://github.com/alibaba/fastjson/issues">alibaba&#x2F;fastjson(opens new window)</a></li>
<li><a href="https://www.zhihu.com/question/44199956/answer/112224034" target="_blank" rel="noopener">fastjson这么快老外为啥还是热衷 jackson?</a></li>
</ul>
<h2 id="JackSon"><a href="#JackSon" class="headerlink" title="JackSon"></a>JackSon</h2><h3 id="JackSon简介"><a href="#JackSon简介" class="headerlink" title="JackSon简介"></a>JackSon简介</h3><ul>
<li><a href="https://link.zhihu.com/?target=https://github.com/FasterXML/jackson">Jackson Github(opens new window)</a>看这里</li>
<li><a href="https://link.zhihu.com/?target=http://wiki.fasterxml.com/JacksonHome">Jackson Wiki(opens new window)</a></li>
<li><a href="https://link.zhihu.com/?target=https://github.com/FasterXML/jackson-docs">Jackson 文档(opens new window)</a></li>
</ul>
<h3 id="Jackson组件"><a href="#Jackson组件" class="headerlink" title="Jackson组件"></a>Jackson组件</h3><h3 id="3个核心模块："><a href="#3个核心模块：" class="headerlink" title="3个核心模块："></a>3个核心模块：</h3><ul>
<li><strong>Streaming</strong>: jackson-core jar，定义了底层的streaming API和实现了Json特性。</li>
<li><strong>Annotations</strong>: jackson-annotations jar，包含了标准的Jackson注解。本文暂不介绍。</li>
<li><strong>Databind</strong>: jackson-databind jar，实现了数据绑定和对象序列化，它依赖于streaming和annotations的包。</li>
</ul>
<h3 id="第三方数据类型模块"><a href="#第三方数据类型模块" class="headerlink" title="第三方数据类型模块"></a>第三方数据类型模块</h3><p>这些扩展是插件式的Jackson模块，用ObjectMapper.registerModule()注册，并且通过添加serializers和deserializers以便Databind包（ObjectMapper &#x2F; ObjectReader &#x2F; ObjectWriter）可以读写这些类型，来增加对各种常用的Java库的数据类型的支持。</p>
<h3 id="数据格式模块"><a href="#数据格式模块" class="headerlink" title="数据格式模块"></a>数据格式模块</h3><p>Jackson也有处理程序对JAX-RS标准实现者例如Jersey, RESTeasy, CXF等提供了数据格式支持。处理程序实现了MessageBodyReader和MessageBodyWriter，目前支持的数据格式包括JSON, Smile, XML, YAML和CBOR。</p>
<p>数据格式提供了除了Json之外的数据格式支持，它们绝大部分仅仅实现了streaming API abstractions，以便数据绑定组件可以按照原来的方式使用。另一些（几乎不需要）提供了databind标准功能来处理例如schemas。</p>
<h3 id="Jackson的使用"><a href="#Jackson的使用" class="headerlink" title="Jackson的使用"></a>Jackson的使用</h3><p>引用maven jar包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;com.fasterxml.jackson.core&#x2F;jackson-core --&gt;<br>&lt;dependency&gt;<br>  &lt;groupId&gt;com.fasterxml.jackson.core&lt;&#x2F;groupId&gt;<br>  &lt;artifactId&gt;jackson-core&lt;&#x2F;artifactId&gt;<br>  &lt;version&gt;2.10.1&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br>&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;com.fasterxml.jackson.core&#x2F;jackson-databind --&gt;<br>&lt;dependency&gt;<br>  &lt;groupId&gt;com.fasterxml.jackson.core&lt;&#x2F;groupId&gt;<br>  &lt;artifactId&gt;jackson-databind&lt;&#x2F;artifactId&gt;<br>  &lt;version&gt;2.10.1&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br>&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;com.fasterxml.jackson.core&#x2F;jackson-annotations --&gt;<br>&lt;dependency&gt;<br>  &lt;groupId&gt;com.fasterxml.jackson.core&lt;&#x2F;groupId&gt;<br>  &lt;artifactId&gt;jackson-annotations&lt;&#x2F;artifactId&gt;<br>  &lt;version&gt;2.10.1&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>

<h3 id="序列化一个对象成JSON字符串-1"><a href="#序列化一个对象成JSON字符串-1" class="headerlink" title="序列化一个对象成JSON字符串"></a>序列化一个对象成JSON字符串</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs text">public void toJson() throws JsonProcessingException &#123;<br>    <br>    ObjectMapper mapper &#x3D; new ObjectMapper();<br>    <br>    City case1 &#x3D; new City();<br>    case1.setCity(&quot;SZ&quot;);<br>    case1.setAge(123);<br>    <br>    String jsonStr &#x3D; mapper.writeValueAsString(case1);<br>    System.out.println(&quot;JSON:&quot; + jsonStr);<br>&#125;<br>&#x2F;&#x2F; 输出：JSON:&#123;&quot;city&quot;:&quot;SZ&quot;,&quot;age&quot;:123&#125;<br></code></pre></td></tr></table></figure>

<h3 id="反序列化一个JSON字符串成Java对象-1"><a href="#反序列化一个JSON字符串成Java对象-1" class="headerlink" title="反序列化一个JSON字符串成Java对象"></a>反序列化一个JSON字符串成Java对象</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs text">public void toObj() throws JsonParseException, JsonMappingException, IOException &#123;<br>    ObjectMapper mapper &#x3D; new ObjectMapper();<br>    String inputjsonstr &#x3D; &quot;&#123;\&quot;city\&quot;:\&quot;SZ\&quot;,\&quot;age\&quot;:123&#125;&quot;;<br>    <br>    City readcase &#x3D; mapper.readValue(inputjsonstr, City.class);<br><br>    System.out.println(&quot;city info:&quot; + readcase);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>如果里面有未知属性，比如json中有desc字段，但是City中没有相应字段，会报错, 需要设置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">mapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);<br></code></pre></td></tr></table></figure>

<h3 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h3><ul>
<li>@JsonProperty(“xxx”): 将当前的属性名在json字符串中重新命名为当前设置的这个值，比如在示例中，将age–&gt;mAge</li>
<li>@JsonIgnore: 将被标注的属性在生成json字符串的时候，直接忽略</li>
<li>@JsonInclude: 是一个类级别的设置，JsonInclude.Include.NON_EMPTY标识只有非NULL的值才会被纳入json string之中，其余的都被忽略，比如这里的location属性，并没有出现在最终的结果字符串中。</li>
<li>@JsonSerialize: 使用自定义的类来实现自定义的字段转换。写入操作。</li>
<li>@JsonDeserialize: 解析的时候，自定义的转换器；读取操作。</li>
<li>@JsonAutoDetect: 设置类的访问策略，是否所有的属性都可以，还是按照一定的方式来提取。</li>
<li>@JsonRawValue: 无转换的将属性值写入到json 字符串中。 写入操作</li>
<li>@JsonValue: 标注方法，用以替代缺省的方法，由该方法来完成json的字符输出。</li>
</ul>
<h2 id="GSON"><a href="#GSON" class="headerlink" title="GSON"></a>GSON</h2><h3 id="Gson简介"><a href="#Gson简介" class="headerlink" title="Gson简介"></a>Gson简介</h3><p>Gson是这样一个Java类库，它可以将Java对象转换为相应的JSON形式，也可以将JSON字符串转换为对应的Java对象。 Gson可以使用任意Java对象，包括哪些预先存在的、不在你的源代码中的对象（因此，你并不知道对象的属性）。</p>
<ul>
<li><a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/1e20b28c39d1">Gson用户指南（中文翻译）(opens new window)</a>看这里</li>
</ul>
<h3 id="Gson的目标"><a href="#Gson的目标" class="headerlink" title="Gson的目标"></a>Gson的目标</h3><ul>
<li>提供一种机制，使得将Java对象转换为JSON或相反如使用toString()以及构造器（工厂方法）一样简单。</li>
<li>允许预先存在的不可变的对象转换为JSON或与之相反。</li>
<li>允许自定义对象的表现形式</li>
<li>支持任意复杂的对象</li>
<li>输出轻量易读的JSON</li>
</ul>
<h3 id="Gson的使用"><a href="#Gson的使用" class="headerlink" title="Gson的使用"></a>Gson的使用</h3><p>使用Gson的首要类是Gson类，你可以仅仅通过new Gson()的方式创建它。你也可以通过GsonBuilder类去创建Gson实例，这个类允许你进行一系列配置，例如版本控制等等。</p>
<p>Gson实例不会保存任何进行Json操作时的状态。因此，你可以自由的服用相同的Gson对象进行诸多的Json序列化和反序列化操作。</p>
<p>引用maven jar包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;com.google.guava&#x2F;guava --&gt;<br>&lt;dependency&gt;<br>  &lt;groupId&gt;com.google.guava&lt;&#x2F;groupId&gt;<br>  &lt;artifactId&gt;guava&lt;&#x2F;artifactId&gt;<br>  &lt;version&gt;28.2-jre&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>

<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs text">&#x2F;&#x2F; 基础类型<br>Gson gson &#x3D; new Gson();<br>gson.toJson(1);            &#x3D;&#x3D;&gt; prints 1<br>    gson.toJson(&quot;abcd&quot;);       &#x3D;&#x3D;&gt; prints &quot;abcd&quot;<br>    gson.toJson(new Long(10)); &#x3D;&#x3D;&gt; prints 10<br>    int[] values &#x3D; &#123; 1 &#125;;<br>gson.toJson(values);       &#x3D;&#x3D;&gt; prints [1]<br><br>&#x2F;&#x2F; 对象<br>BagOfPrimitives obj &#x3D; new BagOfPrimitives();<br>Gson gson &#x3D; new Gson();<br>String json &#x3D; gson.toJson(obj);  <br>&#x3D;&#x3D;&gt; json is &#123;&quot;value1&quot;:1,&quot;value2&quot;:&quot;abc&quot;&#125;<br><br>&#x2F;&#x2F; 数组<br>Gson gson &#x3D; new Gson();<br>int[] ints &#x3D; &#123;1, 2, 3, 4, 5&#125;;<br>String[] strings &#x3D; &#123;&quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot;&#125;;<br>gson.toJson(ints);     &#x3D;&#x3D;&gt; prints [1,2,3,4,5]<br>gson.toJson(strings);  &#x3D;&#x3D;&gt; prints [&quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot;]<br><br>&#x2F;&#x2F; 集合<br>Gson gson &#x3D; new Gson();<br>Collection&lt;Integer&gt; ints &#x3D; Lists.immutableList(1,2,3,4,5);<br>String json &#x3D; gson.toJson(ints); &#x3D;&#x3D;&gt; json is [1,2,3,4,5]<br></code></pre></td></tr></table></figure>

<p>其中的对象代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs text">class BagOfPrimitives &#123;<br>  private int value1 &#x3D; 1;<br>  private String value2 &#x3D; &quot;abc&quot;;<br>  private transient int value3 &#x3D; 3;<br>  BagOfPrimitives() &#123;<br>    &#x2F;&#x2F; no-args constructor<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs text">&#x2F;&#x2F; 基础类型<br>Gson gson &#x3D; new Gson();<br>int one &#x3D; gson.fromJson(&quot;1&quot;, int.class);<br>Integer one &#x3D; gson.fromJson(&quot;1&quot;, Integer.class);<br>Long one &#x3D; gson.fromJson(&quot;1&quot;, Long.class);<br>Boolean false &#x3D; gson.fromJson(&quot;false&quot;, Boolean.class);<br>String str &#x3D; gson.fromJson(&quot;\&quot;abc\&quot;&quot;, String.class);<br>String anotherStr &#x3D; gson.fromJson(&quot;[\&quot;abc\&quot;]&quot;, String.class);<br><br>&#x2F;&#x2F; 对象<br>BagOfPrimitives obj2 &#x3D; gson.fromJson(json, BagOfPrimitives.class);   <br>&#x3D;&#x3D;&gt; obj2 is just like obj<br><br>&#x2F;&#x2F; 数组<br>Gson gson &#x3D; new Gson();<br>int[] ints2 &#x3D; gson.fromJson(&quot;[1,2,3,4,5]&quot;, int[].class); <br>&#x3D;&#x3D;&gt; ints2 will be same as ints<br><br>&#x2F;&#x2F; 集合<br>Gson gson &#x3D; new Gson();<br>Type collectionType &#x3D; new TypeToken&lt;Collection&lt;Integer&gt;&gt;()&#123;&#125;.getType();<br>Collection&lt;Integer&gt; ints2 &#x3D; gson.fromJson(json, collectionType);<br>ints2 is same as ints<br></code></pre></td></tr></table></figure>

<h3 id="自定义序列化和反序列化机制"><a href="#自定义序列化和反序列化机制" class="headerlink" title="自定义序列化和反序列化机制"></a>自定义序列化和反序列化机制</h3><p>有时候，默认的实现并不是你想要的。这在处理类库时常常发生（例如DateTime）。Gson允许你注册自己自定义的序列化器和反序列化器。该过程分为两部分：</p>
<ul>
<li>Json序列化器：需要为一个对象自定义序列化机制。</li>
<li>Json反序列化器：需要为一个类型自定义反序列化机制。</li>
</ul>
<p>实例构造者：并不需要，如果无参构造器是可用的或者注册了一个反序列化器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs text">GsonBuilder gson &#x3D; new GsonBuilder();<br>gson.registerTypeAdapter(MyType2.class, new MyTypeAdapter());<br>gson.registerTypeAdapter(MyType.class, new MySerializer());<br>gson.registerTypeAdapter(MyType.class, new MyDeserializer());<br>gson.registerTypeAdapter(MyType.class, new MyInstanceCreator());<br></code></pre></td></tr></table></figure>

<p>registerTypeAdapter会检查类型适配器是否实现了上面三个接口中的一个以上并且它们都注册了类型适配器。</p>
<h2 id="常用开发库-Lombok工具库详解"><a href="#常用开发库-Lombok工具库详解" class="headerlink" title="常用开发库 - Lombok工具库详解"></a>常用开发库 - Lombok工具库详解</h2><p>Lombok是一款非常实用Java工具，可用来帮助开发人员消除Java的冗长代码，尤其是对于简单的Java对象（POJO）。实际上我并不推荐使用Lombok（不主动使用它）, 但是因为它有着很大的使用量，我们仍然有必要掌握它，不仅知道如何使用和它解决的问题，还要知道它的坑。</p>
<h2 id="Lombok的引入"><a href="#Lombok的引入" class="headerlink" title="Lombok的引入"></a>Lombok的引入</h2><p>我们通常需要编写大量代码才能使类变得有用。如以下内容：</p>
<ul>
<li>toString()方法</li>
<li>hashCode() and equals()方法</li>
<li>Getter and Setter 方法</li>
<li>构造函数</li>
</ul>
<p>对于这种简单的类，这些方法通常是无聊的、重复的，而且是可以很容易地机械地生成的那种东西(ide通常提供这种功能)。</p>
<h3 id="在引入Lombok之前我们是怎么做的"><a href="#在引入Lombok之前我们是怎么做的" class="headerlink" title="在引入Lombok之前我们是怎么做的"></a>在引入Lombok之前我们是怎么做的</h3><p>IDE中添加getter&#x2F;setter, toString等代码</p>
<h2 id="Lombok的安装和使用"><a href="#Lombok的安装和使用" class="headerlink" title="Lombok的安装和使用"></a>Lombok的安装和使用</h2><h3 id="Lombok官网"><a href="#Lombok官网" class="headerlink" title="Lombok官网"></a>Lombok官网</h3><ul>
<li><a href="https://link.zhihu.com/?target=https://projectlombok.org/">Lombok官网(opens new window)</a></li>
</ul>
<h3 id="Lombok安装"><a href="#Lombok安装" class="headerlink" title="Lombok安装"></a>Lombok安装</h3><p>IDEA搜索Lombok插件</p>
<p><img src="/assets/1712902838-937dc9a4ed78eca946dab78a0845781c.svg" srcset="/img/loading.gif" lazyload></p>
<p>另外需要注意的是，在使用lombok注解的时候记得要导入lombok.jar包到工程，如果使用的是Maven的工程项目的话，要在其pom.xml中添加依赖如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;org.projectlombok&#x2F;lombok --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;<br>    &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;<br>    &lt;version&gt;1.18.12&lt;&#x2F;version&gt;<br>    &lt;scope&gt;provided&lt;&#x2F;scope&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>

<h3 id="Lombok注解说明"><a href="#Lombok注解说明" class="headerlink" title="Lombok注解说明"></a>Lombok注解说明</h3><p>看<a href="https://link.zhihu.com/?target=https://projectlombok.org/features/all">官网这里(opens new window)</a></p>
<ul>
<li>val：用在局部变量前面，相当于将变量声明为final</li>
<li>@NonNull：给方法参数增加这个注解会自动在方法内对该参数进行是否为空的校验，如果为空，则抛出NPE（NullPointerException）</li>
<li>@Cleanup：自动管理资源，用在局部变量之前，在当前变量范围内即将执行完毕退出之前会自动清理资源，自动生成try-finally这样的代码来关闭流</li>
<li>@Getter&#x2F;@Setter：用在属性上，再也不用自己手写setter和getter方法了，还可以指定访问范围</li>
<li>@ToString：用在类上，可以自动覆写toString方法，当然还可以加其他参数，例如@ToString(exclude&#x3D;”id”)排除id属性，或者@ToString(callSuper&#x3D;true, includeFieldNames&#x3D;true)调用父类的toString方法，包含所有属性</li>
<li>@EqualsAndHashCode：用在类上，自动生成equals方法和hashCode方法</li>
<li>@NoArgsConstructor, @RequiredArgsConstructor and @AllArgsConstructor：用在类上，自动生成无参构造和使用所有参数的构造函数以及把所有+ @NonNull属性作为参数的构造函数，如果指定staticName &#x3D; “of”`参数，同时还会生成一个返回类对象的静态工厂方法，比使用构造函数方便很多</li>
<li>@Data：注解在类上，相当于同时使用了@ToString、@EqualsAndHashCode、@Getter、@Setter和@RequiredArgsConstrutor这些注解，对于POJO类十分有用</li>
<li>@Value：用在类上，是@Data的不可变形式，相当于为属性添加final声明，只提供getter方法，而不提供setter方法</li>
<li>@Builder：用在类、构造器、方法上，为你提供复杂的builder APIs，让你可以像如下方式一样调用Person.builder().name(“Adam Savage”).city(“San Francisco”).job(“Mythbusters”).job(“Unchained Reaction”).build();更多说明参考Builder</li>
<li>@SneakyThrows：自动抛受检异常，而无需显式在方法上使用throws语句</li>
<li>@Synchronized：用在方法上，将方法声明为同步的，并自动加锁，而锁对象是一个私有的属性$lock或$LOCK，而java中的synchronized关键字锁对象是this，锁在this或者自己的类对象上存在副作用，就是你不能阻止非受控代码去锁this或者类对象，这可能会导致竞争条件或者其它线程错误</li>
<li>@Getter(lazy&#x3D;true)：可以替代经典的Double Check Lock样板代码</li>
<li>@Log：根据不同的注解生成不同类型的log对象，但是实例名称都是log，有六种可选实现类</li>
<li>@CommonsLog Creates log &#x3D; org.apache.commons.logging.LogFactory.getLog(LogExample.class);</li>
<li>@Log Creates log &#x3D; java.util.logging.Logger.getLogger(LogExample.class.getName());</li>
<li>@Log4j Creates log &#x3D; org.apache.log4j.Logger.getLogger(LogExample.class);</li>
<li>@Log4j2 Creates log &#x3D; org.apache.logging.log4j.LogManager.getLogger(LogExample.class);</li>
<li>@Slf4j Creates log &#x3D; org.slf4j.LoggerFactory.getLogger(LogExample.class);</li>
<li>@XSlf4j Creates log &#x3D; org.slf4j.ext.XLoggerFactory.getXLogger(LogExample.class);</li>
</ul>
<h2 id="Lombok深入理解"><a href="#Lombok深入理解" class="headerlink" title="Lombok深入理解"></a>Lombok深入理解</h2><p>接下来我们深入理解下Lombok：</p>
<h3 id="Lombok解决了什么问题"><a href="#Lombok解决了什么问题" class="headerlink" title="Lombok解决了什么问题"></a>Lombok解决了什么问题</h3><p>这个简单，就是简化代码。</p>
<h3 id="Lombok的原理"><a href="#Lombok的原理" class="headerlink" title="Lombok的原理"></a>Lombok的原理</h3><p>会发现在Lombok使用的过程中，只需要添加相应的注解，无需再为此写任何代码。自动生成的代码到底是如何产生的呢？</p>
<p>核心之处就是对于注解的解析上。JDK5引入了注解的同时，也提供了两种解析方式。</p>
<ul>
<li><strong>运行时解析</strong></li>
</ul>
<p>运行时能够解析的注解，必须将@Retention设置为RUNTIME, 比如@Retention(RetentionPolicy.RUNTIME)，这样就可以通过反射拿到该注解。java.lang,reflect反射包中提供了一个接口AnnotatedElement，该接口定义了获取注解信息的几个方法，Class、Constructor、Field、Method、Package等都实现了该接口，对反射熟悉的朋友应该都会很熟悉这种解析方式。</p>
<ul>
<li><strong>编译时解析</strong></li>
</ul>
<p>编译时解析有两种机制，分别简单描述下：</p>
<p>1）Annotation Processing Tool</p>
<p>apt自JDK5产生，JDK7已标记为过期，不推荐使用，JDK8中已彻底删除，自JDK6开始，可以使用Pluggable Annotation Processing API来替换它，apt被替换主要有2点原因：</p>
<ul>
<li>api都在com.sun.mirror非标准包下</li>
<li>没有集成到javac中，需要额外运行</li>
</ul>
<p>2）Pluggable Annotation Processing API</p>
<p><a href="https://link.zhihu.com/?target=https://www.jcp.org/en/jsr/proposalDetails?id=269">JSR 269: Pluggable Annotation Processing API(opens new window)</a>自JDK6加入，作为apt的替代方案，它解决了apt的两个问题，javac在执行的时候会调用实现了该API的程序，这样我们就可以对编译器做一些增强，这时javac执行的过程如下：</p>
<p><img src="/assets/1712902838-65981fa8cb40832f3a13cf976831adb3.svg" srcset="/img/loading.gif" lazyload></p>
<p>Lombok本质上就是一个实现了“JSR 269 API”的程序。在使用javac的过程中，它产生作用的具体流程如下：</p>
<ul>
<li>javac对源代码进行分析，生成了一棵抽象语法树（AST）</li>
<li>运行过程中调用实现了“JSR 269 API”的Lombok程序</li>
<li>此时Lombok就对第一步骤得到的AST进行处理，找到@Data注解所在类对应的语法树（AST），然后修改该语法树（AST），增加getter和setter方法定义的相应树节点</li>
<li>javac使用修改后的抽象语法树（AST）生成字节码文件，即给class增加新的节点（代码块）</li>
</ul>
<p><img src="/assets/1712902838-6d7a1ba652e187416dab17b8298c8382.svg" srcset="/img/loading.gif" lazyload></p>
<p>从上面的Lombok执行的流程图中可以看出，在Javac 解析成AST抽象语法树之后, Lombok 根据自己编写的注解处理器，动态地修改 AST，增加新的节点（即Lombok自定义注解所需要生成的代码），最终通过分析生成JVM可执行的字节码Class文件。使用Annotation Processing自定义注解是在编译阶段进行修改，而JDK的反射技术是在运行时动态修改，两者相比，反射虽然更加灵活一些但是带来的性能损耗更加大。</p>
<h3 id="Lombok类似原理工具有什么"><a href="#Lombok类似原理工具有什么" class="headerlink" title="Lombok类似原理工具有什么"></a>Lombok类似原理工具有什么</h3><ul>
<li>第一个问题，我可以通过上述原理，自己实现一个类似Lombok 吗？</li>
</ul>
<p>可以的，给你找了<a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/fc06578e805a">一篇文章(opens new window)</a></p>
<ul>
<li><p>还有一些其它类库使用这种方式实现，比如:</p>
</li>
<li><p><a href="https://link.zhihu.com/?target=https://github.com/google/auto">Google Auto(opens new window)</a></p>
</li>
<li><p>Dagger</p>
</li>
<li><p>…</p>
</li>
</ul>
<h3 id="Lombok没有未来-Java14-Record了解下"><a href="#Lombok没有未来-Java14-Record了解下" class="headerlink" title="Lombok没有未来 - Java14 Record了解下"></a>Lombok没有未来 - Java14 Record了解下</h3><p>Lombok是没有未来的，因为Java完全可以对于这种纯数据载体通过另外一种方式表示, 所以有了<a href="https://link.zhihu.com/?target=https://openjdk.java.net/jeps/359">JEP 359: Records(opens new window)</a>, 简单而言就是通过一个语法糖来解决。</p>
<ul>
<li>从前</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs text">public class Range &#123;<br> <br>    private final int min;<br>    private final int max;<br> <br>    public Range(int min, int max) &#123;<br>        this.min &#x3D; min;<br>        this.max &#x3D; max;<br>    &#125;<br> <br>    public int getMin() &#123;<br>        return min;<br>    &#125;<br> <br>    public int getMax() &#123;<br>        return max;<br>    &#125;<br> <br>    @Override<br>    public boolean equals(Object o) &#123;<br>        if (this &#x3D;&#x3D; o) return true;<br>        if (o &#x3D;&#x3D; null || getClass() !&#x3D; o.getClass()) return false;<br>        Range range &#x3D; (Range) o;<br>        return min &#x3D;&#x3D; range.min &amp;&amp; max &#x3D;&#x3D; range.max;<br>    &#125;<br> <br>    @Override<br>    public int hashCode() &#123;<br>        return Objects.hash(min, max);<br>    &#125;<br> <br>    @Override<br>    public String toString() &#123;<br>        return &quot;Range&#123;&quot; +<br>          &quot;min&#x3D;&quot; + min +<br>          &quot;, max&#x3D;&quot; + max +<br>          &#39;&#125;&#39;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>Java14 record</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">public record Range(int min, int max) &#123;&#125;<br></code></pre></td></tr></table></figure>

<p>没错就是这个简单！这个语法糖是不是有 “卧槽” 的感觉？我们声明这种类使用record 标识（目前不知道 record 会不会上升到关键字的高度）。当你用record 声明一个类时，该类将自动拥有以下功能：</p>
<ul>
<li>获取成员变量的简单方法，以上面代码为例 min() 和 max() 。注意区别于我们平常getter的写法。</li>
<li>一个 equals 方法的实现，执行比较时会比较该类的所有成员属性</li>
<li>重写 equals 当然要重写 hashCode</li>
<li>一个可以打印该类所有成员属性的 toString 方法。</li>
<li>请注意只会有一个构造方法。</li>
</ul>
<p>因为这个特性是 preview feature，默认情况下是无法编译和执行的。同样以上面为例我们需要执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">$ javac -d classes --enable-preview --release 14 Range.java<br>$ java -classpath classes --enable-preview Range<br></code></pre></td></tr></table></figure>

<p>虽然 record 声明的类没有 final 关键字，实际上它是一个不可变类。除了一些限制外，它依旧是一个普通的Java 类。因此，我们可以像添加普通类一样添加逻辑。我们可以在构造实例时强制执行前提条件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs text">public record Range(int min, int max) &#123;<br>    public Range &#123;<br>        if (min &gt;&#x3D; max)<br>            throw new IllegalArgumentException(&quot;min should be less than max&quot;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>另外我们也可以给 Records 类增加普通方法、静态属性、静态方法，这里不再举例；</p>
<p><strong>为了简化语法糖的推理，不能在类内声明成员属性</strong>。以下是错误的示范：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs text">public record Range(int min, int max) &#123;<br>    &#x2F;&#x2F; 错误的示范<br>    private String name;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Lombok有什么坑"><a href="#Lombok有什么坑" class="headerlink" title="Lombok有什么坑"></a>Lombok有什么坑</h2><h3 id="Data的坑"><a href="#Data的坑" class="headerlink" title="@Data的坑"></a>@Data的坑</h3><p>在使用Lombok过程中，如果对于各种注解的底层原理不理解的话，很容易产生意想不到的结果。</p>
<p>举一个简单的例子，我们知道，当我们使用@Data定义一个类的时候，会自动帮我们生成equals()方法 。</p>
<p>但是如果只使用了@Data，而不使用@EqualsAndHashCode(callSuper&#x3D;true)的话，会默认是@EqualsAndHashCode(callSuper&#x3D;false),这时候生成的equals()方法只会比较子类的属性，不会考虑从父类继承的属性，无论父类属性访问权限是否开放。</p>
<p>这就可能得到意想不到的结果。</p>
<h3 id="代码可读性，可调试性低"><a href="#代码可读性，可调试性低" class="headerlink" title="代码可读性，可调试性低"></a>代码可读性，可调试性低</h3><p>在代码中使用了Lombok，确实可以帮忙减少很多代码，因为Lombok会帮忙自动生成很多代码。但是<strong>这些代码是要在编译阶段才会生成的</strong>，所以在开发的过程中，其实很多代码其实是缺失的。</p>
<p>在代码中大量使用Lombok，就导致代码的可读性会低很多，而且也会给代码调试带来一定的问题。 比如，我们想要知道某个类中的某个属性的getter方法都被哪些类引用的话，就没那么简单了。</p>
<h3 id="Lombok有很强的侵入性"><a href="#Lombok有很强的侵入性" class="headerlink" title="Lombok有很强的侵入性"></a>Lombok有很强的侵入性</h3><ul>
<li><strong>强J队友</strong></li>
</ul>
<p>因为Lombok的使用要求开发者一定要在IDE中安装对应的插件。如果未安装插件的话，使用IDE打开一个基于Lombok的项目的话会提示找不到方法等错误。导致项目编译失败。也就是说，如果项目组中有一个人使用了Lombok，那么其他人就必须也要安装IDE插件。否则就没办法协同开发。</p>
<p>更重要的是，如果我们定义的一个jar包中使用了Lombok，那么就要求所有依赖这个jar包的所有应用都必须安装插件，这种侵入性是很高的。</p>
<ul>
<li><strong>影响升级</strong></li>
</ul>
<p>因为Lombok对于代码有很强的侵入性，就可能带来一个比较大的问题，那就是会影响我们对JDK的升级。按照如今JDK的升级频率，每半年都会推出一个新的版本，但是Lombok作为一个第三方工具，并且是由开源团队维护的，那么他的迭代速度是无法保证的。</p>
<p>所以，如果我们需要升级到某个新版本的JDK的时候，若其中的特性在Lombok中不支持的话就会受到影响。</p>
<p>还有一个可能带来的问题，就是Lombok自身的升级也会受到限制。因为一个应用可能依赖了多个jar包，而每个jar包可能又要依赖不同版本的Lombok，这就导致在应用中需要做版本仲裁，而我们知道，jar包版本仲裁是没那么容易的，而且发生问题的概率也很高。</p>
<h3 id="Lombok破坏了封装性"><a href="#Lombok破坏了封装性" class="headerlink" title="Lombok破坏了封装性"></a>Lombok破坏了封装性</h3><p>以上几个问题，我认为都是有办法可以避免的。但是有些人排斥使用Lombok还有一个重要的原因，那就是他会破坏封装性。</p>
<p>众所周知，Java的三大特性包括封装性、继承性和多态性。</p>
<p>如果我们在代码中直接使用Lombok，那么他会自动帮我们生成getter、setter 等方法，这就意味着，一个类中的所有参数都自动提供了设置和读取方法。</p>
<p>举个简单的例子，我们定义一个购物车类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs text">@Data<br>public class ShoppingCart &#123; <br><br>    &#x2F;&#x2F;商品数目<br>    private int itemsCount; <br><br>    &#x2F;&#x2F;总价格<br>    private double totalPrice; <br><br>    &#x2F;&#x2F;商品明细<br>    private List items &#x3D; new ArrayList&lt;&gt;();<br><br>&#125;<br><br>&#x2F;&#x2F;例子来源于《极客时间-设计模式之美》<br></code></pre></td></tr></table></figure>

<p>我们知道，购物车中商品数目、商品明细以及总价格三者之前其实是有关联关系的，如果需要修改的话是要一起修改的。</p>
<p>但是，我们使用了Lombok的@Data注解，对于itemsCount 和 totalPrice这两个属性。虽然我们将它们定义成 private 类型，但是提供了 public 的 getter、setter 方法。</p>
<p>外部可以通过 setter 方法随意地修改这两个属性的值。我们可以随意调用 setter 方法，来重新设置 itemsCount、totalPrice 属性的值，这也会导致其跟 items 属性的值不一致。</p>
<p>而面向对象封装的定义是：通过访问权限控制，隐藏内部数据，外部仅能通过类提供的有限的接口访问、修改内部数据。所以，暴露不应该暴露的 setter 方法，明显违反了面向对象的封装特性。</p>
<p>好的做法应该是不提供getter&#x2F;setter，而是只提供一个public的addItem方法，同时去修改itemsCount、totalPrice以及items三个属性。</p>
<p>以上问题其实也是可以解决的，但这提醒了我们需要理解Lombok，而不是一股脑的用@Data注解。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p>优缺点</p>
</li>
<li><p>优点：大大减少了代码量，使代码非常简洁</p>
</li>
<li><p>缺点：可能存在对队友不友好、对代码不友好、对调试不友好、对升级不友好等问题。Lombok还会导致破坏封装性的问题。@Data中覆盖equals和hashCode的坑等。</p>
</li>
<li><p>什么样的情况使用Lombok</p>
</li>
<li><p>团队整体的共识，IDE规范，相关代码规范等</p>
</li>
<li><p>对Lombok足够了解，比如知道其中的坑等</p>
</li>
<li><p>不推荐使用Lombok的理由</p>
</li>
<li><p>其实我们不缺时间写Getter和Setter的，这些代码通常是由IDE生成的。简化也是有代价的。</p>
</li>
<li><p>对Lombok认知不够，导致带来的坑。</p>
</li>
<li><p>Java14中Record了解下。</p>
</li>
</ul>
<h2 id="常用开发库-MapStruct工具库详解"><a href="#常用开发库-MapStruct工具库详解" class="headerlink" title="常用开发库 - MapStruct工具库详解"></a>常用开发库 - MapStruct工具库详解</h2><p>MapStruct是一款非常实用Java工具，主要用于解决对象之间的拷贝问题，比如PO&#x2F;DTO&#x2F;VO&#x2F;QueryParam之间的转换问题。区别于BeanUtils这种通过反射，它通过编译器编译生成常规方法，将可以很大程度上提升效率。全面的官方手册可以参考<a href="https://link.zhihu.com/?target=https://mapstruct.org/documentation/stable/reference/pdf/mapstruct-reference-guide.pdf">官方文档PDF</a></p>
<h2 id="为什么会引入MapStruct这类工具"><a href="#为什么会引入MapStruct这类工具" class="headerlink" title="为什么会引入MapStruct这类工具"></a>为什么会引入MapStruct这类工具</h2><h3 id="JavaBean-问题引入"><a href="#JavaBean-问题引入" class="headerlink" title="JavaBean 问题引入"></a>JavaBean 问题引入</h3><p>在开发的时候经常会有业务代码之间有很多的 JavaBean 之间的相互转化，比如PO&#x2F;DTO&#x2F;VO&#x2F;QueryParam之间的转换问题。之前我们的做法是：</p>
<ul>
<li><p><strong>拷贝技术</strong></p>
</li>
<li><p>org.apache.commons.beanutils.PropertyUtils.copyProperties</p>
</li>
<li><p>org.apache.commons.beanutils.BeanUtils.copyProperties</p>
</li>
<li><p>org.springframework.beans.BeanUtils.copyProperties</p>
</li>
<li><p>net.sf.cglib.beans.BeanCopier</p>
</li>
<li><p><strong>纯get&#x2F;set</strong></p>
</li>
<li><p>辅助IDE插件拷贝对象时可以自动set所有方法字段 （这种方式可能有些开发人员不清楚）</p>
</li>
<li><p>不仅看上去冗余添加新的字段时依然需要手动</p>
</li>
<li><p>开发效率比较低</p>
</li>
</ul>
<h3 id="MapStruct-带来的改变"><a href="#MapStruct-带来的改变" class="headerlink" title="MapStruct 带来的改变"></a>MapStruct 带来的改变</h3><p>MapSturct 是一个生成类型安全， 高性能且无依赖的 JavaBean 映射代码的注解处理器（annotation processor）。</p>
<p>工具可以帮我们实现 JavaBean 之间的转换， 通过注解的方式。</p>
<p>同时， 作为一个工具类，相比于手写， 其应该具有便捷， 不容易出错的特点。</p>
<h2 id="MapStruct入门例子"><a href="#MapStruct入门例子" class="headerlink" title="MapStruct入门例子"></a>MapStruct入门例子</h2><p>这里展示最基本的PO转VO的例子，使用的是IDEA + Lombok + MapStruct</p>
<p><img src="/assets/1712902838-6aa1f5cc3a432d0c20941f94b2704f6c.svg" srcset="/img/loading.gif" lazyload></p>
<h3 id="Pom-xml"><a href="#Pom-xml" class="headerlink" title="Pom.xml"></a>Pom.xml</h3><p>注意：基于当前IDEA设置并不需要mapstruct-processor的依赖</p>
<p>一般来说会加载两个包：</p>
<ul>
<li>org.mapstruct:mapstruct: 包含Mapstruct核心，比如注解等；如果是mapstruct-jdk8会引入一些jdk8的语言特性;</li>
<li>org.mapstruct:mapstruct-processor: 处理注解用的，可以根据注解自动生成mapstruct的mapperImpl类</li>
</ul>
<p>如下示例基于IDEA实现，可以在build阶段的annotationProcessorPaths中配置mapstruct-processor的path。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs text">&lt;packaging&gt;jar&lt;&#x2F;packaging&gt;<br>&lt;properties&gt;<br>    &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;<br>    &lt;maven.compiler.source&gt;1.8&lt;&#x2F;maven.compiler.source&gt;<br>    &lt;maven.compiler.target&gt;1.8&lt;&#x2F;maven.compiler.target&gt;<br>    &lt;org.mapstruct.version&gt;1.4.0.Beta3&lt;&#x2F;org.mapstruct.version&gt;<br>    &lt;org.projectlombok.version&gt;1.18.12&lt;&#x2F;org.projectlombok.version&gt;<br>&lt;&#x2F;properties&gt;<br>&lt;dependencies&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;org.mapstruct&lt;&#x2F;groupId&gt;<br>        &lt;artifactId&gt;mapstruct&lt;&#x2F;artifactId&gt;<br>        &lt;version&gt;$&#123;org.mapstruct.version&#125;&lt;&#x2F;version&gt;<br>    &lt;&#x2F;dependency&gt;<br><br>    &lt;!-- lombok dependencies should not end up on classpath --&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;<br>        &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;<br>        &lt;version&gt;$&#123;org.projectlombok.version&#125;&lt;&#x2F;version&gt;<br>        &lt;scope&gt;provided&lt;&#x2F;scope&gt;<br>    &lt;&#x2F;dependency&gt;<br><br>    &lt;!-- fastjson --&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;<br>        &lt;artifactId&gt;fastjson&lt;&#x2F;artifactId&gt;<br>        &lt;version&gt;1.2.71&lt;&#x2F;version&gt;<br>    &lt;&#x2F;dependency&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;<br>        &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;<br>        &lt;version&gt;4.12&lt;&#x2F;version&gt;<br>        &lt;scope&gt;test&lt;&#x2F;scope&gt;<br>    &lt;&#x2F;dependency&gt;<br>&lt;&#x2F;dependencies&gt;<br><br>&lt;build&gt;<br>    &lt;pluginManagement&gt;<br>        &lt;plugins&gt;<br>            &lt;plugin&gt;<br>                &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;<br>                &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;<br>                &lt;version&gt;3.8.1&lt;&#x2F;version&gt;<br>                &lt;configuration&gt;<br>                    &lt;source&gt;1.8&lt;&#x2F;source&gt;<br>                    &lt;target&gt;1.8&lt;&#x2F;target&gt;<br>                    &lt;!-- See https:&#x2F;&#x2F;maven.apache.org&#x2F;plugins&#x2F;maven-compiler-plugin&#x2F;compile-mojo.html --&gt;<br>                    &lt;!-- Classpath elements to supply as annotation processor path. If specified, the compiler   --&gt;<br>                    &lt;!-- will detect annotation processors only in those classpath elements. If omitted, the     --&gt;<br>                    &lt;!-- default classpath is used to detect annotation processors. The detection itself depends --&gt;<br>                    &lt;!-- on the configuration of annotationProcessors.                                           --&gt;<br>                    &lt;!--                                                                                         --&gt;<br>                    &lt;!-- According to this documentation, the provided dependency processor is not considered!   --&gt;<br>                    &lt;annotationProcessorPaths&gt;<br>                        &lt;path&gt;<br>                            &lt;groupId&gt;org.mapstruct&lt;&#x2F;groupId&gt;<br>                            &lt;artifactId&gt;mapstruct-processor&lt;&#x2F;artifactId&gt;<br>                            &lt;version&gt;$&#123;org.mapstruct.version&#125;&lt;&#x2F;version&gt;<br>                        &lt;&#x2F;path&gt;<br>                        &lt;path&gt;<br>                            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;<br>                            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;<br>                            &lt;version&gt;$&#123;org.projectlombok.version&#125;&lt;&#x2F;version&gt;<br>                        &lt;&#x2F;path&gt;<br>                    &lt;&#x2F;annotationProcessorPaths&gt;<br>                &lt;&#x2F;configuration&gt;<br>            &lt;&#x2F;plugin&gt;<br>        &lt;&#x2F;plugins&gt;<br>    &lt;&#x2F;pluginManagement&gt;<br>&lt;&#x2F;build&gt;<br></code></pre></td></tr></table></figure>

<h3 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h3><p>这里面假设基于一些业务需求采用的是MySQL，且将一些扩展的数据放在了config字段中，并以JSON转String存储。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs text">@Data<br>@Accessors(chain &#x3D; true)<br>public class User &#123;<br>    private Long id;<br>    private String username;<br>    private String password; &#x2F;&#x2F; 密码<br>    private Integer sex;  &#x2F;&#x2F; 性别<br>    private LocalDate birthday; &#x2F;&#x2F; 生日<br>    private LocalDateTime createTime; &#x2F;&#x2F; 创建时间<br>    private String config; &#x2F;&#x2F; 其他扩展信息，以JSON格式存储<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="VO-类"><a href="#VO-类" class="headerlink" title="VO 类"></a>VO 类</h3><p>最后真正展示的应该：</p>
<ul>
<li>不显示密码；</li>
<li>将日期转换；</li>
<li>config要转成对象的list；</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs text">@Data<br>@Accessors(chain &#x3D; true)<br>public class UserVo &#123;<br>    private Long id;<br>    private String username;<br>    private String password;<br>    private Integer gender;<br>    private LocalDate birthday;<br>    private String createTime;<br>    private List&lt;UserConfig&gt; config;<br>    @Data<br>    public static class UserConfig &#123;<br>        private String field1;<br>        private Integer field2;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="mapper-或者converter"><a href="#mapper-或者converter" class="headerlink" title="mapper(或者converter)"></a>mapper(或者converter)</h3><p>注意：</p>
<ul>
<li>这里没用@Mappings，且看最后编译出的类文件，会自动加</li>
<li>密码需要ignore</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs text">@Mapper<br>public interface UserConverter &#123;<br>    UserConverter INSTANCE &#x3D; Mappers.getMapper(UserConverter.class);<br><br>    @Mapping(target &#x3D; &quot;gender&quot;, source &#x3D; &quot;sex&quot;)<br>    @Mapping(target &#x3D; &quot;createTime&quot;, dateFormat &#x3D; &quot;yyyy-MM-dd HH:mm:ss&quot;)<br>    UserVo do2vo(User var1);<br><br>    @Mapping(target &#x3D; &quot;sex&quot;, source &#x3D; &quot;gender&quot;)<br>    @Mapping(target &#x3D; &quot;password&quot;, ignore &#x3D; true)<br>    @Mapping(target &#x3D; &quot;createTime&quot;, dateFormat &#x3D; &quot;yyyy-MM-dd HH:mm:ss&quot;)<br>    User vo2Do(UserVo var1);<br><br>    List&lt;UserVo&gt; do2voList(List&lt;User&gt; userList);<br><br>    default List&lt;UserVo.UserConfig&gt; strConfigToListUserConfig(String config) &#123;<br>        return JSON.parseArray(config, UserVo.UserConfig.class);<br>    &#125;<br><br>    default String listUserConfigToStrConfig(List&lt;UserVo.UserConfig&gt; list) &#123;<br>        return JSON.toJSONString(list);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs text">@Test<br>public void do2VoTest() &#123;<br>    User user &#x3D; new User()<br>            .setId(1L)<br>            .setUsername(&quot;zhangsan&quot;)<br>            .setSex(1)<br>            .setPassword(&quot;abc123&quot;)<br>            .setCreateTime(LocalDateTime.now())<br>            .setBirthday(LocalDate.of(1999, 9, 27))<br>            .setConfig(&quot;[&#123;\&quot;field1\&quot;:\&quot;Test Field1\&quot;,\&quot;field2\&quot;:500&#125;]&quot;);<br><br>    UserVo userVo &#x3D; UserConverter.INSTANCE.do2vo(user);<br><br>    &#x2F;&#x2F; asset<br>    assertNotNull(userVo);<br>    assertEquals(userVo.getId(), user.getId());<br><br>    &#x2F;&#x2F; print<br>    System.out.println(user);<br>    System.out.println(userVo);<br>&#x2F;&#x2F;        User(id&#x3D;1, username&#x3D;zhangsan, password&#x3D;abc123, sex&#x3D;1, birthday&#x3D;1999-09-27, createTime&#x3D;2020-08-17T14:54:01.528, config&#x3D;[&#123;&quot;field1&quot;:&quot;Test Field1&quot;,&quot;field2&quot;:500&#125;])<br>&#x2F;&#x2F;        UserVo(id&#x3D;1, username&#x3D;zhangsan, password&#x3D;abc123, gender&#x3D;1, birthday&#x3D;1999-09-27, createTime&#x3D;2020-08-17 14:54:01, config&#x3D;[UserVo.UserConfig(field1&#x3D;Test Field1, field2&#x3D;500)])<br>&#125;<br><br>@Test<br>public void vo2DoTest() &#123;<br>    UserVo.UserConfig userConfig &#x3D; new UserVo.UserConfig();<br>    userConfig.setField1(&quot;Test Field1&quot;);<br>    userConfig.setField2(500);<br><br>    UserVo userVo &#x3D; new UserVo()<br>            .setId(1L)<br>            .setUsername(&quot;zhangsan&quot;)<br>            .setGender(2)<br>            .setCreateTime(&quot;2020-01-18 15:32:54&quot;)<br>            .setBirthday(LocalDate.of(1999, 9, 27))<br>            .setConfig(Collections.singletonList(userConfig));<br>    User user &#x3D; UserConverter.INSTANCE.vo2Do(userVo);<br><br>    &#x2F;&#x2F; asset<br>    assertNotNull(userVo);<br>    assertEquals(userVo.getId(), user.getId());<br><br>    &#x2F;&#x2F; print<br>    System.out.println(user);<br>    System.out.println(userVo);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="MapStrcut实现的原理"><a href="#MapStrcut实现的原理" class="headerlink" title="MapStrcut实现的原理?"></a>MapStrcut实现的原理?</h2><p>MapStruct 来生成的代码， 其类似于人手写。 速度上可以得到保证。</p>
<p>前面例子中生成的代码可以在编译后看到, 在 target&#x2F;generated-sources&#x2F;annotations 里可以看到; 同时真正在代码包执行的可以在target&#x2F;classes包中看到。</p>
<h3 id="编译后的类"><a href="#编译后的类" class="headerlink" title="编译后的类"></a>编译后的类</h3><ul>
<li>编译后的class位置</li>
</ul>
<p><img src="/assets/1712902838-75df3bcf4843a615f1b07dd422dd8498.svg" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>编译后的内容</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs text">public class UserConverterImpl implements UserConverter &#123;<br><br>    @Override<br>    public UserVo do2vo(User var1) &#123;<br>        if ( var1 &#x3D;&#x3D; null ) &#123;<br>            return null;<br>        &#125;<br><br>        UserVo userVo &#x3D; new UserVo();<br><br>        userVo.setGender( var1.getSex() );<br>        if ( var1.getCreateTime() !&#x3D; null ) &#123;<br>            userVo.setCreateTime( DateTimeFormatter.ofPattern( &quot;yyyy-MM-dd HH:mm:ss&quot; ).format( var1.getCreateTime() ) );<br>        &#125;<br>        userVo.setId( var1.getId() );<br>        userVo.setUsername( var1.getUsername() );<br>        userVo.setPassword( var1.getPassword() );<br>        userVo.setBirthday( var1.getBirthday() );<br>        userVo.setConfig( strConfigToListUserConfig( var1.getConfig() ) );<br><br>        return userVo;<br>    &#125;<br><br>    @Override<br>    public User vo2Do(UserVo var1) &#123;<br>        if ( var1 &#x3D;&#x3D; null ) &#123;<br>            return null;<br>        &#125;<br><br>        User user &#x3D; new User();<br><br>        user.setSex( var1.getGender() );<br>        if ( var1.getCreateTime() !&#x3D; null ) &#123;<br>            user.setCreateTime( LocalDateTime.parse( var1.getCreateTime(), DateTimeFormatter.ofPattern( &quot;yyyy-MM-dd HH:mm:ss&quot; ) ) );<br>        &#125;<br>        user.setId( var1.getId() );<br>        user.setUsername( var1.getUsername() );<br>        user.setBirthday( var1.getBirthday() );<br>        user.setConfig( listUserConfigToStrConfig( var1.getConfig() ) );<br><br>        return user;<br>    &#125;<br><br>    @Override<br>    public List&lt;UserVo&gt; do2voList(List&lt;User&gt; userList) &#123;<br>        if ( userList &#x3D;&#x3D; null ) &#123;<br>            return null;<br>        &#125;<br><br>        List&lt;UserVo&gt; list &#x3D; new ArrayList&lt;UserVo&gt;( userList.size() );<br>        for ( User user : userList ) &#123;<br>            list.add( do2vo( user ) );<br>        &#125;<br><br>        return list;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="这里面用了什么机制？"><a href="#这里面用了什么机制？" class="headerlink" title="这里面用了什么机制？"></a>这里面用了什么机制？</h3><p>这和Lombok实现机制一致。</p>
<p>核心之处就是对于注解的解析上。JDK5引入了注解的同时，也提供了两种解析方式。</p>
<ul>
<li><strong>运行时解析</strong></li>
</ul>
<p>运行时能够解析的注解，必须将@Retention设置为RUNTIME, 比如@Retention(RetentionPolicy.RUNTIME)，这样就可以通过反射拿到该注解。java.lang,reflect反射包中提供了一个接口AnnotatedElement，该接口定义了获取注解信息的几个方法，Class、Constructor、Field、Method、Package等都实现了该接口，对反射熟悉的朋友应该都会很熟悉这种解析方式。</p>
<ul>
<li><strong>编译时解析</strong></li>
</ul>
<p>编译时解析有两种机制，分别简单描述下：</p>
<p>1）Annotation Processing Tool</p>
<p>apt自JDK5产生，JDK7已标记为过期，不推荐使用，JDK8中已彻底删除，自JDK6开始，可以使用Pluggable Annotation Processing API来替换它，apt被替换主要有2点原因：</p>
<ul>
<li>api都在com.sun.mirror非标准包下</li>
<li>没有集成到javac中，需要额外运行</li>
</ul>
<p>2）Pluggable Annotation Processing API</p>
<p><a href="https://link.zhihu.com/?target=https://www.jcp.org/en/jsr/proposalDetails?id=269">JSR 269: Pluggable Annotation Processing API(opens new window)</a>自JDK6加入，作为apt的替代方案，它解决了apt的两个问题，javac在执行的时候会调用实现了该API的程序，这样我们就可以对编译器做一些增强，这时javac执行的过程如下：</p>
<p><img src="/assets/1712902838-65981fa8cb40832f3a13cf976831adb3.svg" srcset="/img/loading.gif" lazyload></p>
<p>Lombok本质上就是一个实现了“JSR 269 API”的程序。在使用javac的过程中，它产生作用的具体流程如下：</p>
<ul>
<li>javac对源代码进行分析，生成了一棵抽象语法树（AST）</li>
<li>运行过程中调用实现了“JSR 269 API”的Lombok程序</li>
<li>此时Lombok就对第一步骤得到的AST进行处理，找到@Data注解所在类对应的语法树（AST），然后修改该语法树（AST），增加getter和setter方法定义的相应树节点</li>
<li>javac使用修改后的抽象语法树（AST）生成字节码文件，即给class增加新的节点（代码块）</li>
</ul>
<p><img src="/assets/1712902838-6d7a1ba652e187416dab17b8298c8382.svg" srcset="/img/loading.gif" lazyload></p>
<p>从上面的Lombok执行的流程图中可以看出，在Javac 解析成AST抽象语法树之后, Lombok 根据自己编写的注解处理器，动态地修改 AST，增加新的节点（即Lombok自定义注解所需要生成的代码），最终通过分析生成JVM可执行的字节码Class文件。使用Annotation Processing自定义注解是在编译阶段进行修改，而JDK的反射技术是在运行时动态修改，两者相比，反射虽然更加灵活一些但是带来的性能损耗更加大。</p>
<h2 id="常用开发库-其它常用类库"><a href="#常用开发库-其它常用类库" class="headerlink" title="常用开发库 - 其它常用类库"></a>常用开发库 - 其它常用类库</h2><h2 id="常用类库资源"><a href="#常用类库资源" class="headerlink" title="常用类库资源"></a>常用类库资源</h2><p>想了解哪个常用类库用的最多？ 看这里搜索吧: <a href="https://link.zhihu.com/?target=https://mvnrepository.com/open-source">Maven 仓库</a></p>
<h2 id="搜索常用"><a href="#搜索常用" class="headerlink" title="搜索常用"></a>搜索常用</h2><p>还想看看国内一些比较好的开源的？<a href="https://link.zhihu.com/?target=https://gitee.com/explore">https://gitee.com/explore</a></p>
<p>转载自<a href="https://link.zhihu.com/?target=https://link.juejin.cn/?target=https%253A%252F%252Fwww.pdai.tech%252F">www.pdai.tech/</a>，用于自我学习，如果侵权，马上删除</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Java/" class="category-chain-item">Java</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Java/" class="print-no-link">#Java</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>常用开发库知识体系</div>
      <div>https://flepeng.github.io/021-Java-常用开发库知识体系/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Lepeng</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年5月14日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/021-Java-%E9%9D%99%E6%80%81%E4%BB%A3%E7%A0%81%E5%9D%97/" title="静态代码块">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">静态代码块</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/021-Java-71-%E9%97%AE%E9%A2%98-02-springboot-springboot-%E9%A1%B9%E7%9B%AE%E4%BD%BF%E7%94%A8-mybatis-%E6%97%B6%E6%8A%A5%E9%94%99-No-MyBatios-mapper-was-found-in-xxx-mapper-package-Pleas-check-you-configureation/" title="springboot 项目使用 mybatis 时报错 No MyBatios mapper was found in &#39;[xxx mapper]&#39; package Pleas check you configureation">
                        <span class="hidden-mobile">springboot 项目使用 mybatis 时报错 No MyBatios mapper was found in &#39;[xxx mapper]&#39; package Pleas check you configureation</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
    <div id="giscus" class="giscus"></div>
    <script type="text/javascript">
      Fluid.utils.loadComments('#giscus', function() {
        var options = {"repo":"flepeng/hexo-blog-comment","repo-id":"R_kgDOL0qaig","category":"Announcements","category-id":"DIC_kwDOL0qais4CfBIv","theme-light":"light","theme-dark":"dark","mapping":"pathname","reactions-enabled":1,"emit-metadata":0,"input-position":"top","lang":"zh-CN"};
        var attributes = {};
        for (let option in options) {
          if (!option.startsWith('theme-')) {
            var key = option.startsWith('data-') ? option : 'data-' + option;
            attributes[key] = options[option];
          }
        }
        var light = 'light';
        var dark = 'dark';
        window.GiscusThemeLight = light;
        window.GiscusThemeDark = dark;
        attributes['data-theme'] = document.documentElement.getAttribute('data-user-color-scheme') === 'dark' ? dark : light;
        for (let attribute in attributes) {
          var value = attributes[attribute];
          if (value === undefined || value === null || value === '') {
            delete attributes[attribute];
          }
        }
        var s = document.createElement('script');
        s.setAttribute('src', 'https://giscus.app/client.js');
        s.setAttribute('crossorigin', 'anonymous');
        for (let attribute in attributes) {
          s.setAttribute(attribute, attributes[attribute]);
        }
        var ss = document.getElementsByTagName('script');
        var e = ss.length > 0 ? ss[ss.length - 1] : document.head || document.documentElement;
        e.parentNode.insertBefore(s, e.nextSibling);
      });
    </script>
    <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
